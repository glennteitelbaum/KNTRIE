<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64)</h2>
  <p class="sub">Log-log · Per-entry · Lower is better · FND=100% hit, MIX=75% hit</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0006,kntrie_mix:0.0013,kntrie_insert:0.0121,kntrie_erase:0.0052,kntrie_mem:2056,map_fnd:0.0033,map_mix:0.0031,map_insert:0.0120,map_erase:0.0071,map_mem:4800,umap_fnd:0.0013,umap_mix:0.0016,umap_insert:0.0040,umap_erase:0.0029,umap_mem:3224},
  {pattern:"random",N:150,kntrie_fnd:0.0011,kntrie_mix:0.0020,kntrie_insert:0.0134,kntrie_erase:0.0056,kntrie_mem:4104,map_fnd:0.0051,map_mix:0.0051,map_insert:0.0159,map_erase:0.0097,map_mem:7200,umap_fnd:0.0018,umap_mix:0.0023,umap_insert:0.0062,umap_erase:0.0030,umap_mem:4856},
  {pattern:"random",N:225,kntrie_fnd:0.0016,kntrie_mix:0.0032,kntrie_insert:0.0149,kntrie_erase:0.0067,kntrie_mem:4104,map_fnd:0.0084,map_mix:0.0082,map_insert:0.0238,map_erase:0.0131,map_mem:10800,umap_fnd:0.0030,umap_mix:0.0041,umap_insert:0.0080,umap_erase:0.0037,umap_mem:7216},
  {pattern:"random",N:337,kntrie_fnd:0.0027,kntrie_mix:0.0047,kntrie_insert:0.0230,kntrie_erase:0.0099,kntrie_mem:8200,map_fnd:0.0134,map_mix:0.0135,map_insert:0.0340,map_erase:0.0199,map_mem:16176,umap_fnd:0.0043,umap_mix:0.0055,umap_insert:0.0113,umap_erase:0.0050,umap_mem:10784},
  {pattern:"random",N:506,kntrie_fnd:0.0041,kntrie_mix:0.0074,kntrie_insert:0.0361,kntrie_erase:0.0129,kntrie_mem:8200,map_fnd:0.0221,map_mix:0.0224,map_insert:0.0508,map_erase:0.0270,map_mem:24288,umap_fnd:0.0062,umap_mix:0.0079,umap_insert:0.0156,umap_erase:0.0069,umap_mem:16472},
  {pattern:"random",N:759,kntrie_fnd:0.0070,kntrie_mix:0.0122,kntrie_insert:0.0581,kntrie_erase:0.0202,kntrie_mem:16392,map_fnd:0.0367,map_mix:0.0358,map_insert:0.0755,map_erase:0.0409,map_mem:36432,umap_fnd:0.0098,umap_mix:0.0128,umap_insert:0.0220,umap_erase:0.0110,umap_mem:24304},
  {pattern:"random",N:1139,kntrie_fnd:0.0118,kntrie_mix:0.0188,kntrie_insert:0.0808,kntrie_erase:0.0183,kntrie_mem:32776,map_fnd:0.0637,map_mix:0.0648,map_insert:0.1113,map_erase:0.0599,map_mem:54672,umap_fnd:0.0148,umap_mix:0.0196,umap_insert:0.0307,umap_erase:0.0144,umap_mem:36880},
  {pattern:"random",N:1708,kntrie_fnd:0.0180,kntrie_mix:0.0288,kntrie_insert:0.1090,kntrie_erase:0.0355,kntrie_mem:32776,map_fnd:0.1081,map_mix:0.1082,map_insert:0.1728,map_erase:0.0957,map_mem:81984,umap_fnd:0.0237,umap_mix:0.0319,umap_insert:0.0470,umap_erase:0.0229,umap_mem:54920},
  {pattern:"random",N:2562,kntrie_fnd:0.0321,kntrie_mix:0.0470,kntrie_insert:0.1756,kntrie_erase:0.0537,kntrie_mem:65544,map_fnd:0.1798,map_mix:0.1795,map_insert:0.2688,map_erase:0.1489,map_mem:122976,umap_fnd:0.0362,umap_mix:0.0483,umap_insert:0.0664,umap_erase:0.0341,umap_mem:83512},
  {pattern:"random",N:3844,kntrie_fnd:0.0488,kntrie_mix:0.0722,kntrie_insert:0.2574,kntrie_erase:0.0795,kntrie_mem:65544,map_fnd:0.2941,map_mix:0.2958,map_insert:0.4273,map_erase:0.2337,map_mem:184512,umap_fnd:0.0576,umap_mix:0.0775,umap_insert:0.1016,umap_erase:0.0542,umap_mem:124472},
  {pattern:"random",N:5766,kntrie_fnd:0.0684,kntrie_mix:0.0957,kntrie_insert:0.6115,kntrie_erase:0.3550,kntrie_mem:131600,map_fnd:0.5033,map_mix:0.5020,map_insert:0.6817,map_erase:0.3818,map_mem:276768,umap_fnd:0.0895,umap_mix:0.1180,umap_insert:0.1721,umap_erase:0.0835,umap_mem:186008},
  {pattern:"random",N:8649,kntrie_fnd:0.1377,kntrie_mix:0.1773,kntrie_insert:0.6974,kntrie_erase:0.6571,kntrie_mem:214544,map_fnd:0.8306,map_mix:0.8296,map_insert:1.0900,map_erase:0.6119,map_mem:415152,umap_fnd:0.1353,umap_mix:0.1805,umap_insert:0.2411,umap_erase:0.1301,umap_mem:277840},
  {pattern:"random",N:12974,kntrie_fnd:0.1769,kntrie_mix:0.2492,kntrie_insert:0.9518,kntrie_erase:0.8075,kntrie_mem:274960,map_fnd:1.3918,map_mix:1.3897,map_insert:1.7414,map_erase:1.0381,map_mem:622752,umap_fnd:0.2094,umap_mix:0.2857,umap_insert:0.3545,umap_erase:0.1961,umap_mem:415240},
  {pattern:"random",N:19461,kntrie_fnd:0.3251,kntrie_mix:0.4273,kntrie_insert:1.4051,kntrie_erase:1.0451,kntrie_mem:503824,map_fnd:2.4115,map_mix:2.3835,map_insert:2.7765,map_erase:1.6418,map_mem:934128,umap_fnd:0.3116,umap_mix:0.4194,umap_insert:0.5424,umap_erase:0.2988,umap_mem:633088},
  {pattern:"random",N:29192,kntrie_fnd:0.4859,kntrie_mix:0.6815,kntrie_insert:2.1931,kntrie_erase:1.4234,kntrie_mem:568336,map_fnd:4.7234,map_mix:4.5772,map_insert:5.0856,map_erase:3.0044,map_mem:1401216,umap_fnd:0.4940,umap_mix:0.6633,umap_insert:0.8399,umap_erase:0.4648,umap_mem:946424},
  {pattern:"random",N:43789,kntrie_fnd:0.8585,kntrie_mix:1.1208,kntrie_insert:3.2194,kntrie_erase:1.9815,kntrie_mem:1053712,map_fnd:9.6645,map_mix:9.4723,map_insert:7.8398,map_erase:5.8432,map_mem:2101872,umap_fnd:0.8404,umap_mix:1.1305,umap_insert:1.3816,umap_erase:0.8925,umap_mem:1414784},
  {pattern:"random",N:65684,kntrie_fnd:2.1711,kntrie_mix:2.2360,kntrie_insert:5.5053,kntrie_erase:2.5168,kntrie_mem:1573904,map_fnd:17.2980,map_mix:17.7660,map_insert:14.6967,map_erase:10.1646,map_mem:3152832,umap_fnd:1.5291,umap_mix:2.0628,umap_insert:2.6140,umap_erase:1.9101,umap_mem:2114872},
  {pattern:"random",N:98526,kntrie_fnd:2.9747,kntrie_mix:3.2438,kntrie_insert:7.3706,kntrie_erase:3.8670,kntrie_mem:2102288,map_fnd:26.7685,map_mix:26.4147,map_insert:23.1878,map_erase:15.7416,map_mem:4729248,umap_fnd:2.3013,umap_mix:3.2057,umap_insert:4.1534,umap_erase:2.8032,umap_mem:3162488},
  {pattern:"random",N:147789,kntrie_fnd:8.0425,kntrie_mix:8.0802,kntrie_insert:13.5915,kntrie_erase:6.4762,kntrie_mem:4183056,map_fnd:52.1385,map_mix:52.5710,map_insert:40.1676,map_erase:28.7206,map_mem:7093872,umap_fnd:3.7490,umap_mix:5.4178,umap_insert:7.7119,umap_erase:4.8713,umap_mem:4729280},
  {pattern:"random",N:221683,kntrie_fnd:12.3431,kntrie_mix:12.1124,kntrie_insert:22.0799,kntrie_erase:11.8043,kntrie_mem:4199440,map_fnd:92.5669,map_mix:92.0184,map_insert:76.3517,map_erase:49.4881,map_mem:10640784,umap_fnd:5.9374,umap_mix:8.4848,umap_insert:13.1790,umap_erase:7.9489,umap_mem:7215568},
  {pattern:"random",N:332525,kntrie_fnd:28.7686,kntrie_mix:28.7997,kntrie_insert:41.4121,kntrie_erase:22.1048,kntrie_mem:8393744,map_fnd:174.9701,map_mix:173.7076,map_insert:143.8895,map_erase:97.9037,map_mem:15961200,umap_fnd:10.9819,umap_mix:15.4539,umap_insert:24.2619,umap_erase:15.4017,umap_mem:10789088},
  {pattern:"random",N:498788,kntrie_fnd:50.1487,kntrie_mix:50.9280,kntrie_insert:93.2478,kntrie_erase:47.8432,kntrie_mem:8524816,map_fnd:306.6261,map_mix:304.6455,map_insert:268.2505,map_erase:166.5858,map_mem:23941824,umap_fnd:17.5210,umap_mix:25.0386,umap_insert:39.9875,umap_erase:25.1048,umap_mem:16132840},
  {pattern:"random",N:748182,kntrie_fnd:104.9756,kntrie_mix:99.2962,kntrie_insert:164.7770,kntrie_erase:83.5276,kntrie_mem:16782352,map_fnd:531.9133,map_mix:521.9546,map_insert:468.6394,map_erase:281.5998,map_mem:35912736,umap_fnd:27.5976,umap_mix:38.7725,umap_insert:64.9265,umap_erase:41.1528,umap_mem:24124760},
  {pattern:"random",N:1122274,kntrie_fnd:95.5154,kntrie_mix:96.4062,kntrie_insert:333.2025,kntrie_erase:152.2744,kntrie_mem:27146000,umap_fnd:42.1521,umap_mix:57.3725,umap_insert:97.9831,umap_erase:60.8169,umap_mem:36077144},
  {pattern:"random",N:1683411,kntrie_fnd:160.0281,kntrie_mix:141.7970,kntrie_insert:472.7683,kntrie_erase:283.9141,kntrie_mem:37514256,umap_fnd:65.7441,umap_mix:94.1640,umap_insert:149.1564,umap_erase:102.9539,umap_mem:53952736},
  {pattern:"random",N:2525116,kntrie_fnd:248.8958,kntrie_mix:247.6379,kntrie_insert:603.3594,kntrie_erase:457.5656,kntrie_mem:62881040,umap_fnd:90.4439,umap_mix:118.5629,umap_insert:224.1326,umap_erase:128.7320,umap_mem:82332776},
  {pattern:"sequential",N:100,kntrie_fnd:0.0006,kntrie_mix:0.0012,kntrie_insert:0.0106,kntrie_erase:0.0036,kntrie_mem:2056,map_fnd:0.0029,map_mix:0.0023,map_insert:0.0099,map_erase:0.0056,map_mem:4800,umap_fnd:0.0003,umap_mix:0.0008,umap_insert:0.0019,umap_erase:0.0015,umap_mem:3224},
  {pattern:"sequential",N:150,kntrie_fnd:0.0010,kntrie_mix:0.0020,kntrie_insert:0.0098,kntrie_erase:0.0049,kntrie_mem:4104,map_fnd:0.0047,map_mix:0.0039,map_insert:0.0156,map_erase:0.0089,map_mem:7200,umap_fnd:0.0004,umap_mix:0.0011,umap_insert:0.0038,umap_erase:0.0019,umap_mem:4856},
  {pattern:"sequential",N:225,kntrie_fnd:0.0015,kntrie_mix:0.0029,kntrie_insert:0.0132,kntrie_erase:0.0050,kntrie_mem:4104,map_fnd:0.0078,map_mix:0.0063,map_insert:0.0203,map_erase:0.0119,map_mem:10800,umap_fnd:0.0006,umap_mix:0.0018,umap_insert:0.0048,umap_erase:0.0016,umap_mem:7216},
  {pattern:"sequential",N:337,kntrie_fnd:0.0025,kntrie_mix:0.0046,kntrie_insert:0.0196,kntrie_erase:0.0090,kntrie_mem:8200,map_fnd:0.0126,map_mix:0.0102,map_insert:0.0307,map_erase:0.0175,map_mem:16176,umap_fnd:0.0010,umap_mix:0.0025,umap_insert:0.0069,umap_erase:0.0027,umap_mem:10784},
  {pattern:"sequential",N:506,kntrie_fnd:0.0038,kntrie_mix:0.0065,kntrie_insert:0.0309,kntrie_erase:0.0114,kntrie_mem:8200,map_fnd:0.0203,map_mix:0.0177,map_insert:0.0455,map_erase:0.0253,map_mem:24288,umap_fnd:0.0015,umap_mix:0.0035,umap_insert:0.0093,umap_erase:0.0037,umap_mem:16472},
  {pattern:"sequential",N:759,kntrie_fnd:0.0064,kntrie_mix:0.0115,kntrie_insert:0.0451,kntrie_erase:0.0172,kntrie_mem:16392,map_fnd:0.0337,map_mix:0.0276,map_insert:0.0699,map_erase:0.0372,map_mem:36432,umap_fnd:0.0022,umap_mix:0.0059,umap_insert:0.0130,umap_erase:0.0044,umap_mem:24304},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0107,kntrie_mix:0.0174,kntrie_insert:0.0758,kntrie_erase:0.0178,kntrie_mem:32776,map_fnd:0.0585,map_mix:0.0503,map_insert:0.1051,map_erase:0.0567,map_mem:54672,umap_fnd:0.0032,umap_mix:0.0087,umap_insert:0.0185,umap_erase:0.0061,umap_mem:36880},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0165,kntrie_mix:0.0263,kntrie_insert:0.1003,kntrie_erase:0.0323,kntrie_mem:32776,map_fnd:0.0994,map_mix:0.0824,map_insert:0.1592,map_erase:0.0903,map_mem:81984,umap_fnd:0.0048,umap_mix:0.0138,umap_insert:0.0263,umap_erase:0.0094,umap_mem:54920},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0294,kntrie_mix:0.0436,kntrie_insert:0.1873,kntrie_erase:0.0502,kntrie_mem:65544,map_fnd:0.1646,map_mix:0.1368,map_insert:0.2513,map_erase:0.1406,map_mem:122976,umap_fnd:0.0073,umap_mix:0.0201,umap_insert:0.0385,umap_erase:0.0159,umap_mem:83512},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0444,kntrie_mix:0.0645,kntrie_insert:0.2742,kntrie_erase:0.0752,kntrie_mem:65544,map_fnd:0.2735,map_mix:0.2263,map_insert:0.3959,map_erase:0.2184,map_mem:184512,umap_fnd:0.0109,umap_mix:0.0316,umap_insert:0.0550,umap_erase:0.0228,umap_mem:124472},
  {pattern:"sequential",N:5766,kntrie_fnd:0.1665,kntrie_mix:0.1935,kntrie_insert:0.4358,kntrie_erase:0.1431,kntrie_mem:70272,map_fnd:0.4523,map_mix:0.3790,map_insert:0.6311,map_erase:0.3492,map_mem:276768,umap_fnd:0.0165,umap_mix:0.0487,umap_insert:0.0809,umap_erase:0.0364,umap_mem:186008},
  {pattern:"sequential",N:8649,kntrie_fnd:0.2586,kntrie_mix:0.2953,kntrie_insert:0.5424,kntrie_erase:0.2176,kntrie_mem:104736,map_fnd:0.7671,map_mix:0.6264,map_insert:0.9963,map_erase:0.5663,map_mem:415152,umap_fnd:0.0249,umap_mix:0.0771,umap_insert:0.1165,umap_erase:0.0546,umap_mem:277840},
  {pattern:"sequential",N:12974,kntrie_fnd:0.3870,kntrie_mix:0.4418,kntrie_insert:0.7262,kntrie_erase:0.3267,kntrie_mem:156976,map_fnd:1.2863,map_mix:1.0663,map_insert:1.6253,map_erase:0.9273,map_mem:622752,umap_fnd:0.0362,umap_mix:0.1127,umap_insert:0.1871,umap_erase:0.0835,umap_mem:415240},
  {pattern:"sequential",N:19461,kntrie_fnd:0.5900,kntrie_mix:0.6787,kntrie_insert:0.9388,kntrie_erase:0.5251,kntrie_mem:236336,map_fnd:2.1836,map_mix:1.8394,map_insert:2.5517,map_erase:1.5503,map_mem:934128,umap_fnd:0.0551,umap_mix:0.1619,umap_insert:0.2763,umap_erase:0.1319,umap_mem:633088},
  {pattern:"sequential",N:29192,kntrie_fnd:0.9017,kntrie_mix:1.0174,kntrie_insert:1.3287,kntrie_erase:0.7791,kntrie_mem:353696,map_fnd:3.8895,map_mix:3.2188,map_insert:4.1615,map_erase:2.5209,map_mem:1401216,umap_fnd:0.0991,umap_mix:0.2604,umap_insert:0.3997,umap_erase:0.2033,umap_mem:946424},
  {pattern:"sequential",N:43789,kntrie_fnd:1.3823,kntrie_mix:1.5511,kntrie_insert:2.0054,kntrie_erase:1.1911,kntrie_mem:531344,map_fnd:7.6815,map_mix:6.3564,map_insert:7.0023,map_erase:4.7180,map_mem:2101872,umap_fnd:0.2163,umap_mix:0.4352,umap_insert:0.6126,umap_erase:0.4701,umap_mem:1414784},
  {pattern:"sequential",N:65684,kntrie_fnd:2.1477,kntrie_mix:2.3540,kntrie_insert:3.5456,kntrie_erase:2.1731,kntrie_mem:796584,map_fnd:15.9749,map_mix:12.6211,map_insert:12.5694,map_erase:8.8967,map_mem:3152832,umap_fnd:0.5598,umap_mix:0.7992,umap_insert:0.9825,umap_erase:1.1387,umap_mem:2114872},
  {pattern:"sequential",N:98526,kntrie_fnd:3.3606,kntrie_mix:3.6677,kntrie_insert:5.6808,kntrie_erase:3.4159,kntrie_mem:1192880,map_fnd:28.1756,map_mix:22.7619,map_insert:23.2041,map_erase:16.2699,map_mem:4729248,umap_fnd:0.9680,umap_mix:1.3198,umap_insert:1.6826,umap_erase:1.9156,umap_mem:3162488},
  {pattern:"sequential",N:147789,kntrie_fnd:5.7756,kntrie_mix:6.2996,kntrie_insert:9.1350,kntrie_erase:5.7172,kntrie_mem:1789920,map_fnd:57.4820,map_mix:47.4380,map_insert:47.2044,map_erase:31.7235,map_mem:7093872,umap_fnd:1.9827,umap_mix:2.5685,umap_insert:3.6460,umap_erase:3.4268,umap_mem:4729280},
  {pattern:"sequential",N:221683,kntrie_fnd:10.1027,kntrie_mix:10.4405,kntrie_insert:14.6631,kntrie_erase:9.3494,kntrie_mem:2684384,map_fnd:102.5664,map_mix:83.1307,map_insert:83.1394,map_erase:55.4879,map_mem:10640784,umap_fnd:3.2702,umap_mix:4.0510,umap_insert:6.8880,umap_erase:6.5284,umap_mem:7215568},
  {pattern:"sequential",N:332525,kntrie_fnd:17.6345,kntrie_mix:17.6808,kntrie_insert:23.6996,kntrie_erase:17.3358,kntrie_mem:4026368,map_fnd:180.7897,map_mix:145.9030,map_insert:151.0773,map_erase:100.0117,map_mem:15961200,umap_fnd:5.2165,umap_mix:6.4215,umap_insert:11.7718,umap_erase:10.2640,umap_mem:10789088},
  {pattern:"sequential",N:498788,kntrie_fnd:28.9912,kntrie_mix:27.9914,kntrie_insert:40.7771,kntrie_erase:32.9289,kntrie_mem:6040512,map_fnd:301.5422,map_mix:240.8161,map_insert:258.5605,map_erase:168.9303,map_mem:23941824,umap_fnd:8.4500,umap_mix:10.6769,umap_insert:18.6244,umap_erase:16.3326,umap_mem:16132840},
  {pattern:"sequential",N:748182,kntrie_fnd:48.2673,kntrie_mix:45.4176,kntrie_insert:70.4788,kntrie_erase:62.7120,kntrie_mem:9060720,map_fnd:515.1051,map_mix:402.8112,map_insert:448.6442,map_erase:270.7459,map_mem:35912736,umap_fnd:13.1081,umap_mix:16.6026,umap_insert:27.6732,umap_erase:26.1421,umap_mem:24124760},
  {pattern:"sequential",N:1122274,kntrie_fnd:77.8589,kntrie_mix:74.0490,kntrie_insert:122.5001,kntrie_erase:106.3155,kntrie_mem:13590160,umap_fnd:24.5778,umap_mix:26.1745,umap_insert:47.8961,umap_erase:41.9335,umap_mem:36077144},
  {pattern:"sequential",N:1683411,kntrie_fnd:127.7475,kntrie_mix:118.9890,kntrie_insert:209.6274,kntrie_erase:178.6989,kntrie_mem:20385680,umap_fnd:39.3424,umap_mix:40.5278,umap_insert:77.5195,umap_erase:63.9633,umap_mem:53952736},
  {pattern:"sequential",N:2525116,kntrie_fnd:191.0500,kntrie_mix:179.6949,kntrie_insert:330.2726,kntrie_erase:276.0421,kntrie_mem:30578176,umap_fnd:59.4756,umap_mix:56.7918,umap_insert:118.5980,umap_erase:95.8914,umap_mem:82332776},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "mix", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie MIX" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "mix", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map MIX" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "mix", color: "#86efac", dash: [6,3], width: 1.5, label: "umap MIX" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64 &rarr; u32)</h2>
  <p class="sub">Log-log &middot; Per-entry &middot; Lower is better &middot; FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Iteration (ns/entry)</h3><canvas id="c_iter"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0009,kntrie_nf:0.0008,kntrie_insert:0.0214,kntrie_erase:0.0129,kntrie_iter:0.0076,kntrie_mem:26200,map_fnd:0.0042,map_nf:0.0031,map_insert:0.0185,map_erase:0.0145,map_iter:0.0065,map_mem:4800,umap_fnd:0.0015,umap_nf:0.0021,umap_insert:0.0105,umap_erase:0.0078,umap_iter:0.0064,umap_mem:3224,kntrie_memneeded:1544},
  {pattern:"random",N:150,kntrie_fnd:0.0014,kntrie_nf:0.0013,kntrie_insert:0.0322,kntrie_erase:0.0126,kntrie_iter:0.0089,kntrie_mem:27736,map_fnd:0.0070,map_nf:0.0057,map_insert:0.0241,map_erase:0.0182,map_iter:0.0065,map_mem:7200,umap_fnd:0.0022,umap_nf:0.0024,umap_insert:0.0119,umap_erase:0.0092,umap_iter:0.0049,umap_mem:4856,kntrie_memneeded:3080},
  {pattern:"random",N:225,kntrie_fnd:0.0021,kntrie_nf:0.0017,kntrie_insert:0.0329,kntrie_erase:0.0122,kntrie_iter:0.0108,kntrie_mem:27736,map_fnd:0.0105,map_nf:0.0094,map_insert:0.0409,map_erase:0.0199,map_iter:0.0081,map_mem:10800,umap_fnd:0.0035,umap_nf:0.0047,umap_insert:0.0146,umap_erase:0.0090,umap_iter:0.0049,umap_mem:7216,kntrie_memneeded:3080},
  {pattern:"random",N:337,kntrie_fnd:0.0033,kntrie_nf:0.0029,kntrie_insert:0.0475,kntrie_erase:0.0141,kntrie_iter:0.0150,kntrie_mem:30808,map_fnd:0.0172,map_nf:0.0153,map_insert:0.0610,map_erase:0.0363,map_iter:0.0083,map_mem:16176,umap_fnd:0.0049,umap_nf:0.0072,umap_insert:0.0179,umap_erase:0.0105,umap_iter:0.0050,umap_mem:10784,kntrie_memneeded:6152},
  {pattern:"random",N:506,kntrie_fnd:0.0051,kntrie_nf:0.0043,kntrie_insert:0.0680,kntrie_erase:0.0193,kntrie_iter:0.0202,kntrie_mem:30808,map_fnd:0.0278,map_nf:0.0261,map_insert:0.0749,map_erase:0.0370,map_iter:0.0108,map_mem:24288,umap_fnd:0.0074,umap_nf:0.0101,umap_insert:0.0180,umap_erase:0.0112,umap_iter:0.0010,umap_mem:16472,kntrie_memneeded:6152},
  {pattern:"random",N:759,kntrie_fnd:0.0086,kntrie_nf:0.0075,kntrie_insert:0.0621,kntrie_erase:0.0251,kntrie_iter:0.0263,kntrie_mem:36952,map_fnd:0.0471,map_nf:0.0421,map_insert:0.0944,map_erase:0.0491,map_iter:0.0088,map_mem:36432,umap_fnd:0.0112,umap_nf:0.0164,umap_insert:0.0267,umap_erase:0.0133,umap_iter:0.0015,umap_mem:24304,kntrie_memneeded:12296},
  {pattern:"random",N:1139,kntrie_fnd:0.0140,kntrie_nf:0.0119,kntrie_insert:0.1037,kntrie_erase:0.0253,kntrie_iter:0.0423,kntrie_mem:49240,map_fnd:0.0777,map_nf:0.0708,map_insert:0.1412,map_erase:0.0753,map_iter:0.0144,map_mem:54672,umap_fnd:0.0164,umap_nf:0.0235,umap_insert:0.0366,umap_erase:0.0174,umap_iter:0.0025,umap_mem:36880,kntrie_memneeded:24584},
  {pattern:"random",N:1708,kntrie_fnd:0.0210,kntrie_nf:0.0181,kntrie_insert:0.1367,kntrie_erase:0.0413,kntrie_iter:0.0631,kntrie_mem:49240,map_fnd:0.1278,map_nf:0.1206,map_insert:0.2146,map_erase:0.1117,map_iter:0.0229,map_mem:81984,umap_fnd:0.0266,umap_nf:0.0378,umap_insert:0.0542,umap_erase:0.0275,umap_iter:0.0049,umap_mem:54920,kntrie_memneeded:24584},
  {pattern:"random",N:2562,kntrie_fnd:0.0373,kntrie_nf:0.0319,kntrie_insert:0.2155,kntrie_erase:0.0639,kntrie_iter:0.1030,kntrie_mem:73816,map_fnd:0.2089,map_nf:0.2003,map_insert:0.3408,map_erase:0.1776,map_iter:0.0338,map_mem:122976,umap_fnd:0.0392,umap_nf:0.0557,umap_insert:0.0773,umap_erase:0.0402,umap_iter:0.0086,umap_mem:83512,kntrie_memneeded:49160},
  {pattern:"random",N:3844,kntrie_fnd:0.0543,kntrie_nf:0.0466,kntrie_insert:0.3907,kntrie_erase:0.1031,kntrie_iter:0.1545,kntrie_mem:73816,map_fnd:0.3435,map_nf:0.3325,map_insert:0.5174,map_erase:0.2674,map_iter:0.0520,map_mem:184512,umap_fnd:0.0649,umap_nf:0.0862,umap_insert:0.1188,umap_erase:0.0637,umap_iter:0.0143,umap_mem:124472,kntrie_memneeded:49160},
  {pattern:"random",N:5766,kntrie_fnd:0.0730,kntrie_nf:0.0662,kntrie_insert:0.7450,kntrie_erase:0.2207,kntrie_iter:0.2072,kntrie_mem:202992,map_fnd:0.5643,map_nf:0.5465,map_insert:0.8302,map_erase:0.4401,map_iter:0.0771,map_mem:276768,umap_fnd:0.1001,umap_nf:0.1376,umap_insert:0.1827,umap_erase:0.0955,umap_iter:0.0233,umap_mem:186008,kntrie_memneeded:99984},
  {pattern:"random",N:8649,kntrie_fnd:0.1480,kntrie_nf:0.1479,kntrie_insert:0.8309,kntrie_erase:0.2448,kntrie_iter:0.3194,kntrie_mem:318616,map_fnd:0.9674,map_nf:0.9371,map_insert:1.3210,map_erase:0.7253,map_iter:0.1180,map_mem:415152,umap_fnd:0.1507,umap_nf:0.2086,umap_insert:0.2733,umap_erase:0.1555,umap_iter:0.0362,umap_mem:277840,kntrie_memneeded:162192},
  {pattern:"random",N:12974,kntrie_fnd:0.1904,kntrie_nf:0.1563,kntrie_insert:1.1812,kntrie_erase:0.3956,kntrie_iter:0.4949,kntrie_mem:403912,map_fnd:1.5715,map_nf:1.5282,map_insert:2.0587,map_erase:1.1494,map_iter:0.1874,map_mem:622752,umap_fnd:0.2311,umap_nf:0.3228,umap_insert:0.4135,umap_erase:0.2378,umap_iter:0.0572,umap_mem:415240,kntrie_memneeded:207504},
  {pattern:"random",N:19461,kntrie_fnd:0.3428,kntrie_nf:0.2954,kntrie_insert:1.7058,kntrie_erase:0.5904,kntrie_iter:0.7868,kntrie_mem:575952,map_fnd:2.6224,map_nf:2.5231,map_insert:3.2969,map_erase:1.8240,map_iter:0.2899,map_mem:934128,umap_fnd:0.3493,umap_nf:0.4828,umap_insert:0.6199,umap_erase:0.3421,umap_iter:0.0908,umap_mem:633088,kntrie_memneeded:379152},
  {pattern:"random",N:29192,kntrie_fnd:0.5757,kntrie_nf:0.4882,kntrie_insert:2.6553,kntrie_erase:0.9215,kntrie_iter:1.1971,kntrie_mem:624336,map_fnd:4.6863,map_nf:4.2747,map_insert:5.4023,map_erase:2.9910,map_iter:0.5876,map_mem:1401216,umap_fnd:0.5457,umap_nf:0.7476,umap_insert:0.9665,umap_erase:0.5823,umap_iter:0.1518,umap_mem:946424,kntrie_memneeded:427536},
  {pattern:"random",N:43789,kntrie_fnd:0.9187,kntrie_nf:0.7828,kntrie_insert:3.8650,kntrie_erase:1.4491,kntrie_iter:1.8987,kntrie_mem:988368,map_fnd:8.2684,map_nf:7.7568,map_insert:8.9010,map_erase:5.3828,map_iter:1.3210,map_mem:2101872,umap_fnd:0.8652,umap_nf:1.1752,umap_insert:1.5352,umap_erase:0.9260,umap_iter:0.2484,umap_mem:1414784,kntrie_memneeded:791568},
  {pattern:"random",N:65684,kntrie_fnd:1.6950,kntrie_nf:1.5428,kntrie_insert:6.4989,kntrie_erase:2.0843,kntrie_iter:2.9593,kntrie_mem:1378512,map_fnd:14.7961,map_nf:13.9244,map_insert:14.6632,map_erase:8.8681,map_iter:2.3412,map_mem:3152832,umap_fnd:1.4528,umap_nf:1.9317,umap_insert:2.4435,umap_erase:1.5802,umap_iter:0.4701,umap_mem:2114872,kntrie_memneeded:1181712},
  {pattern:"random",N:98526,kntrie_fnd:2.7800,kntrie_nf:2.1193,kntrie_insert:9.4427,kntrie_erase:3.7608,kntrie_iter:4.5798,kntrie_mem:1774800,map_fnd:24.8023,map_nf:24.2652,map_insert:24.5416,map_erase:15.3910,map_iter:4.2873,map_mem:4729248,umap_fnd:2.4270,umap_nf:3.2881,umap_insert:4.0878,umap_erase:2.7413,umap_iter:0.8889,umap_mem:3162488,kntrie_memneeded:1578000},
  {pattern:"random",N:147789,kntrie_fnd:6.5779,kntrie_nf:4.1859,kntrie_insert:16.9449,kntrie_erase:5.8550,kntrie_iter:7.3832,kntrie_mem:3335376,map_fnd:44.7367,map_nf:43.0088,map_insert:43.5470,map_erase:26.7932,map_iter:7.2899,map_mem:7093872,umap_fnd:3.8068,umap_nf:4.9926,umap_insert:6.9636,umap_erase:4.6567,umap_iter:1.7269,umap_mem:4729280,kntrie_memneeded:3138576},
  {pattern:"random",N:221683,kntrie_fnd:9.9814,kntrie_nf:6.5390,kntrie_insert:25.4700,kntrie_erase:10.7745,kntrie_iter:11.0695,kntrie_mem:3347664,map_fnd:82.7218,map_nf:82.0413,map_insert:78.5645,map_erase:49.7579,map_iter:13.5318,map_mem:10640784,umap_fnd:5.9243,umap_nf:7.7428,umap_insert:11.7192,umap_erase:7.2500,umap_iter:2.9768,umap_mem:7215568,kntrie_memneeded:3150864},
  {pattern:"random",N:332525,kntrie_fnd:22.9752,kntrie_nf:16.0830,kntrie_insert:48.3618,kntrie_erase:20.7224,kntrie_iter:17.7147,kntrie_mem:6493392,umap_fnd:10.0107,umap_nf:12.4963,umap_insert:20.4364,umap_erase:12.7017,umap_iter:5.5059,umap_mem:10789088,kntrie_memneeded:6296592},
  {pattern:"random",N:498788,kntrie_fnd:31.9423,kntrie_nf:23.4329,kntrie_insert:81.2039,kntrie_erase:32.3089,kntrie_iter:26.3594,kntrie_mem:6591696,umap_fnd:16.1580,umap_nf:19.7039,umap_insert:36.3610,umap_erase:21.2027,umap_iter:9.9763,umap_mem:16132840,kntrie_memneeded:6394896},
  {pattern:"random",N:748182,kntrie_fnd:75.0603,kntrie_nf:55.1612,kntrie_insert:144.3583,kntrie_erase:65.1291,kntrie_iter:42.4016,kntrie_mem:12784848,umap_fnd:26.7646,umap_nf:30.5946,umap_insert:62.2072,umap_erase:34.7363,umap_iter:18.1806,umap_mem:24124760,kntrie_memneeded:12588048},
  {pattern:"random",N:1122274,kntrie_fnd:107.7723,kntrie_nf:70.6301,kntrie_insert:324.6295,kntrie_erase:130.8095,kntrie_iter:53.1234,kntrie_mem:33037352,umap_fnd:49.0797,umap_nf:53.3044,umap_insert:123.2127,umap_erase:79.0806,umap_iter:39.8199,umap_mem:36077144,kntrie_memneeded:20688976},
  {pattern:"random",N:1683411,kntrie_fnd:168.3033,kntrie_nf:106.4425,kntrie_insert:444.7219,kntrie_erase:174.2823,kntrie_iter:86.4657,kntrie_mem:55937952,umap_fnd:76.9224,umap_nf:83.7780,umap_insert:201.5561,umap_erase:128.6493,umap_iter:73.4508,umap_mem:53952736,kntrie_memneeded:28465168},
  {pattern:"random",N:2525116,kntrie_fnd:364.4111,kntrie_nf:278.3656,kntrie_insert:710.5550,kntrie_erase:369.7983,kntrie_iter:142.4625,kntrie_mem:93636008,umap_fnd:135.6823,umap_nf:146.7539,umap_insert:410.4490,umap_erase:261.1985,umap_iter:137.5303,umap_mem:82332776,kntrie_memneeded:47490256},
  {pattern:"random",N:3787675,kntrie_fnd:648.9612,kntrie_nf:427.5513,kntrie_insert:1222.3718,kntrie_erase:597.6316,kntrie_iter:204.7057,kntrie_mem:111496416,umap_fnd:245.8159,umap_nf:270.6417,umap_insert:671.1712,umap_erase:447.3887,umap_iter:231.5497,umap_mem:123112448,kntrie_memneeded:61108240},
  {pattern:"random",N:5681512,kntrie_fnd:1263.2170,kntrie_nf:943.7145,kntrie_insert:1944.2420,kntrie_erase:1168.0382,kntrie_iter:322.2834,kntrie_mem:152055376,umap_fnd:372.7828,umap_nf:430.9582,umap_insert:1041.4476,umap_erase:685.8593,umap_iter:355.0101,umap_mem:184095064,kntrie_memneeded:101661712},
  {pattern:"sequential",N:100,kntrie_fnd:0.0008,kntrie_nf:0.0006,kntrie_insert:0.0125,kntrie_erase:0.0055,kntrie_iter:0.0029,kntrie_mem:26200,map_fnd:0.0039,map_nf:0.0039,map_insert:0.0110,map_erase:0.0069,map_iter:0.0015,map_mem:4800,umap_fnd:0.0003,umap_nf:0.0007,umap_insert:0.0027,umap_erase:0.0014,umap_iter:0.0002,umap_mem:3224,kntrie_memneeded:1544},
  {pattern:"sequential",N:150,kntrie_fnd:0.0013,kntrie_nf:0.0011,kntrie_insert:0.0167,kntrie_erase:0.0068,kntrie_iter:0.0046,kntrie_mem:27736,map_fnd:0.0066,map_nf:0.0064,map_insert:0.0202,map_erase:0.0100,map_iter:0.0019,map_mem:7200,umap_fnd:0.0005,umap_nf:0.0011,umap_insert:0.0052,umap_erase:0.0019,umap_iter:0.0004,umap_mem:4856,kntrie_memneeded:3080},
  {pattern:"sequential",N:225,kntrie_fnd:0.0019,kntrie_nf:0.0016,kntrie_insert:0.0183,kntrie_erase:0.0067,kntrie_iter:0.0066,kntrie_mem:27736,map_fnd:0.0106,map_nf:0.0107,map_insert:0.0283,map_erase:0.0145,map_iter:0.0028,map_mem:10800,umap_fnd:0.0008,umap_nf:0.0016,umap_insert:0.0064,umap_erase:0.0020,umap_iter:0.0004,umap_mem:7216,kntrie_memneeded:3080},
  {pattern:"sequential",N:337,kntrie_fnd:0.0032,kntrie_nf:0.0028,kntrie_insert:0.0291,kntrie_erase:0.0098,kntrie_iter:0.0106,kntrie_mem:30808,map_fnd:0.0170,map_nf:0.0170,map_insert:0.0412,map_erase:0.0200,map_iter:0.0044,map_mem:16176,umap_fnd:0.0012,umap_nf:0.0024,umap_insert:0.0088,umap_erase:0.0028,umap_iter:0.0006,umap_mem:10784,kntrie_memneeded:6152},
  {pattern:"sequential",N:506,kntrie_fnd:0.0049,kntrie_nf:0.0043,kntrie_insert:0.0534,kntrie_erase:0.0139,kntrie_iter:0.0158,kntrie_mem:30808,map_fnd:0.0276,map_nf:0.0276,map_insert:0.0611,map_erase:0.0301,map_iter:0.0053,map_mem:24288,umap_fnd:0.0018,umap_nf:0.0039,umap_insert:0.0125,umap_erase:0.0037,umap_iter:0.0010,umap_mem:16472,kntrie_memneeded:6152},
  {pattern:"sequential",N:759,kntrie_fnd:0.0082,kntrie_nf:0.0072,kntrie_insert:0.0622,kntrie_erase:0.0240,kntrie_iter:0.0263,kntrie_mem:36952,map_fnd:0.0451,map_nf:0.0454,map_insert:0.0935,map_erase:0.0499,map_iter:0.0089,map_mem:36432,umap_fnd:0.0027,umap_nf:0.0054,umap_insert:0.0171,umap_erase:0.0058,umap_iter:0.0015,umap_mem:24304,kntrie_memneeded:12296},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0149,kntrie_nf:0.0133,kntrie_insert:0.0955,kntrie_erase:0.0259,kntrie_iter:0.0435,kntrie_mem:49240,map_fnd:0.0872,map_nf:0.0876,map_insert:0.1459,map_erase:0.0954,map_iter:0.0153,map_mem:54672,umap_fnd:0.0044,umap_nf:0.0096,umap_insert:0.0388,umap_erase:0.0135,umap_iter:0.0026,umap_mem:36880,kntrie_memneeded:24584},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0312,kntrie_nf:0.0283,kntrie_insert:0.1727,kntrie_erase:0.0566,kntrie_iter:0.0648,kntrie_mem:49240,map_fnd:0.1602,map_nf:0.1608,map_insert:0.2819,map_erase:0.1253,map_iter:0.0257,map_mem:81984,umap_fnd:0.0072,umap_nf:0.0139,umap_insert:0.0571,umap_erase:0.0211,umap_iter:0.0035,umap_mem:54920,kntrie_memneeded:24584},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0368,kntrie_nf:0.0311,kntrie_insert:0.2730,kntrie_erase:0.0676,kntrie_iter:0.1030,kntrie_mem:73816,map_fnd:0.2127,map_nf:0.2141,map_insert:0.3347,map_erase:0.1752,map_iter:0.0339,map_mem:122976,umap_fnd:0.0091,umap_nf:0.0208,umap_insert:0.0473,umap_erase:0.0191,umap_iter:0.0049,umap_mem:83512,kntrie_memneeded:49160},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0548,kntrie_nf:0.0473,kntrie_insert:0.3241,kntrie_erase:0.0998,kntrie_iter:0.1551,kntrie_mem:73816,map_fnd:0.3426,map_nf:0.3424,map_insert:0.5321,map_erase:0.2969,map_iter:0.0505,map_mem:184512,umap_fnd:0.0137,umap_nf:0.0307,umap_insert:0.0707,umap_erase:0.0287,umap_iter:0.0073,umap_mem:124472,kntrie_memneeded:49160},
  {pattern:"sequential",N:5766,kntrie_fnd:0.2099,kntrie_nf:0.1781,kntrie_insert:0.6478,kntrie_erase:0.1448,kntrie_iter:0.2200,kntrie_mem:101728,map_fnd:0.5635,map_nf:0.5672,map_insert:0.8244,map_erase:0.4475,map_iter:0.0746,map_mem:276768,umap_fnd:0.0210,umap_nf:0.0457,umap_insert:0.1010,umap_erase:0.0442,umap_iter:0.0106,umap_mem:186008,kntrie_memneeded:36128},
  {pattern:"sequential",N:8649,kntrie_fnd:0.3178,kntrie_nf:0.2701,kntrie_insert:0.7978,kntrie_erase:0.2239,kntrie_iter:0.3095,kntrie_mem:168400,map_fnd:0.9657,map_nf:0.9400,map_insert:1.3324,map_erase:0.7235,map_iter:0.1236,map_mem:415152,umap_fnd:0.0317,umap_nf:0.0677,umap_insert:0.1560,umap_erase:0.0699,umap_iter:0.0155,umap_mem:277840,kntrie_memneeded:53936},
  {pattern:"sequential",N:12974,kntrie_fnd:0.4712,kntrie_nf:0.3968,kntrie_insert:1.0263,kntrie_erase:0.3399,kntrie_iter:0.4682,kntrie_mem:277536,map_fnd:1.5639,map_nf:1.5277,map_insert:2.0500,map_erase:1.1185,map_iter:0.1849,map_mem:622752,umap_fnd:0.0453,umap_nf:0.0990,umap_insert:0.2221,umap_erase:0.1037,umap_iter:0.0229,umap_mem:415240,kntrie_memneeded:81008},
  {pattern:"sequential",N:19461,kntrie_fnd:0.7117,kntrie_nf:0.5935,kntrie_insert:1.4288,kntrie_erase:0.5029,kntrie_iter:0.7158,kntrie_mem:375376,map_fnd:2.5810,map_nf:2.5121,map_insert:3.2434,map_erase:1.8043,map_iter:0.2801,map_mem:934128,umap_fnd:0.0675,umap_nf:0.1581,umap_insert:0.3321,umap_erase:0.1601,umap_iter:0.0343,umap_mem:633088,kntrie_memneeded:121280},
  {pattern:"sequential",N:29192,kntrie_fnd:1.0898,kntrie_nf:0.9029,kntrie_insert:2.0348,kntrie_erase:0.7722,kntrie_iter:1.0535,kntrie_mem:599872,map_fnd:4.5164,map_nf:4.3517,map_insert:5.2548,map_erase:3.0053,map_iter:0.5833,map_mem:1401216,umap_fnd:0.1111,umap_nf:0.2360,umap_insert:0.5137,umap_erase:0.2591,umap_iter:0.0521,umap_mem:946424,kntrie_memneeded:181936},
  {pattern:"sequential",N:43789,kntrie_fnd:1.6582,kntrie_nf:1.3707,kntrie_insert:3.6583,kntrie_erase:1.3774,kntrie_iter:1.7746,kntrie_mem:804736,map_fnd:8.1430,map_nf:8.0090,map_insert:8.6352,map_erase:5.2134,map_iter:1.2446,map_mem:2101872,umap_fnd:0.2232,umap_nf:0.3645,umap_insert:0.7521,umap_erase:0.4584,umap_iter:0.0799,umap_mem:1414784,kntrie_memneeded:272480},
  {pattern:"sequential",N:65684,kntrie_fnd:2.5769,kntrie_nf:2.1112,kntrie_insert:5.3342,kntrie_erase:2.1436,kntrie_iter:2.7281,kntrie_mem:1265480,map_fnd:14.4090,map_nf:13.9886,map_insert:14.5176,map_erase:8.7713,map_iter:2.3246,map_mem:3152832,umap_fnd:0.4958,umap_nf:0.6798,umap_insert:1.1778,umap_erase:0.8856,umap_iter:0.1214,umap_mem:2114872,kntrie_memneeded:409512},
  {pattern:"sequential",N:98526,kntrie_fnd:3.9445,kntrie_nf:3.2487,kntrie_insert:7.9567,kntrie_erase:3.2739,kntrie_iter:4.0097,kntrie_mem:1977208,map_fnd:26.6242,map_nf:24.1726,map_insert:25.2331,map_erase:14.7964,map_iter:4.2761,map_mem:4729248,umap_fnd:0.9394,umap_nf:1.1729,umap_insert:1.9370,umap_erase:1.6228,umap_iter:0.1950,umap_mem:3162488,kntrie_memneeded:613304},
  {pattern:"sequential",N:147789,kntrie_fnd:6.3072,kntrie_nf:5.3722,kntrie_insert:12.1899,kntrie_erase:5.0007,kntrie_iter:6.0120,kntrie_mem:3077584,map_fnd:43.5981,map_nf:44.6927,map_insert:43.1284,map_erase:27.4414,map_iter:7.1048,map_mem:7093872,umap_fnd:1.5502,umap_nf:1.9481,umap_insert:3.1609,umap_erase:2.9591,umap_iter:0.3912,umap_mem:4729280,kntrie_memneeded:919408},
  {pattern:"sequential",N:221683,kntrie_fnd:9.2346,kntrie_nf:7.5264,kntrie_insert:18.5591,kntrie_erase:7.5159,kntrie_iter:8.9759,kntrie_mem:4781840,map_fnd:80.6637,map_nf:80.1072,map_insert:72.6035,map_erase:47.2400,map_iter:12.2355,map_mem:10640784,umap_fnd:2.4829,umap_nf:3.0834,umap_insert:5.2543,umap_erase:4.5206,umap_iter:0.5572,umap_mem:7215568,kntrie_memneeded:1378608},
  {pattern:"sequential",N:332525,kntrie_fnd:15.9499,kntrie_nf:12.1418,kntrie_insert:28.9908,kntrie_erase:12.0367,kntrie_iter:13.7627,kntrie_mem:6335360,umap_fnd:5.0934,umap_nf:5.4051,umap_insert:10.0313,umap_erase:8.7844,umap_iter:1.4488,umap_mem:10789088,kntrie_memneeded:2068240},
  {pattern:"sequential",N:498788,kntrie_fnd:25.4208,kntrie_nf:18.5891,kntrie_insert:48.0959,kntrie_erase:20.5328,kntrie_iter:21.4707,kntrie_mem:9802272,umap_fnd:8.5670,umap_nf:8.0943,umap_insert:18.3281,umap_erase:13.3290,umap_iter:2.4935,umap_mem:16132840,kntrie_memneeded:3102416},
  {pattern:"sequential",N:748182,kntrie_fnd:44.6991,kntrie_nf:27.4805,kntrie_insert:83.3468,kntrie_erase:33.8746,kntrie_iter:31.6797,kntrie_mem:15159168,umap_fnd:15.1263,umap_nf:12.7156,umap_insert:28.1641,umap_erase:21.9319,umap_iter:3.9539,umap_mem:24124760,kntrie_memneeded:4653152},
  {pattern:"sequential",N:1122274,kntrie_fnd:69.3225,kntrie_nf:45.7148,kntrie_insert:131.3269,kntrie_erase:62.4914,kntrie_iter:47.5971,kntrie_mem:23438112,umap_fnd:23.5940,umap_nf:21.8055,umap_insert:48.1444,umap_erase:35.1156,umap_iter:5.9670,umap_mem:36077144,kntrie_memneeded:6980432},
  {pattern:"sequential",N:1683411,kntrie_fnd:124.5876,kntrie_nf:71.7756,kntrie_insert:217.2499,kntrie_erase:104.4331,kntrie_iter:72.0358,kntrie_mem:36229952,umap_fnd:38.2426,umap_nf:32.3944,umap_insert:76.3899,umap_erase:76.7729,umap_iter:9.0707,umap_mem:53952736,kntrie_memneeded:10470064},
  {pattern:"sequential",N:2525116,kntrie_fnd:216.6489,kntrie_nf:127.5189,kntrie_insert:363.4089,kntrie_erase:179.0413,kntrie_iter:107.2229,kntrie_mem:47924984,umap_fnd:69.4241,umap_nf:75.6452,umap_insert:146.2807,umap_erase:159.7169,umap_iter:14.0930,umap_mem:82332776,kntrie_memneeded:15705304},
  {pattern:"sequential",N:3787675,kntrie_fnd:427.7479,kntrie_nf:230.6867,kntrie_insert:608.1870,kntrie_erase:297.5734,kntrie_iter:161.5762,kntrie_mem:73951232,umap_fnd:151.0331,umap_nf:158.2502,umap_insert:267.9440,umap_erase:309.3523,umap_iter:21.8246,umap_mem:123112448,kntrie_memneeded:23557776},
  {pattern:"sequential",N:5681512,kntrie_fnd:647.5657,kntrie_nf:373.8088,kntrie_insert:1173.5927,kntrie_erase:541.3806,kntrie_iter:244.2515,kntrie_mem:114123088,umap_fnd:230.0571,umap_nf:257.1500,umap_insert:503.0315,umap_erase:518.2511,umap_iter:33.0250,umap_mem:184095064,kntrie_memneeded:35336464},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "kntrie", suffix: "memneeded", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie needed" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const LINES_ITER = [
  { key: "kntrie", suffix: "iter", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "iter", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "iter", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "iter",   lines: LINES_ITER,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64)</h2>
  <p class="sub">Log-log · Per-entry · Lower is better · FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Iteration (ns/entry)</h3><canvas id="c_iter"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0006,kntrie_nf:0.0006,kntrie_insert:0.0116,kntrie_erase:0.0045,kntrie_iter:0.0026,kntrie_mem:2056,map_fnd:0.0034,map_nf:0.0023,map_insert:0.0124,map_erase:0.0069,map_iter:0.0012,map_mem:4800,umap_fnd:0.0013,umap_nf:0.0018,umap_insert:0.0038,umap_erase:0.0025,umap_iter:0.0002,umap_mem:3224},
  {pattern:"random",N:150,kntrie_fnd:0.0011,kntrie_nf:0.0011,kntrie_insert:0.0127,kntrie_erase:0.0061,kntrie_iter:0.0041,kntrie_mem:4104,map_fnd:0.0056,map_nf:0.0040,map_insert:0.0166,map_erase:0.0096,map_iter:0.0017,map_mem:7200,umap_fnd:0.0019,umap_nf:0.0021,umap_insert:0.0060,umap_erase:0.0030,umap_iter:0.0003,umap_mem:4856},
  {pattern:"random",N:225,kntrie_fnd:0.0018,kntrie_nf:0.0015,kntrie_insert:0.0165,kntrie_erase:0.0073,kntrie_iter:0.0059,kntrie_mem:4104,map_fnd:0.0093,map_nf:0.0070,map_insert:0.0242,map_erase:0.0131,map_iter:0.0026,map_mem:10800,umap_fnd:0.0030,umap_nf:0.0039,umap_insert:0.0082,umap_erase:0.0044,umap_iter:0.0004,umap_mem:7216},
  {pattern:"random",N:337,kntrie_fnd:0.0029,kntrie_nf:0.0028,kntrie_insert:0.0213,kntrie_erase:0.0091,kntrie_iter:0.0094,kntrie_mem:8200,map_fnd:0.0148,map_nf:0.0115,map_insert:0.0360,map_erase:0.0192,map_iter:0.0037,map_mem:16176,umap_fnd:0.0042,umap_nf:0.0062,umap_insert:0.0118,umap_erase:0.0054,umap_iter:0.0006,umap_mem:10784},
  {pattern:"random",N:506,kntrie_fnd:0.0039,kntrie_nf:0.0042,kntrie_insert:0.0402,kntrie_erase:0.0125,kntrie_iter:0.0138,kntrie_mem:8200,map_fnd:0.0238,map_nf:0.0180,map_insert:0.0535,map_erase:0.0274,map_iter:0.0050,map_mem:24288,umap_fnd:0.0060,umap_nf:0.0086,umap_insert:0.0159,umap_erase:0.0071,umap_iter:0.0008,umap_mem:16472},
  {pattern:"random",N:759,kntrie_fnd:0.0067,kntrie_nf:0.0062,kntrie_insert:0.0482,kntrie_erase:0.0186,kntrie_iter:0.0226,kntrie_mem:16392,map_fnd:0.0401,map_nf:0.0302,map_insert:0.0808,map_erase:0.0431,map_iter:0.0079,map_mem:36432,umap_fnd:0.0096,umap_nf:0.0141,umap_insert:0.0234,umap_erase:0.0106,umap_iter:0.0013,umap_mem:24304},
  {pattern:"random",N:1139,kntrie_fnd:0.0110,kntrie_nf:0.0100,kntrie_insert:0.0703,kntrie_erase:0.0193,kntrie_iter:0.0370,kntrie_mem:32776,map_fnd:0.0673,map_nf:0.0551,map_insert:0.1218,map_erase:0.0655,map_iter:0.0124,map_mem:54672,umap_fnd:0.0147,umap_nf:0.0200,umap_insert:0.0310,umap_erase:0.0141,umap_iter:0.0023,umap_mem:36880},
  {pattern:"random",N:1708,kntrie_fnd:0.0162,kntrie_nf:0.0150,kntrie_insert:0.1051,kntrie_erase:0.0352,kntrie_iter:0.0554,kntrie_mem:32776,map_fnd:0.1109,map_nf:0.0944,map_insert:0.1854,map_erase:0.0984,map_iter:0.0190,map_mem:81984,umap_fnd:0.0233,umap_nf:0.0324,umap_insert:0.0448,umap_erase:0.0229,umap_iter:0.0043,umap_mem:54920},
  {pattern:"random",N:2562,kntrie_fnd:0.0294,kntrie_nf:0.0260,kntrie_insert:0.1695,kntrie_erase:0.0540,kntrie_iter:0.0902,kntrie_mem:65544,map_fnd:0.1846,map_nf:0.1648,map_insert:0.2958,map_erase:0.1528,map_iter:0.0287,map_mem:122976,umap_fnd:0.0350,umap_nf:0.0494,umap_insert:0.0672,umap_erase:0.0341,umap_iter:0.0073,umap_mem:83512},
  {pattern:"random",N:3844,kntrie_fnd:0.0436,kntrie_nf:0.0400,kntrie_insert:0.3112,kntrie_erase:0.0846,kntrie_iter:0.1352,kntrie_mem:65544,map_fnd:0.3019,map_nf:0.2899,map_insert:0.4573,map_erase:0.2580,map_iter:0.0438,map_mem:184512,umap_fnd:0.0562,umap_nf:0.0755,umap_insert:0.1003,umap_erase:0.0550,umap_iter:0.0126,umap_mem:124472},
  {pattern:"random",N:5766,kntrie_fnd:0.0631,kntrie_nf:0.0569,kntrie_insert:0.5206,kntrie_erase:0.1637,kntrie_iter:0.1829,kntrie_mem:131600,map_fnd:0.4952,map_nf:0.4788,map_insert:0.7508,map_erase:0.3974,map_iter:0.0678,map_mem:276768,umap_fnd:0.0880,umap_nf:0.1209,umap_insert:0.1631,umap_erase:0.0821,umap_iter:0.0208,umap_mem:186008},
  {pattern:"random",N:8649,kntrie_fnd:0.1279,kntrie_nf:0.1287,kntrie_insert:0.6806,kntrie_erase:0.2336,kntrie_iter:0.2813,kntrie_mem:214544,map_fnd:0.8385,map_nf:0.8055,map_insert:1.1704,map_erase:0.6294,map_iter:0.1024,map_mem:415152,umap_fnd:0.1335,umap_nf:0.1788,umap_insert:0.2366,umap_erase:0.1297,umap_iter:0.0328,umap_mem:277840},
  {pattern:"random",N:12974,kntrie_fnd:0.1558,kntrie_nf:0.1345,kntrie_insert:0.9695,kntrie_erase:0.3655,kntrie_iter:0.4381,kntrie_mem:274960,map_fnd:1.3697,map_nf:1.3305,map_insert:1.8425,map_erase:1.0151,map_iter:0.1647,map_mem:622752,umap_fnd:0.2052,umap_nf:0.2829,umap_insert:0.3518,umap_erase:0.1977,umap_iter:0.0513,umap_mem:415240},
  {pattern:"random",N:19461,kntrie_fnd:0.2938,kntrie_nf:0.2612,kntrie_insert:1.4123,kntrie_erase:0.5040,kntrie_iter:0.6838,kntrie_mem:503824,map_fnd:2.3486,map_nf:2.2355,map_insert:2.9421,map_erase:1.6052,map_iter:0.2879,map_mem:934128,umap_fnd:0.3084,umap_nf:0.4095,umap_insert:0.5181,umap_erase:0.2982,umap_iter:0.0812,umap_mem:633088},
  {pattern:"random",N:29192,kntrie_fnd:0.4559,kntrie_nf:0.3872,kntrie_insert:2.2592,kntrie_erase:0.8024,kntrie_iter:1.0468,kntrie_mem:568336,map_fnd:4.7344,map_nf:4.0485,map_insert:4.9630,map_erase:2.9009,map_iter:0.7785,map_mem:1401216,umap_fnd:0.4781,umap_nf:0.6624,umap_insert:0.8255,umap_erase:0.4755,umap_iter:0.1364,umap_mem:946424},
  {pattern:"random",N:43789,kntrie_fnd:0.7651,kntrie_nf:0.6680,kntrie_insert:3.1280,kntrie_erase:1.3710,kntrie_iter:1.6836,kntrie_mem:1053712,map_fnd:8.7964,map_nf:7.8886,map_insert:8.3891,map_erase:5.2665,map_iter:1.8249,map_mem:2101872,umap_fnd:0.8073,umap_nf:1.0717,umap_insert:1.3086,umap_erase:0.8707,umap_iter:0.2543,umap_mem:1414784},
  {pattern:"random",N:65684,kntrie_fnd:1.7964,kntrie_nf:1.3513,kntrie_insert:5.4299,kntrie_erase:2.1733,kntrie_iter:2.6575,kntrie_mem:1573904,map_fnd:17.7771,map_nf:16.4618,map_insert:15.8368,map_erase:9.7608,map_iter:3.4411,map_mem:3152832,umap_fnd:1.4877,umap_nf:1.9047,umap_insert:2.5325,umap_erase:1.9489,umap_iter:0.4833,umap_mem:2114872},
  {pattern:"random",N:98526,kntrie_fnd:3.2135,kntrie_nf:1.9416,kntrie_insert:7.9643,kntrie_erase:4.0376,kntrie_iter:4.0367,kntrie_mem:2102288,map_fnd:31.6738,map_nf:30.6493,map_insert:26.8680,map_erase:17.3084,map_iter:5.3858,map_mem:4729248,umap_fnd:2.5073,umap_nf:3.1128,umap_insert:4.7390,umap_erase:3.3244,umap_iter:1.1905,umap_mem:3162488},
  {pattern:"random",N:147789,kntrie_fnd:8.3142,kntrie_nf:4.9523,kntrie_insert:14.7951,kntrie_erase:6.8022,kntrie_iter:6.5628,kntrie_mem:4183056,map_fnd:60.4126,map_nf:55.4773,map_insert:48.2761,map_erase:31.5567,map_iter:9.8403,map_mem:7093872,umap_fnd:4.2319,umap_nf:5.3610,umap_insert:8.8003,umap_erase:5.8167,umap_iter:2.5291,umap_mem:4729280},
  {pattern:"random",N:221683,kntrie_fnd:11.0072,kntrie_nf:6.8800,kntrie_insert:23.4655,kntrie_erase:13.3047,kntrie_iter:9.7786,kntrie_mem:4199440,map_fnd:107.2955,map_nf:105.1679,map_insert:90.0069,map_erase:58.2659,map_iter:16.9423,map_mem:10640784,umap_fnd:6.3296,umap_nf:7.9566,umap_insert:13.5033,umap_erase:8.6126,umap_iter:3.9238,umap_mem:7215568},
  {pattern:"random",N:332525,kntrie_fnd:27.9127,kntrie_nf:19.5694,kntrie_insert:45.7588,kntrie_erase:24.6956,kntrie_iter:15.7190,kntrie_mem:8393744,map_fnd:172.7613,map_nf:173.6882,map_insert:147.4176,map_erase:95.3822,map_iter:24.5602,map_mem:15961200,umap_fnd:10.6052,umap_nf:12.8385,umap_insert:23.5300,umap_erase:14.9172,umap_iter:7.3463,umap_mem:10789088},
  {pattern:"random",N:498788,kntrie_fnd:38.7144,kntrie_nf:26.0419,kntrie_insert:87.6115,kntrie_erase:40.0250,kntrie_iter:23.4438,kntrie_mem:8524816,map_fnd:295.1478,map_nf:293.3127,map_insert:256.5564,map_erase:156.2195,map_iter:40.7969,map_mem:23941824,umap_fnd:16.1518,umap_nf:19.7746,umap_insert:38.3357,umap_erase:22.4655,umap_iter:11.8204,umap_mem:16132840},
  {pattern:"random",N:748182,kntrie_fnd:97.8029,kntrie_nf:74.5028,kntrie_insert:165.0617,kntrie_erase:84.5905,kntrie_iter:37.3773,kntrie_mem:16782352,map_fnd:592.5661,map_nf:574.7265,map_insert:483.7762,map_erase:261.4765,map_iter:69.2774,map_mem:35912736,umap_fnd:27.5450,umap_nf:33.9021,umap_insert:64.3617,umap_erase:40.5205,umap_iter:21.8912,umap_mem:24124760},
  {pattern:"random",N:1122274,kntrie_fnd:86.4114,kntrie_nf:77.5460,kntrie_insert:328.9679,kntrie_erase:55.2693,kntrie_iter:43.4805,kntrie_mem:27146000,umap_fnd:42.3376,umap_nf:50.5123,umap_insert:104.0138,umap_erase:65.6130,umap_iter:33.8954,umap_mem:36077144},
  {pattern:"random",N:1683411,kntrie_fnd:135.5286,kntrie_nf:122.9655,kntrie_insert:448.4141,kntrie_erase:175.7358,kntrie_iter:70.0548,kntrie_mem:37514256,umap_fnd:68.8573,umap_nf:79.3758,umap_insert:170.7244,umap_erase:99.5495,umap_iter:54.9183,umap_mem:53952736},
  {pattern:"random",N:2525116,kntrie_fnd:269.6611,kntrie_nf:226.1800,kntrie_insert:665.4673,kntrie_erase:314.1985,kntrie_iter:119.0359,kntrie_mem:62881040,umap_fnd:109.7516,umap_nf:117.3600,umap_insert:254.2656,umap_erase:149.6998,umap_iter:85.9672,umap_mem:82332776},
  {pattern:"random",N:3787675,kntrie_fnd:509.0651,kntrie_nf:415.2360,kntrie_insert:1025.0764,kntrie_erase:490.1939,kntrie_iter:178.8130,kntrie_mem:81038352,umap_fnd:202.2203,umap_nf:199.0346,umap_insert:428.5331,umap_erase:281.5429,umap_iter:168.3225,umap_mem:123112448},
  {pattern:"random",N:5681512,kntrie_fnd:931.5501,kntrie_nf:670.1630,kntrie_insert:1603.3230,kntrie_erase:903.7216,kntrie_iter:275.0461,kntrie_mem:135109648,umap_fnd:360.8650,umap_nf:373.2446,umap_insert:801.2621,umap_erase:537.9123,umap_iter:334.3976,umap_mem:184095064},
  {pattern:"sequential",N:100,kntrie_fnd:0.0007,kntrie_nf:0.0006,kntrie_insert:0.0095,kntrie_erase:0.0043,kntrie_iter:0.0025,kntrie_mem:2056,map_fnd:0.0035,map_nf:0.0032,map_insert:0.0100,map_erase:0.0067,map_iter:0.0011,map_mem:4800,umap_fnd:0.0003,umap_nf:0.0007,umap_insert:0.0037,umap_erase:0.0016,umap_iter:0.0002,umap_mem:3224},
  {pattern:"sequential",N:150,kntrie_fnd:0.0010,kntrie_nf:0.0011,kntrie_insert:0.0116,kntrie_erase:0.0055,kntrie_iter:0.0040,kntrie_mem:4104,map_fnd:0.0058,map_nf:0.0051,map_insert:0.0174,map_erase:0.0092,map_iter:0.0017,map_mem:7200,umap_fnd:0.0005,umap_nf:0.0010,umap_insert:0.0042,umap_erase:0.0024,umap_iter:0.0003,umap_mem:4856},
  {pattern:"sequential",N:225,kntrie_fnd:0.0015,kntrie_nf:0.0016,kntrie_insert:0.0143,kntrie_erase:0.0062,kntrie_iter:0.0058,kntrie_mem:4104,map_fnd:0.0094,map_nf:0.0085,map_insert:0.0245,map_erase:0.0126,map_iter:0.0022,map_mem:10800,umap_fnd:0.0007,umap_nf:0.0014,umap_insert:0.0056,umap_erase:0.0025,umap_iter:0.0004,umap_mem:7216},
  {pattern:"sequential",N:337,kntrie_fnd:0.0027,kntrie_nf:0.0028,kntrie_insert:0.0227,kntrie_erase:0.0091,kntrie_iter:0.0094,kntrie_mem:8200,map_fnd:0.0149,map_nf:0.0134,map_insert:0.0359,map_erase:0.0188,map_iter:0.0034,map_mem:16176,umap_fnd:0.0011,umap_nf:0.0021,umap_insert:0.0074,umap_erase:0.0030,umap_iter:0.0006,umap_mem:10784},
  {pattern:"sequential",N:506,kntrie_fnd:0.0041,kntrie_nf:0.0041,kntrie_insert:0.0372,kntrie_erase:0.0116,kntrie_iter:0.0140,kntrie_mem:8200,map_fnd:0.0239,map_nf:0.0217,map_insert:0.0541,map_erase:0.0294,map_iter:0.0051,map_mem:24288,umap_fnd:0.0016,umap_nf:0.0035,umap_insert:0.0106,umap_erase:0.0042,umap_iter:0.0009,umap_mem:16472},
  {pattern:"sequential",N:759,kntrie_fnd:0.0068,kntrie_nf:0.0062,kntrie_insert:0.0500,kntrie_erase:0.0186,kntrie_iter:0.0228,kntrie_mem:16392,map_fnd:0.0400,map_nf:0.0365,map_insert:0.0824,map_erase:0.0432,map_iter:0.0079,map_mem:36432,umap_fnd:0.0024,umap_nf:0.0048,umap_insert:0.0153,umap_erase:0.0056,umap_iter:0.0013,umap_mem:24304},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0107,kntrie_nf:0.0105,kntrie_insert:0.0791,kntrie_erase:0.0207,kntrie_iter:0.0368,kntrie_mem:32776,map_fnd:0.0671,map_nf:0.0625,map_insert:0.1234,map_erase:0.0636,map_iter:0.0123,map_mem:54672,umap_fnd:0.0035,umap_nf:0.0075,umap_insert:0.0197,umap_erase:0.0061,umap_iter:0.0020,umap_mem:36880},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0166,kntrie_nf:0.0159,kntrie_insert:0.1071,kntrie_erase:0.0359,kntrie_iter:0.0553,kntrie_mem:32776,map_fnd:0.1114,map_nf:0.1062,map_insert:0.1891,map_erase:0.0979,map_iter:0.0199,map_mem:81984,umap_fnd:0.0052,umap_nf:0.0115,umap_insert:0.0290,umap_erase:0.0108,umap_iter:0.0030,umap_mem:54920},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0294,kntrie_nf:0.0272,kntrie_insert:0.1913,kntrie_erase:0.0543,kntrie_iter:0.0900,kntrie_mem:65544,map_fnd:0.1838,map_nf:0.1774,map_insert:0.2993,map_erase:0.1574,map_iter:0.0297,map_mem:122976,umap_fnd:0.0079,umap_nf:0.0184,umap_insert:0.0412,umap_erase:0.0173,umap_iter:0.0044,umap_mem:83512},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0445,kntrie_nf:0.0390,kntrie_insert:0.2686,kntrie_erase:0.0817,kntrie_iter:0.1351,kntrie_mem:65544,map_fnd:0.3069,map_nf:0.2989,map_insert:0.4680,map_erase:0.2618,map_iter:0.0476,map_mem:184512,umap_fnd:0.0122,umap_nf:0.0268,umap_insert:0.0624,umap_erase:0.0268,umap_iter:0.0064,umap_mem:124472},
  {pattern:"sequential",N:5766,kntrie_fnd:0.1757,kntrie_nf:0.1476,kntrie_insert:0.4972,kntrie_erase:0.0960,kntrie_iter:0.1896,kntrie_mem:70720,map_fnd:0.5037,map_nf:0.4895,map_insert:0.7465,map_erase:0.3942,map_iter:0.0696,map_mem:276768,umap_fnd:0.0186,umap_nf:0.0404,umap_insert:0.0894,umap_erase:0.0375,umap_iter:0.0094,umap_mem:186008},
  {pattern:"sequential",N:8649,kntrie_fnd:0.2702,kntrie_nf:0.2254,kntrie_insert:0.6872,kntrie_erase:0.2176,kntrie_iter:0.2987,kntrie_mem:105792,map_fnd:0.8378,map_nf:0.8166,map_insert:1.1781,map_erase:0.6545,map_iter:0.1109,map_mem:415152,umap_fnd:0.0278,umap_nf:0.0596,umap_insert:0.1325,umap_erase:0.0640,umap_iter:0.0139,umap_mem:277840},
  {pattern:"sequential",N:12974,kntrie_fnd:0.4050,kntrie_nf:0.3326,kntrie_insert:0.9648,kntrie_erase:0.3097,kntrie_iter:0.4452,kntrie_mem:158816,map_fnd:1.4420,map_nf:1.3967,map_insert:1.9446,map_erase:1.0411,map_iter:0.1700,map_mem:622752,umap_fnd:0.0419,umap_nf:0.0865,umap_insert:0.1945,umap_erase:0.0887,umap_iter:0.0206,umap_mem:415240},
  {pattern:"sequential",N:19461,kntrie_fnd:0.6131,kntrie_nf:0.5045,kntrie_insert:1.2769,kntrie_erase:0.4791,kntrie_iter:0.6397,kntrie_mem:238048,map_fnd:2.4224,map_nf:2.3163,map_insert:3.0112,map_erase:1.6084,map_iter:0.2842,map_mem:934128,umap_fnd:0.0608,umap_nf:0.1374,umap_insert:0.2781,umap_erase:0.1349,umap_iter:0.0305,umap_mem:633088},
  {pattern:"sequential",N:29192,kntrie_fnd:0.9263,kntrie_nf:0.7547,kntrie_insert:1.8861,kntrie_erase:0.7446,kntrie_iter:0.9670,kntrie_mem:357056,map_fnd:4.3775,map_nf:4.3730,map_insert:4.8440,map_erase:2.8941,map_iter:0.6387,map_mem:1401216,umap_fnd:0.0978,umap_nf:0.2112,umap_insert:0.4490,umap_erase:0.2248,umap_iter:0.0488,umap_mem:946424},
  {pattern:"sequential",N:43789,kntrie_fnd:1.4262,kntrie_nf:1.1633,kntrie_insert:3.2754,kntrie_erase:1.2933,kntrie_iter:1.6191,kntrie_mem:535264,map_fnd:8.7577,map_nf:8.8233,map_insert:8.4149,map_erase:5.3960,map_iter:1.7179,map_mem:2101872,umap_fnd:0.2460,umap_nf:0.4179,umap_insert:0.6708,umap_erase:0.5592,umap_iter:0.0788,umap_mem:1414784},
  {pattern:"sequential",N:65684,kntrie_fnd:2.1845,kntrie_nf:1.7708,kntrie_insert:4.8201,kntrie_erase:1.9846,kntrie_iter:2.4080,kntrie_mem:803768,map_fnd:16.6632,map_nf:16.3634,map_insert:14.5724,map_erase:9.2802,map_iter:3.3109,map_mem:3152832,umap_fnd:0.5720,umap_nf:0.8117,umap_insert:1.0191,umap_erase:1.1009,umap_iter:0.1234,umap_mem:2114872},
  {pattern:"sequential",N:98526,kntrie_fnd:3.4738,kntrie_nf:2.7167,kntrie_insert:7.3785,kntrie_erase:3.0691,kntrie_iter:3.6509,kntrie_mem:1204168,map_fnd:29.1507,map_nf:29.3775,map_insert:27.2741,map_erase:17.5960,map_iter:5.2377,map_mem:4729248,umap_fnd:1.2284,umap_nf:1.5679,umap_insert:2.1185,umap_erase:2.0652,umap_iter:0.1906,umap_mem:3162488},
  {pattern:"sequential",N:147789,kntrie_fnd:5.4148,kntrie_nf:4.1241,kntrie_insert:11.3406,kntrie_erase:4.6652,kntrie_iter:5.3947,kntrie_mem:1806096,map_fnd:53.9486,map_nf:53.7743,map_insert:46.8778,map_erase:31.1028,map_iter:9.2260,map_mem:7093872,umap_fnd:1.7421,umap_nf:2.3675,umap_insert:3.5134,umap_erase:3.7116,umap_iter:0.2952,umap_mem:4729280},
  {pattern:"sequential",N:221683,kntrie_fnd:9.5979,kntrie_nf:6.3385,kntrie_insert:17.9590,kntrie_erase:7.7358,kntrie_iter:8.1295,kntrie_mem:2708512,map_fnd:94.7356,map_nf:93.1076,map_insert:82.4919,map_erase:54.2589,map_iter:15.8672,map_mem:10640784,umap_fnd:2.9734,umap_nf:3.9520,umap_insert:6.3355,umap_erase:5.4409,umap_iter:0.4317,umap_mem:7215568},
  {pattern:"sequential",N:332525,kntrie_fnd:16.4587,kntrie_nf:9.6061,kntrie_insert:29.6739,kntrie_erase:14.1090,kntrie_iter:12.2194,kntrie_mem:4063248,map_fnd:173.6182,map_nf:167.7684,map_insert:142.6135,map_erase:92.2391,map_iter:24.2796,map_mem:15961200,umap_fnd:4.8527,umap_nf:6.1401,umap_insert:10.3654,umap_erase:9.4767,umap_iter:0.6649,umap_mem:10789088},
  {pattern:"sequential",N:498788,kntrie_fnd:29.6554,kntrie_nf:15.0134,kntrie_insert:53.2018,kntrie_erase:27.0702,kntrie_iter:18.7654,kntrie_mem:6094960,map_fnd:300.5397,map_nf:302.2727,map_insert:256.8793,map_erase:162.2950,map_iter:41.0296,map_mem:23941824,umap_fnd:7.8804,umap_nf:10.1531,umap_insert:16.6342,umap_erase:15.8361,umap_iter:1.0124,umap_mem:16132840},
  {pattern:"sequential",N:748182,kntrie_fnd:49.9369,kntrie_nf:24.8515,kntrie_insert:97.2342,kntrie_erase:58.5271,kntrie_iter:27.8126,kntrie_mem:9142192,map_fnd:528.6810,map_nf:578.9366,map_insert:466.5318,map_erase:304.3801,map_iter:70.7542,map_mem:35912736,umap_fnd:12.5164,umap_nf:16.2947,umap_insert:25.4570,umap_erase:28.4738,umap_iter:1.5342,umap_mem:24124760},
  {pattern:"sequential",N:1122274,kntrie_fnd:81.4101,kntrie_nf:40.4665,kntrie_insert:154.9766,kntrie_erase:87.7143,kntrie_iter:41.7428,kntrie_mem:13713968,umap_fnd:23.9258,umap_nf:25.1845,umap_insert:46.3823,umap_erase:39.1276,umap_iter:3.7366,umap_mem:36077144},
  {pattern:"sequential",N:1683411,kntrie_fnd:149.6238,kntrie_nf:70.1468,kntrie_insert:281.9129,kntrie_erase:150.2762,kntrie_iter:62.4288,kntrie_mem:20570432,umap_fnd:37.4755,umap_nf:38.8822,umap_insert:75.8920,umap_erase:67.4625,umap_iter:6.1874,umap_mem:53952736},
  {pattern:"sequential",N:2525116,kntrie_fnd:286.3037,kntrie_nf:142.9229,kntrie_insert:465.0737,kntrie_erase:283.7473,kntrie_iter:95.1683,kntrie_mem:30852312,umap_fnd:68.5937,umap_nf:66.7254,umap_insert:130.3561,umap_erase:100.0237,umap_iter:10.0819,umap_mem:82332776},
  {pattern:"sequential",N:3787675,kntrie_fnd:405.3066,kntrie_nf:253.0078,kntrie_insert:765.5628,kntrie_erase:435.5519,kntrie_iter:143.3463,kntrie_mem:46283712,umap_fnd:105.3270,umap_nf:103.5200,umap_insert:198.0153,umap_erase:182.6671,umap_iter:15.5925,umap_mem:123112448},
  {pattern:"sequential",N:5681512,kntrie_fnd:683.6077,kntrie_nf:409.5147,kntrie_insert:1296.7005,kntrie_erase:711.7868,kntrie_iter:221.6457,kntrie_mem:69425392,umap_fnd:183.6307,umap_nf:194.2802,umap_insert:294.2760,umap_erase:319.5170,umap_iter:26.2098,umap_mem:184095064},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const LINES_ITER = [
  { key: "kntrie", suffix: "iter", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "iter", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "iter", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "iter",   lines: LINES_ITER,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

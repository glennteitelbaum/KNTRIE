<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64)</h2>
  <p class="sub">Log-log · Per-entry · Lower is better · FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Iteration (ns/entry)</h3><canvas id="c_iter"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0006,kntrie_nf:0.0005,kntrie_insert:0.0111,kntrie_erase:0.0046,kntrie_iter:0.0026,kntrie_mem:2056,map_fnd:0.0031,map_nf:0.0022,map_insert:0.0116,map_erase:0.0066,map_iter:0.0012,map_mem:4800,umap_fnd:0.0012,umap_nf:0.0018,umap_insert:0.0037,umap_erase:0.0029,umap_iter:0.0002,umap_mem:3224},
  {pattern:"random",N:150,kntrie_fnd:0.0011,kntrie_nf:0.0009,kntrie_insert:0.0143,kntrie_erase:0.0056,kntrie_iter:0.0040,kntrie_mem:4104,map_fnd:0.0051,map_nf:0.0040,map_insert:0.0174,map_erase:0.0101,map_iter:0.0017,map_mem:7200,umap_fnd:0.0017,umap_nf:0.0022,umap_insert:0.0062,umap_erase:0.0034,umap_iter:0.0003,umap_mem:4856},
  {pattern:"random",N:225,kntrie_fnd:0.0015,kntrie_nf:0.0013,kntrie_insert:0.0161,kntrie_erase:0.0066,kntrie_iter:0.0057,kntrie_mem:4104,map_fnd:0.0082,map_nf:0.0066,map_insert:0.0231,map_erase:0.0127,map_iter:0.0023,map_mem:10800,umap_fnd:0.0029,umap_nf:0.0040,umap_insert:0.0084,umap_erase:0.0041,umap_iter:0.0004,umap_mem:7216},
  {pattern:"random",N:337,kntrie_fnd:0.0027,kntrie_nf:0.0023,kntrie_insert:0.0222,kntrie_erase:0.0095,kntrie_iter:0.0093,kntrie_mem:8200,map_fnd:0.0135,map_nf:0.0112,map_insert:0.0348,map_erase:0.0192,map_iter:0.0034,map_mem:16176,umap_fnd:0.0040,umap_nf:0.0064,umap_insert:0.0116,umap_erase:0.0053,umap_iter:0.0006,umap_mem:10784},
  {pattern:"random",N:506,kntrie_fnd:0.0040,kntrie_nf:0.0035,kntrie_insert:0.0395,kntrie_erase:0.0121,kntrie_iter:0.0139,kntrie_mem:8200,map_fnd:0.0222,map_nf:0.0184,map_insert:0.0520,map_erase:0.0286,map_iter:0.0048,map_mem:24288,umap_fnd:0.0057,umap_nf:0.0088,umap_insert:0.0160,umap_erase:0.0076,umap_iter:0.0008,umap_mem:16472},
  {pattern:"random",N:759,kntrie_fnd:0.0071,kntrie_nf:0.0061,kntrie_insert:0.0555,kntrie_erase:0.0197,kntrie_iter:0.0229,kntrie_mem:16392,map_fnd:0.0370,map_nf:0.0312,map_insert:0.0881,map_erase:0.0442,map_iter:0.0077,map_mem:36432,umap_fnd:0.0093,umap_nf:0.0148,umap_insert:0.0244,umap_erase:0.0124,umap_iter:0.0013,umap_mem:24304},
  {pattern:"random",N:1139,kntrie_fnd:0.0159,kntrie_nf:0.0150,kntrie_insert:0.0917,kntrie_erase:0.0246,kntrie_iter:0.0375,kntrie_mem:32776,map_fnd:0.0760,map_nf:0.0664,map_insert:0.1459,map_erase:0.0729,map_iter:0.0129,map_mem:54672,umap_fnd:0.0145,umap_nf:0.0229,umap_insert:0.0381,umap_erase:0.0199,umap_iter:0.0023,umap_mem:36880},
  {pattern:"random",N:1708,kntrie_fnd:0.0222,kntrie_nf:0.0220,kntrie_insert:0.1253,kntrie_erase:0.0487,kntrie_iter:0.0562,kntrie_mem:32776,map_fnd:0.1272,map_nf:0.1224,map_insert:0.2302,map_erase:0.1289,map_iter:0.0207,map_mem:81984,umap_fnd:0.0251,umap_nf:0.0398,umap_insert:0.0609,umap_erase:0.0303,umap_iter:0.0051,umap_mem:54920},
  {pattern:"random",N:2562,kntrie_fnd:0.0476,kntrie_nf:0.0424,kntrie_insert:0.2374,kntrie_erase:0.0747,kntrie_iter:0.0926,kntrie_mem:65544,map_fnd:0.2381,map_nf:0.2144,map_insert:0.4253,map_erase:0.2089,map_iter:0.0345,map_mem:122976,umap_fnd:0.0393,umap_nf:0.0609,umap_insert:0.0963,umap_erase:0.0522,umap_iter:0.0089,umap_mem:83512},
  {pattern:"random",N:3844,kntrie_fnd:0.0716,kntrie_nf:0.0411,kntrie_insert:0.3589,kntrie_erase:0.0871,kntrie_iter:0.1393,kntrie_mem:65544,map_fnd:0.2963,map_nf:0.2842,map_insert:0.4515,map_erase:0.2730,map_iter:0.0448,map_mem:184512,umap_fnd:0.0560,umap_nf:0.0820,umap_insert:0.1158,umap_erase:0.0636,umap_iter:0.0135,umap_mem:124472},
  {pattern:"random",N:5766,kntrie_fnd:0.0625,kntrie_nf:0.0598,kntrie_insert:0.5191,kntrie_erase:0.3632,kntrie_iter:0.1815,kntrie_mem:131600,map_fnd:0.4937,map_nf:0.4714,map_insert:0.7680,map_erase:0.3938,map_iter:0.0662,map_mem:276768,umap_fnd:0.0842,umap_nf:0.1224,umap_insert:0.1655,umap_erase:0.0849,umap_iter:0.0211,umap_mem:186008},
  {pattern:"random",N:8649,kntrie_fnd:0.1259,kntrie_nf:0.1296,kntrie_insert:0.6960,kntrie_erase:0.6674,kntrie_iter:0.2802,kntrie_mem:214544,map_fnd:0.8235,map_nf:0.7997,map_insert:1.1754,map_erase:0.6294,map_iter:0.1040,map_mem:415152,umap_fnd:0.1284,umap_nf:0.1809,umap_insert:0.2373,umap_erase:0.1295,umap_iter:0.0343,umap_mem:277840},
  {pattern:"random",N:12974,kntrie_fnd:0.1561,kntrie_nf:0.1389,kntrie_insert:0.9863,kntrie_erase:0.8196,kntrie_iter:0.4325,kntrie_mem:274960,map_fnd:1.3620,map_nf:1.3349,map_insert:1.8486,map_erase:1.0167,map_iter:0.1602,map_mem:622752,umap_fnd:0.1991,umap_nf:0.2880,umap_insert:0.3632,umap_erase:0.2028,umap_iter:0.0516,umap_mem:415240},
  {pattern:"random",N:19461,kntrie_fnd:0.2960,kntrie_nf:0.2594,kntrie_insert:1.4337,kntrie_erase:1.0777,kntrie_iter:0.6840,kntrie_mem:503824,map_fnd:2.3483,map_nf:2.2640,map_insert:2.9105,map_erase:1.6690,map_iter:0.2611,map_mem:934128,umap_fnd:0.2945,umap_nf:0.4173,umap_insert:0.5372,umap_erase:0.2938,umap_iter:0.0813,umap_mem:633088},
  {pattern:"random",N:29192,kntrie_fnd:0.4485,kntrie_nf:0.3863,kntrie_insert:2.0841,kntrie_erase:1.3822,kntrie_iter:1.0394,kntrie_mem:568336,map_fnd:4.4512,map_nf:4.3346,map_insert:4.8244,map_erase:2.9610,map_iter:0.6921,map_mem:1401216,umap_fnd:0.4659,umap_nf:0.6607,umap_insert:0.8759,umap_erase:0.5046,umap_iter:0.1404,umap_mem:946424},
  {pattern:"random",N:43789,kntrie_fnd:0.7977,kntrie_nf:0.6685,kntrie_insert:3.1334,kntrie_erase:2.0073,kntrie_iter:1.6688,kntrie_mem:1053712,map_fnd:8.2889,map_nf:7.5824,map_insert:7.9960,map_erase:5.2632,map_iter:1.5213,map_mem:2101872,umap_fnd:0.7732,umap_nf:1.0660,umap_insert:1.3770,umap_erase:0.8427,umap_iter:0.2445,umap_mem:1414784},
  {pattern:"random",N:65684,kntrie_fnd:1.6665,kntrie_nf:1.3385,kntrie_insert:5.5143,kntrie_erase:2.5494,kntrie_iter:2.5887,kntrie_mem:1573904,map_fnd:15.8827,map_nf:15.8464,map_insert:14.5142,map_erase:9.4577,map_iter:3.1469,map_mem:3152832,umap_fnd:1.3846,umap_nf:1.8671,umap_insert:2.3716,umap_erase:1.7438,umap_iter:0.5130,umap_mem:2114872},
  {pattern:"random",N:98526,kntrie_fnd:3.0030,kntrie_nf:1.8407,kntrie_insert:8.0024,kntrie_erase:4.5709,kntrie_iter:4.0615,kntrie_mem:2102288,map_fnd:32.8218,map_nf:31.8078,map_insert:25.9293,map_erase:17.7102,map_iter:5.2488,map_mem:4729248,umap_fnd:2.5969,umap_nf:3.2406,umap_insert:4.6598,umap_erase:3.3036,umap_iter:1.1584,umap_mem:3162488},
  {pattern:"random",N:147789,kntrie_fnd:8.3351,kntrie_nf:5.3722,kntrie_insert:14.8303,kntrie_erase:7.8242,kntrie_iter:6.5956,kntrie_mem:4183056,map_fnd:59.9245,map_nf:56.4787,map_insert:46.4783,map_erase:31.5198,map_iter:9.6733,map_mem:7093872,umap_fnd:4.1045,umap_nf:5.3629,umap_insert:9.0550,umap_erase:5.6468,umap_iter:2.5161,umap_mem:4729280},
  {pattern:"random",N:221683,kntrie_fnd:11.1009,kntrie_nf:7.0161,kntrie_insert:23.3083,kntrie_erase:12.8016,kntrie_iter:9.6732,kntrie_mem:4199440,map_fnd:95.6047,map_nf:96.1954,map_insert:78.9210,map_erase:52.9194,map_iter:14.3883,map_mem:10640784,umap_fnd:6.1398,umap_nf:8.1172,umap_insert:14.7165,umap_erase:8.9986,umap_iter:3.8699,umap_mem:7215568},
  {pattern:"random",N:332525,kntrie_fnd:28.5014,kntrie_nf:19.0286,kntrie_insert:44.9419,kntrie_erase:24.0671,kntrie_iter:15.6437,kntrie_mem:8393744,map_fnd:175.9371,map_nf:167.2097,map_insert:148.1662,map_erase:98.0630,map_iter:24.7689,map_mem:15961200,umap_fnd:10.6948,umap_nf:12.8859,umap_insert:24.7734,umap_erase:15.2480,umap_iter:7.5320,umap_mem:10789088},
  {pattern:"random",N:498788,kntrie_fnd:41.4624,kntrie_nf:28.0100,kntrie_insert:87.0456,kntrie_erase:42.4981,kntrie_iter:23.5049,kntrie_mem:8524816,map_fnd:297.3642,map_nf:296.3527,map_insert:253.9311,map_erase:164.4291,map_iter:40.6818,map_mem:23941824,umap_fnd:16.5404,umap_nf:20.3548,umap_insert:40.1323,umap_erase:23.5126,umap_iter:12.1854,umap_mem:16132840},
  {pattern:"random",N:748182,kntrie_fnd:89.0458,kntrie_nf:67.3482,kntrie_insert:152.8366,kntrie_erase:78.7963,kntrie_iter:37.7842,kntrie_mem:16782352,map_fnd:512.1715,map_nf:528.0082,map_insert:438.1118,map_erase:277.6121,map_iter:63.6179,map_mem:35912736,umap_fnd:26.2854,umap_nf:31.8281,umap_insert:59.8583,umap_erase:36.5037,umap_iter:20.5046,umap_mem:24124760},
  {pattern:"random",N:1122274,kntrie_fnd:81.6359,kntrie_nf:74.1736,kntrie_insert:321.4475,kntrie_erase:68.2258,kntrie_iter:43.8982,kntrie_mem:27146000,umap_fnd:40.2627,umap_nf:48.9888,umap_insert:97.7495,umap_erase:56.6064,umap_iter:32.8345,umap_mem:36077144},
  {pattern:"random",N:1683411,kntrie_fnd:162.7729,kntrie_nf:138.1322,kntrie_insert:496.3933,kntrie_erase:303.7903,kntrie_iter:74.8350,kntrie_mem:37514256,umap_fnd:70.0909,umap_nf:81.7416,umap_insert:180.0606,umap_erase:105.4332,umap_iter:61.4419,umap_mem:53952736},
  {pattern:"random",N:2525116,kntrie_fnd:264.3126,kntrie_nf:221.3433,kntrie_insert:639.1481,kntrie_erase:525.7410,kntrie_iter:116.5117,kntrie_mem:62881040,umap_fnd:102.1667,umap_nf:117.1946,umap_insert:248.0212,umap_erase:155.6286,umap_iter:86.1765,umap_mem:82332776},
  {pattern:"random",N:3787675,kntrie_fnd:515.9242,kntrie_nf:426.8757,kntrie_insert:1055.3921,kntrie_erase:830.9760,kntrie_iter:176.1083,kntrie_mem:81038352,umap_fnd:179.3697,umap_nf:189.3757,umap_insert:439.6287,umap_erase:260.4056,umap_iter:161.5422,umap_mem:123112448},
  {pattern:"random",N:5681512,kntrie_fnd:740.1088,kntrie_nf:648.4051,kntrie_insert:1614.7779,kntrie_erase:1430.7618,kntrie_iter:271.2451,kntrie_mem:135109648,umap_fnd:296.9467,umap_nf:300.8895,umap_insert:742.8628,umap_erase:453.1912,umap_iter:284.4219,umap_mem:184095064},
  {pattern:"sequential",N:100,kntrie_fnd:0.0006,kntrie_nf:0.0005,kntrie_insert:0.0092,kntrie_erase:0.0040,kntrie_iter:0.0024,kntrie_mem:2056,map_fnd:0.0031,map_nf:0.0030,map_insert:0.0098,map_erase:0.0068,map_iter:0.0012,map_mem:4800,umap_fnd:0.0003,umap_nf:0.0007,umap_insert:0.0031,umap_erase:0.0018,umap_iter:0.0002,umap_mem:3224},
  {pattern:"sequential",N:150,kntrie_fnd:0.0010,kntrie_nf:0.0009,kntrie_insert:0.0119,kntrie_erase:0.0054,kntrie_iter:0.0039,kntrie_mem:4104,map_fnd:0.0051,map_nf:0.0050,map_insert:0.0175,map_erase:0.0101,map_iter:0.0017,map_mem:7200,umap_fnd:0.0005,umap_nf:0.0010,umap_insert:0.0044,umap_erase:0.0026,umap_iter:0.0003,umap_mem:4856},
  {pattern:"sequential",N:225,kntrie_fnd:0.0015,kntrie_nf:0.0013,kntrie_insert:0.0142,kntrie_erase:0.0064,kntrie_iter:0.0056,kntrie_mem:4104,map_fnd:0.0083,map_nf:0.0081,map_insert:0.0241,map_erase:0.0129,map_iter:0.0024,map_mem:10800,umap_fnd:0.0007,umap_nf:0.0014,umap_insert:0.0054,umap_erase:0.0024,umap_iter:0.0004,umap_mem:7216},
  {pattern:"sequential",N:337,kntrie_fnd:0.0026,kntrie_nf:0.0023,kntrie_insert:0.0231,kntrie_erase:0.0096,kntrie_iter:0.0093,kntrie_mem:8200,map_fnd:0.0135,map_nf:0.0133,map_insert:0.0348,map_erase:0.0187,map_iter:0.0033,map_mem:16176,umap_fnd:0.0010,umap_nf:0.0021,umap_insert:0.0074,umap_erase:0.0037,umap_iter:0.0006,umap_mem:10784},
  {pattern:"sequential",N:506,kntrie_fnd:0.0040,kntrie_nf:0.0035,kntrie_insert:0.0370,kntrie_erase:0.0121,kntrie_iter:0.0139,kntrie_mem:8200,map_fnd:0.0218,map_nf:0.0213,map_insert:0.0536,map_erase:0.0287,map_iter:0.0056,map_mem:24288,umap_fnd:0.0016,umap_nf:0.0034,umap_insert:0.0104,umap_erase:0.0037,umap_iter:0.0008,umap_mem:16472},
  {pattern:"sequential",N:759,kntrie_fnd:0.0068,kntrie_nf:0.0061,kntrie_insert:0.0507,kntrie_erase:0.0201,kntrie_iter:0.0228,kntrie_mem:16392,map_fnd:0.0385,map_nf:0.0381,map_insert:0.0810,map_erase:0.0452,map_iter:0.0075,map_mem:36432,umap_fnd:0.0024,umap_nf:0.0048,umap_insert:0.0145,umap_erase:0.0053,umap_iter:0.0013,umap_mem:24304},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0115,kntrie_nf:0.0101,kntrie_insert:0.0796,kntrie_erase:0.0211,kntrie_iter:0.0370,kntrie_mem:32776,map_fnd:0.0639,map_nf:0.0658,map_insert:0.1236,map_erase:0.0696,map_iter:0.0119,map_mem:54672,umap_fnd:0.0035,umap_nf:0.0078,umap_insert:0.0198,umap_erase:0.0065,umap_iter:0.0020,umap_mem:36880},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0168,kntrie_nf:0.0160,kntrie_insert:0.1263,kntrie_erase:0.0374,kntrie_iter:0.0553,kntrie_mem:32776,map_fnd:0.1113,map_nf:0.1071,map_insert:0.1925,map_erase:0.1043,map_iter:0.0188,map_mem:81984,umap_fnd:0.0052,umap_nf:0.0115,umap_insert:0.0295,umap_erase:0.0105,umap_iter:0.0030,umap_mem:54920},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0307,kntrie_nf:0.0263,kntrie_insert:0.1867,kntrie_erase:0.0600,kntrie_iter:0.0901,kntrie_mem:65544,map_fnd:0.1846,map_nf:0.1788,map_insert:0.2900,map_erase:0.1630,map_iter:0.0283,map_mem:122976,umap_fnd:0.0081,umap_nf:0.0189,umap_insert:0.0426,umap_erase:0.0165,umap_iter:0.0044,umap_mem:83512},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0446,kntrie_nf:0.0387,kntrie_insert:0.2692,kntrie_erase:0.0821,kntrie_iter:0.1352,kntrie_mem:65544,map_fnd:0.3037,map_nf:0.3021,map_insert:0.4851,map_erase:0.2580,map_iter:0.0438,map_mem:184512,umap_fnd:0.0122,umap_nf:0.0271,umap_insert:0.0616,umap_erase:0.0266,umap_iter:0.0064,umap_mem:124472},
  {pattern:"sequential",N:5766,kntrie_fnd:0.1809,kntrie_nf:0.1498,kntrie_insert:0.4951,kntrie_erase:0.1473,kntrie_iter:0.1740,kntrie_mem:70960,map_fnd:0.4912,map_nf:0.4948,map_insert:0.7234,map_erase:0.4008,map_iter:0.0697,map_mem:276768,umap_fnd:0.0183,umap_nf:0.0403,umap_insert:0.0919,umap_erase:0.0391,umap_iter:0.0095,umap_mem:186008},
  {pattern:"sequential",N:8649,kntrie_fnd:0.2668,kntrie_nf:0.2260,kntrie_insert:0.6489,kntrie_erase:0.3535,kntrie_iter:0.2599,kntrie_mem:105792,map_fnd:0.8107,map_nf:0.8097,map_insert:1.1573,map_erase:0.6310,map_iter:0.1074,map_mem:415152,umap_fnd:0.0272,umap_nf:0.0593,umap_insert:0.1315,umap_erase:0.0587,umap_iter:0.0140,umap_mem:277840},
  {pattern:"sequential",N:12974,kntrie_fnd:0.4041,kntrie_nf:0.3334,kntrie_insert:0.8346,kntrie_erase:0.5466,kntrie_iter:0.3980,kntrie_mem:158816,map_fnd:1.3672,map_nf:1.3546,map_insert:1.8393,map_erase:1.0189,map_iter:0.1625,map_mem:622752,umap_fnd:0.0418,umap_nf:0.0869,umap_insert:0.1929,umap_erase:0.0907,umap_iter:0.0205,umap_mem:415240},
  {pattern:"sequential",N:19461,kntrie_fnd:0.6087,kntrie_nf:0.5042,kntrie_insert:1.1632,kntrie_erase:0.7989,kntrie_iter:0.5897,kntrie_mem:238048,map_fnd:2.3600,map_nf:2.3272,map_insert:2.9395,map_erase:1.6594,map_iter:0.2910,map_mem:934128,umap_fnd:0.0596,umap_nf:0.1396,umap_insert:0.2848,umap_erase:0.1364,umap_iter:0.0307,umap_mem:633088},
  {pattern:"sequential",N:29192,kntrie_fnd:0.9436,kntrie_nf:0.7732,kntrie_insert:1.6828,kntrie_erase:1.2345,kntrie_iter:0.8873,kntrie_mem:357056,map_fnd:4.3701,map_nf:4.3791,map_insert:4.7802,map_erase:2.8820,map_iter:0.6456,map_mem:1401216,umap_fnd:0.1408,umap_nf:0.2591,umap_insert:0.4518,umap_erase:0.2678,umap_iter:0.0504,umap_mem:946424},
  {pattern:"sequential",N:43789,kntrie_fnd:1.4365,kntrie_nf:1.1760,kntrie_insert:3.0631,kntrie_erase:2.0847,kntrie_iter:1.5617,kntrie_mem:535504,map_fnd:9.4859,map_nf:9.4443,map_insert:8.5341,map_erase:5.6302,map_iter:1.9192,map_mem:2101872,umap_fnd:0.2753,umap_nf:0.4321,umap_insert:0.7015,umap_erase:0.6101,umap_iter:0.0875,umap_mem:1414784},
  {pattern:"sequential",N:65684,kntrie_fnd:2.1803,kntrie_nf:1.7920,kntrie_insert:4.4976,kntrie_erase:3.1406,kntrie_iter:2.3408,kntrie_mem:803768,map_fnd:16.9895,map_nf:17.1266,map_insert:14.8228,map_erase:9.7661,map_iter:3.3379,map_mem:3152832,umap_fnd:0.6628,umap_nf:0.9343,umap_insert:1.1056,umap_erase:1.1687,umap_iter:0.1391,umap_mem:2114872},
  {pattern:"sequential",N:98526,kntrie_fnd:3.4538,kntrie_nf:2.7822,kntrie_insert:6.8620,kntrie_erase:4.8373,kntrie_iter:3.5423,kntrie_mem:1204168,map_fnd:32.7478,map_nf:33.3005,map_insert:26.8414,map_erase:18.1581,map_iter:5.8365,map_mem:4729248,umap_fnd:1.2972,umap_nf:1.6292,umap_insert:1.8909,umap_erase:2.2257,umap_iter:0.2192,umap_mem:3162488},
  {pattern:"sequential",N:147789,kntrie_fnd:5.5095,kntrie_nf:4.1983,kntrie_insert:10.4666,kntrie_erase:7.4315,kntrie_iter:5.2666,kntrie_mem:1806096,map_fnd:59.3173,map_nf:61.1616,map_insert:48.5009,map_erase:33.7953,map_iter:10.1656,map_mem:7093872,umap_fnd:2.1378,umap_nf:2.5653,umap_insert:3.9716,umap_erase:3.6138,umap_iter:0.3321,umap_mem:4729280},
  {pattern:"sequential",N:221683,kntrie_fnd:11.4763,kntrie_nf:6.4540,kntrie_insert:16.6975,kntrie_erase:12.0079,kntrie_iter:7.9414,kntrie_mem:2708512,map_fnd:107.4719,map_nf:106.6653,map_insert:88.4874,map_erase:60.2397,map_iter:17.2521,map_mem:10640784,umap_fnd:3.4722,umap_nf:4.2493,umap_insert:6.9340,umap_erase:7.0209,umap_iter:0.5003,umap_mem:7215568},
  {pattern:"sequential",N:332525,kntrie_fnd:17.2509,kntrie_nf:9.7922,kntrie_insert:27.2160,kntrie_erase:21.0864,kntrie_iter:12.0201,kntrie_mem:4063360,map_fnd:169.8433,map_nf:171.7238,map_insert:145.8815,map_erase:98.8439,map_iter:24.3704,map_mem:15961200,umap_fnd:4.7176,umap_nf:6.3412,umap_insert:11.0466,umap_erase:9.4373,umap_iter:0.6458,umap_mem:10789088},
  {pattern:"sequential",N:498788,kntrie_fnd:30.4185,kntrie_nf:15.4970,kntrie_insert:48.2572,kntrie_erase:40.8875,kntrie_iter:18.1473,kntrie_mem:6095232,map_fnd:314.4543,map_nf:319.1838,map_insert:274.9556,map_erase:173.9517,map_iter:43.0735,map_mem:23941824,umap_fnd:9.0468,umap_nf:11.8710,umap_insert:19.7598,umap_erase:17.4720,umap_iter:1.0731,umap_mem:16132840},
  {pattern:"sequential",N:748182,kntrie_fnd:49.8241,kntrie_nf:25.0049,kntrie_insert:78.6357,kntrie_erase:65.9793,kntrie_iter:27.5371,kntrie_mem:9143504,map_fnd:498.9226,map_nf:497.4181,map_insert:450.2592,map_erase:269.1188,map_iter:66.0061,map_mem:35912736,umap_fnd:12.1032,umap_nf:15.5858,umap_insert:24.8675,umap_erase:24.1642,umap_iter:1.4488,umap_mem:24124760},
  {pattern:"sequential",N:1122274,kntrie_fnd:84.9931,kntrie_nf:41.1723,kntrie_insert:136.5603,kntrie_erase:122.9856,kntrie_iter:40.8157,kntrie_mem:13713968,umap_fnd:28.1111,umap_nf:29.8585,umap_insert:51.6825,umap_erase:46.6528,umap_iter:4.1392,umap_mem:36077144},
  {pattern:"sequential",N:1683411,kntrie_fnd:156.0484,kntrie_nf:74.5375,kntrie_insert:243.8456,kntrie_erase:204.8602,kntrie_iter:61.5646,kntrie_mem:20570672,umap_fnd:42.3112,umap_nf:45.3153,umap_insert:85.5955,umap_erase:70.6164,umap_iter:6.4147,umap_mem:53952736},
  {pattern:"sequential",N:2525116,kntrie_fnd:257.4757,kntrie_nf:150.7326,kntrie_insert:398.3352,kntrie_erase:313.4371,kntrie_iter:94.1321,kntrie_mem:30852840,umap_fnd:67.0507,umap_nf:66.0651,umap_insert:123.3406,umap_erase:108.0740,umap_iter:10.2775,umap_mem:82332776},
  {pattern:"sequential",N:3787675,kntrie_fnd:409.3841,kntrie_nf:255.5450,kntrie_insert:640.4842,kntrie_erase:509.2697,kntrie_iter:141.3282,kntrie_mem:46284208,umap_fnd:98.5882,umap_nf:98.3736,umap_insert:187.8725,umap_erase:176.0822,umap_iter:16.8283,umap_mem:123112448},
  {pattern:"sequential",N:5681512,kntrie_fnd:735.6330,kntrie_nf:481.2818,kntrie_insert:1080.6150,kntrie_erase:932.2165,kntrie_iter:209.7444,kntrie_mem:69425920,umap_fnd:171.3038,umap_nf:173.8458,umap_insert:315.6631,umap_erase:320.6547,umap_iter:26.7672,umap_mem:184095064},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const LINES_ITER = [
  { key: "kntrie", suffix: "iter", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "iter", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "iter", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "iter",   lines: LINES_ITER,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

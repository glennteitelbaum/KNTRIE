<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64)</h2>
  <p class="sub">Log-log · Per-entry · Lower is better · FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0006,kntrie_nf:0.0005,kntrie_insert:0.0112,kntrie_erase:0.0038,kntrie_mem:2056,map_fnd:0.0030,map_nf:0.0021,map_insert:0.0110,map_erase:0.0064,map_mem:4800,umap_fnd:0.0011,umap_nf:0.0017,umap_insert:0.0037,umap_erase:0.0024,umap_mem:3224},
  {pattern:"random",N:150,kntrie_fnd:0.0010,kntrie_nf:0.0009,kntrie_insert:0.0116,kntrie_erase:0.0051,kntrie_mem:4104,map_fnd:0.0050,map_nf:0.0041,map_insert:0.0152,map_erase:0.0092,map_mem:7200,umap_fnd:0.0016,umap_nf:0.0020,umap_insert:0.0056,umap_erase:0.0028,umap_mem:4856},
  {pattern:"random",N:225,kntrie_fnd:0.0015,kntrie_nf:0.0013,kntrie_insert:0.0157,kntrie_erase:0.0067,kntrie_mem:4104,map_fnd:0.0083,map_nf:0.0064,map_insert:0.0220,map_erase:0.0129,map_mem:10800,umap_fnd:0.0027,umap_nf:0.0037,umap_insert:0.0080,umap_erase:0.0038,umap_mem:7216},
  {pattern:"random",N:337,kntrie_fnd:0.0026,kntrie_nf:0.0024,kntrie_insert:0.0203,kntrie_erase:0.0092,kntrie_mem:8200,map_fnd:0.0135,map_nf:0.0102,map_insert:0.0328,map_erase:0.0173,map_mem:16176,umap_fnd:0.0036,umap_nf:0.0058,umap_insert:0.0107,umap_erase:0.0047,umap_mem:10784},
  {pattern:"random",N:506,kntrie_fnd:0.0038,kntrie_nf:0.0035,kntrie_insert:0.0369,kntrie_erase:0.0113,kntrie_mem:8200,map_fnd:0.0220,map_nf:0.0177,map_insert:0.0472,map_erase:0.0274,map_mem:24288,umap_fnd:0.0052,umap_nf:0.0082,umap_insert:0.0144,umap_erase:0.0067,umap_mem:16472},
  {pattern:"random",N:759,kntrie_fnd:0.0066,kntrie_nf:0.0059,kntrie_insert:0.0464,kntrie_erase:0.0195,kntrie_mem:16392,map_fnd:0.0364,map_nf:0.0289,map_insert:0.0838,map_erase:0.0396,map_mem:36432,umap_fnd:0.0083,umap_nf:0.0130,umap_insert:0.0208,umap_erase:0.0105,umap_mem:24304},
  {pattern:"random",N:1139,kntrie_fnd:0.0109,kntrie_nf:0.0095,kntrie_insert:0.0654,kntrie_erase:0.0186,kntrie_mem:32776,map_fnd:0.0619,map_nf:0.0512,map_insert:0.1051,map_erase:0.0575,map_mem:54672,umap_fnd:0.0120,umap_nf:0.0182,umap_insert:0.0282,umap_erase:0.0138,umap_mem:36880},
  {pattern:"random",N:1708,kntrie_fnd:0.0166,kntrie_nf:0.0144,kntrie_insert:0.1078,kntrie_erase:0.0332,kntrie_mem:32776,map_fnd:0.1030,map_nf:0.0864,map_insert:0.1602,map_erase:0.0935,map_mem:81984,umap_fnd:0.0200,umap_nf:0.0304,umap_insert:0.0409,umap_erase:0.0220,umap_mem:54920},
  {pattern:"random",N:2562,kntrie_fnd:0.0297,kntrie_nf:0.0248,kntrie_insert:0.1604,kntrie_erase:0.0492,kntrie_mem:65544,map_fnd:0.1653,map_nf:0.1491,map_insert:0.2503,map_erase:0.1489,map_mem:122976,umap_fnd:0.0300,umap_nf:0.0452,umap_insert:0.0612,umap_erase:0.0315,umap_mem:83512},
  {pattern:"random",N:3844,kntrie_fnd:0.0449,kntrie_nf:0.0376,kntrie_insert:0.2629,kntrie_erase:0.0803,kntrie_mem:65544,map_fnd:0.2724,map_nf:0.2572,map_insert:0.3955,map_erase:0.2255,map_mem:184512,umap_fnd:0.0486,umap_nf:0.0686,umap_insert:0.0950,umap_erase:0.0503,umap_mem:124472},
  {pattern:"random",N:5766,kntrie_fnd:0.0627,kntrie_nf:0.0563,kntrie_insert:0.5899,kntrie_erase:0.3341,kntrie_mem:131600,map_fnd:0.4459,map_nf:0.4320,map_insert:0.6324,map_erase:0.3612,map_mem:276768,umap_fnd:0.0760,umap_nf:0.1100,umap_insert:0.1425,umap_erase:0.0761,umap_mem:186008},
  {pattern:"random",N:8649,kntrie_fnd:0.1271,kntrie_nf:0.1237,kntrie_insert:0.6678,kntrie_erase:0.6065,kntrie_mem:214544,map_fnd:0.7624,map_nf:0.7275,map_insert:0.9725,map_erase:0.5868,map_mem:415152,umap_fnd:0.1147,umap_nf:0.1643,umap_insert:0.2204,umap_erase:0.1188,umap_mem:277840},
  {pattern:"random",N:12974,kntrie_fnd:0.1626,kntrie_nf:0.1397,kntrie_insert:0.9112,kntrie_erase:0.7509,kntrie_mem:274960,map_fnd:1.2764,map_nf:1.2351,map_insert:1.5524,map_erase:0.9501,map_mem:622752,umap_fnd:0.1788,umap_nf:0.2603,umap_insert:0.3302,umap_erase:0.1822,umap_mem:415240},
  {pattern:"random",N:19461,kntrie_fnd:0.3033,kntrie_nf:0.2647,kntrie_insert:1.3249,kntrie_erase:0.9796,kntrie_mem:503824,map_fnd:2.1479,map_nf:2.0752,map_insert:2.4681,map_erase:1.5385,map_mem:934128,umap_fnd:0.2676,umap_nf:0.3845,umap_insert:0.5153,umap_erase:0.2744,umap_mem:633088},
  {pattern:"random",N:29192,kntrie_fnd:0.4506,kntrie_nf:0.4029,kntrie_insert:1.9507,kntrie_erase:1.3469,kntrie_mem:568336,map_fnd:4.4415,map_nf:3.8981,map_insert:4.2533,map_erase:2.7423,map_mem:1401216,umap_fnd:0.4283,umap_nf:0.6004,umap_insert:0.7640,umap_erase:0.4385,umap_mem:946424},
  {pattern:"random",N:43789,kntrie_fnd:0.8143,kntrie_nf:0.6826,kntrie_insert:2.9879,kntrie_erase:1.9972,kntrie_mem:1053712,map_fnd:8.7543,map_nf:7.7848,map_insert:7.5455,map_erase:5.0220,map_mem:2101872,umap_fnd:0.7389,umap_nf:1.0277,umap_insert:1.3568,umap_erase:0.8128,umap_mem:1414784},
  {pattern:"random",N:65684,kntrie_fnd:1.8620,kntrie_nf:1.3538,kntrie_insert:5.2202,kntrie_erase:2.3793,kntrie_mem:1573904,map_fnd:17.3896,map_nf:16.0900,map_insert:13.6609,map_erase:10.0207,map_mem:3152832,umap_fnd:1.3538,umap_nf:1.7993,umap_insert:2.4653,umap_erase:1.7395,umap_mem:2114872},
  {pattern:"random",N:98526,kntrie_fnd:3.3202,kntrie_nf:1.9242,kntrie_insert:7.8303,kntrie_erase:3.9411,kntrie_mem:2102288,map_fnd:29.4380,map_nf:26.2877,map_insert:23.1981,map_erase:15.4186,map_mem:4729248,umap_fnd:2.2039,umap_nf:2.8850,umap_insert:4.2578,umap_erase:2.8935,umap_mem:3162488},
  {pattern:"random",N:147789,kntrie_fnd:8.0962,kntrie_nf:4.8259,kntrie_insert:14.0145,kntrie_erase:6.3629,kntrie_mem:4183056,map_fnd:54.4839,map_nf:52.4401,map_insert:40.7790,map_erase:29.8248,map_mem:7093872,umap_fnd:3.5857,umap_nf:4.7584,umap_insert:8.1512,umap_erase:4.8821,umap_mem:4729280},
  {pattern:"random",N:221683,kntrie_fnd:12.2252,kntrie_nf:7.0428,kntrie_insert:24.1111,kntrie_erase:11.7150,kntrie_mem:4199440,map_fnd:99.8867,map_nf:97.5857,map_insert:79.1248,map_erase:53.0688,map_mem:10640784,umap_fnd:5.6546,umap_nf:7.5985,umap_insert:13.8733,umap_erase:8.2014,umap_mem:7215568},
  {pattern:"random",N:332525,kntrie_fnd:32.4741,kntrie_nf:21.4676,kntrie_insert:45.0643,kntrie_erase:24.1347,kntrie_mem:8393744,map_fnd:179.9477,map_nf:177.8086,map_insert:149.8252,map_erase:103.9177,map_mem:15961200,umap_fnd:9.9086,umap_nf:12.4927,umap_insert:23.7794,umap_erase:15.4493,umap_mem:10789088},
  {pattern:"random",N:498788,kntrie_fnd:50.7465,kntrie_nf:34.0640,kntrie_insert:91.6117,kntrie_erase:46.6251,kntrie_mem:8524816,map_fnd:323.6435,map_nf:294.5265,map_insert:280.9987,map_erase:164.6909,map_mem:23941824,umap_fnd:16.1626,umap_nf:20.0766,umap_insert:40.5679,umap_erase:24.9828,umap_mem:16132840},
  {pattern:"random",N:748182,kntrie_fnd:96.3281,kntrie_nf:69.0356,kntrie_insert:156.9646,kntrie_erase:73.2600,kntrie_mem:16782352,map_fnd:508.1330,map_nf:504.5145,map_insert:429.4558,map_erase:282.8387,map_mem:35912736,umap_fnd:24.3927,umap_nf:30.8209,umap_insert:60.0531,umap_erase:37.2258,umap_mem:24124760},
  {pattern:"random",N:1122274,kntrie_fnd:98.7516,kntrie_nf:91.5323,kntrie_insert:363.6320,kntrie_erase:169.5119,kntrie_mem:27146000,umap_fnd:40.5254,umap_nf:50.2112,umap_insert:114.1806,umap_erase:65.5371,umap_mem:36077144},
  {pattern:"random",N:1683411,kntrie_fnd:166.6039,kntrie_nf:143.4228,kntrie_insert:450.8216,kntrie_erase:321.9020,kntrie_mem:37514256,umap_fnd:62.2649,umap_nf:74.1226,umap_insert:175.5111,umap_erase:94.3258,umap_mem:53952736},
  {pattern:"random",N:2525116,kntrie_fnd:272.3981,kntrie_nf:230.5382,kntrie_insert:665.3864,kntrie_erase:484.3612,kntrie_mem:62881040,umap_fnd:92.7746,umap_nf:106.8216,umap_insert:234.0210,umap_erase:155.0663,umap_mem:82332776},
  {pattern:"sequential",N:100,kntrie_fnd:0.0006,kntrie_nf:0.0005,kntrie_insert:0.0091,kntrie_erase:0.0036,kntrie_mem:2056,map_fnd:0.0030,map_nf:0.0028,map_insert:0.0100,map_erase:0.0057,map_mem:4800,umap_fnd:0.0003,umap_nf:0.0006,umap_insert:0.0018,umap_erase:0.0017,umap_mem:3224},
  {pattern:"sequential",N:150,kntrie_fnd:0.0010,kntrie_nf:0.0009,kntrie_insert:0.0107,kntrie_erase:0.0044,kntrie_mem:4104,map_fnd:0.0049,map_nf:0.0046,map_insert:0.0143,map_erase:0.0083,map_mem:7200,umap_fnd:0.0004,umap_nf:0.0009,umap_insert:0.0037,umap_erase:0.0023,umap_mem:4856},
  {pattern:"sequential",N:225,kntrie_fnd:0.0015,kntrie_nf:0.0013,kntrie_insert:0.0128,kntrie_erase:0.0054,kntrie_mem:4104,map_fnd:0.0083,map_nf:0.0074,map_insert:0.0209,map_erase:0.0106,map_mem:10800,umap_fnd:0.0006,umap_nf:0.0013,umap_insert:0.0047,umap_erase:0.0017,umap_mem:7216},
  {pattern:"sequential",N:337,kntrie_fnd:0.0025,kntrie_nf:0.0023,kntrie_insert:0.0216,kntrie_erase:0.0083,kntrie_mem:8200,map_fnd:0.0133,map_nf:0.0125,map_insert:0.0302,map_erase:0.0160,map_mem:16176,umap_fnd:0.0009,umap_nf:0.0019,umap_insert:0.0069,umap_erase:0.0031,umap_mem:10784},
  {pattern:"sequential",N:506,kntrie_fnd:0.0038,kntrie_nf:0.0034,kntrie_insert:0.0316,kntrie_erase:0.0109,kntrie_mem:8200,map_fnd:0.0217,map_nf:0.0201,map_insert:0.0462,map_erase:0.0252,map_mem:24288,umap_fnd:0.0014,umap_nf:0.0031,umap_insert:0.0099,umap_erase:0.0038,umap_mem:16472},
  {pattern:"sequential",N:759,kntrie_fnd:0.0064,kntrie_nf:0.0058,kntrie_insert:0.0440,kntrie_erase:0.0173,kntrie_mem:16392,map_fnd:0.0355,map_nf:0.0328,map_insert:0.0692,map_erase:0.0383,map_mem:36432,umap_fnd:0.0022,umap_nf:0.0044,umap_insert:0.0135,umap_erase:0.0048,umap_mem:24304},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0107,kntrie_nf:0.0099,kntrie_insert:0.0975,kntrie_erase:0.0186,kntrie_mem:32776,map_fnd:0.0615,map_nf:0.0599,map_insert:0.1032,map_erase:0.0626,map_mem:54672,umap_fnd:0.0032,umap_nf:0.0069,umap_insert:0.0185,umap_erase:0.0062,umap_mem:36880},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0165,kntrie_nf:0.0143,kntrie_insert:0.1079,kntrie_erase:0.0322,kntrie_mem:32776,map_fnd:0.1014,map_nf:0.0970,map_insert:0.1621,map_erase:0.0931,map_mem:81984,umap_fnd:0.0048,umap_nf:0.0105,umap_insert:0.0278,umap_erase:0.0097,umap_mem:54920},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0296,kntrie_nf:0.0250,kntrie_insert:0.1777,kntrie_erase:0.0476,kntrie_mem:65544,map_fnd:0.1672,map_nf:0.1625,map_insert:0.2494,map_erase:0.1430,map_mem:122976,umap_fnd:0.0072,umap_nf:0.0167,umap_insert:0.0405,umap_erase:0.0147,umap_mem:83512},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0447,kntrie_nf:0.0372,kntrie_insert:0.2566,kntrie_erase:0.0748,kntrie_mem:65544,map_fnd:0.2747,map_nf:0.2703,map_insert:0.3919,map_erase:0.2252,map_mem:184512,umap_fnd:0.0110,umap_nf:0.0247,umap_insert:0.0541,umap_erase:0.0231,umap_mem:124472},
  {pattern:"sequential",N:5766,kntrie_fnd:0.1694,kntrie_nf:0.1522,kntrie_insert:0.4530,kntrie_erase:0.1731,kntrie_mem:70960,map_fnd:0.4576,map_nf:0.4496,map_insert:0.6246,map_erase:0.3714,map_mem:276768,umap_fnd:0.0168,umap_nf:0.0368,umap_insert:0.0818,umap_erase:0.0346,umap_mem:186008},
  {pattern:"sequential",N:8649,kntrie_fnd:0.2588,kntrie_nf:0.2299,kntrie_insert:0.5924,kntrie_erase:0.3029,kntrie_mem:105792,map_fnd:0.7646,map_nf:0.7528,map_insert:0.9997,map_erase:0.5921,map_mem:415152,umap_fnd:0.0251,umap_nf:0.0546,umap_insert:0.1279,umap_erase:0.0548,umap_mem:277840},
  {pattern:"sequential",N:12974,kntrie_fnd:0.3949,kntrie_nf:0.3397,kntrie_insert:0.7064,kntrie_erase:0.4232,kntrie_mem:158816,map_fnd:1.2882,map_nf:1.2787,map_insert:1.5668,map_erase:0.9470,map_mem:622752,umap_fnd:0.0371,umap_nf:0.0803,umap_insert:0.1955,umap_erase:0.0813,umap_mem:415240},
  {pattern:"sequential",N:19461,kntrie_fnd:0.5994,kntrie_nf:0.5098,kntrie_insert:0.9881,kntrie_erase:0.6538,kntrie_mem:238048,map_fnd:2.2044,map_nf:2.2091,map_insert:2.5243,map_erase:1.5228,map_mem:934128,umap_fnd:0.0582,umap_nf:0.1273,umap_insert:0.2823,umap_erase:0.1256,umap_mem:633088},
  {pattern:"sequential",N:29192,kntrie_fnd:0.9202,kntrie_nf:0.7838,kntrie_insert:1.3938,kntrie_erase:1.0198,kntrie_mem:357056,map_fnd:4.5738,map_nf:4.6884,map_insert:4.2261,map_erase:2.7229,map_mem:1401216,umap_fnd:0.1133,umap_nf:0.2050,umap_insert:0.4019,umap_erase:0.2192,umap_mem:946424},
  {pattern:"sequential",N:43789,kntrie_fnd:1.4294,kntrie_nf:1.1935,kntrie_insert:2.5859,kntrie_erase:1.7819,kntrie_mem:535504,map_fnd:8.8677,map_nf:9.2259,map_insert:7.4221,map_erase:4.9896,map_mem:2101872,umap_fnd:0.3147,umap_nf:0.4617,umap_insert:0.6171,umap_erase:0.5578,umap_mem:1414784},
  {pattern:"sequential",N:65684,kntrie_fnd:2.1897,kntrie_nf:1.8216,kntrie_insert:3.7443,kntrie_erase:2.6493,kntrie_mem:803768,map_fnd:16.6768,map_nf:17.0991,map_insert:13.3018,map_erase:9.6653,map_mem:3152832,umap_fnd:0.6610,umap_nf:0.9848,umap_insert:1.0279,umap_erase:1.3216,umap_mem:2114872},
  {pattern:"sequential",N:98526,kntrie_fnd:3.4381,kntrie_nf:2.7860,kntrie_insert:5.6809,kntrie_erase:4.1038,kntrie_mem:1204168,map_fnd:31.7291,map_nf:32.8722,map_insert:25.3358,map_erase:16.8055,map_mem:4729248,umap_fnd:1.2238,umap_nf:1.5482,umap_insert:1.9020,umap_erase:2.1841,umap_mem:3162488},
  {pattern:"sequential",N:147789,kntrie_fnd:5.4565,kntrie_nf:4.2489,kntrie_insert:8.9386,kntrie_erase:6.3368,kntrie_mem:1806096,map_fnd:58.6292,map_nf:58.2524,map_insert:47.4113,map_erase:31.5987,map_mem:7093872,umap_fnd:1.9716,umap_nf:2.5214,umap_insert:3.5923,umap_erase:3.6378,umap_mem:4729280},
  {pattern:"sequential",N:221683,kntrie_fnd:10.4460,kntrie_nf:6.5142,kntrie_insert:14.3161,kntrie_erase:10.6137,kntrie_mem:2708512,map_fnd:103.7694,map_nf:103.7912,map_insert:82.3695,map_erase:56.0177,map_mem:10640784,umap_fnd:3.5087,umap_nf:4.2611,umap_insert:7.3590,umap_erase:6.7931,umap_mem:7215568},
  {pattern:"sequential",N:332525,kntrie_fnd:17.3442,kntrie_nf:9.9205,kntrie_insert:23.3696,kntrie_erase:18.5938,kntrie_mem:4063360,map_fnd:190.9489,map_nf:190.2132,map_insert:155.7782,map_erase:102.8419,map_mem:15961200,umap_fnd:5.6336,umap_nf:7.1592,umap_insert:12.0985,umap_erase:11.1338,umap_mem:10789088},
  {pattern:"sequential",N:498788,kntrie_fnd:27.0096,kntrie_nf:15.3708,kntrie_insert:39.2500,kntrie_erase:34.2678,kntrie_mem:6095232,map_fnd:295.0791,map_nf:292.5258,map_insert:254.4361,map_erase:159.6208,map_mem:23941824,umap_fnd:7.5368,umap_nf:10.2017,umap_insert:15.9260,umap_erase:15.3908,umap_mem:16132840},
  {pattern:"sequential",N:748182,kntrie_fnd:48.9412,kntrie_nf:25.5173,kntrie_insert:66.4108,kntrie_erase:63.3705,kntrie_mem:9143504,map_fnd:497.0979,map_nf:523.8815,map_insert:424.4192,map_erase:283.5137,map_mem:35912736,umap_fnd:12.8138,umap_nf:16.7532,umap_insert:26.7147,umap_erase:25.6578,umap_mem:24124760},
  {pattern:"sequential",N:1122274,kntrie_fnd:78.3663,kntrie_nf:46.0419,kntrie_insert:114.2892,kntrie_erase:106.1309,kntrie_mem:13713968,umap_fnd:20.2813,umap_nf:25.5344,umap_insert:41.7146,umap_erase:39.9723,umap_mem:36077144},
  {pattern:"sequential",N:1683411,kntrie_fnd:158.4857,kntrie_nf:80.6894,kntrie_insert:187.9113,kntrie_erase:190.8169,kntrie_mem:20570672,umap_fnd:35.8268,umap_nf:44.9411,umap_insert:71.5564,umap_erase:69.1488,umap_mem:53952736},
  {pattern:"sequential",N:2525116,kntrie_fnd:263.2336,kntrie_nf:150.6828,kntrie_insert:343.0043,kntrie_erase:341.2737,kntrie_mem:30852840,umap_fnd:70.2567,umap_nf:74.2727,umap_insert:141.0443,umap_erase:120.5069,umap_mem:82332776},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

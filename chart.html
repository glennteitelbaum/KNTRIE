<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64)</h2>
  <p class="sub">Log-log · Per-entry · Lower is better · FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Iteration (ns/entry)</h3><canvas id="c_iter"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0007,kntrie_nf:0.0007,kntrie_insert:0.0115,kntrie_erase:0.0042,kntrie_iter:0.0027,kntrie_mem:2056,map_fnd:0.0039,map_nf:0.0026,map_insert:0.0140,map_erase:0.0069,map_iter:0.0016,map_mem:4800,umap_fnd:0.0014,umap_nf:0.0020,umap_insert:0.0040,umap_erase:0.0024,umap_iter:0.0003,umap_mem:3224},
  {pattern:"random",N:150,kntrie_fnd:0.0012,kntrie_nf:0.0011,kntrie_insert:0.0143,kntrie_erase:0.0048,kntrie_iter:0.0045,kntrie_mem:4104,map_fnd:0.0065,map_nf:0.0047,map_insert:0.0191,map_erase:0.0113,map_iter:0.0021,map_mem:7200,umap_fnd:0.0019,umap_nf:0.0024,umap_insert:0.0072,umap_erase:0.0030,umap_iter:0.0003,umap_mem:4856},
  {pattern:"random",N:225,kntrie_fnd:0.0019,kntrie_nf:0.0017,kntrie_insert:0.0169,kntrie_erase:0.0072,kntrie_iter:0.0065,kntrie_mem:4104,map_fnd:0.0105,map_nf:0.0081,map_insert:0.0280,map_erase:0.0142,map_iter:0.0027,map_mem:10800,umap_fnd:0.0033,umap_nf:0.0045,umap_insert:0.0098,umap_erase:0.0045,umap_iter:0.0005,umap_mem:7216},
  {pattern:"random",N:337,kntrie_fnd:0.0034,kntrie_nf:0.0031,kntrie_insert:0.0244,kntrie_erase:0.0102,kntrie_iter:0.0106,kntrie_mem:8200,map_fnd:0.0172,map_nf:0.0135,map_insert:0.0424,map_erase:0.0221,map_iter:0.0041,map_mem:16176,umap_fnd:0.0045,umap_nf:0.0071,umap_insert:0.0135,umap_erase:0.0058,umap_iter:0.0007,umap_mem:10784},
  {pattern:"random",N:506,kntrie_fnd:0.0050,kntrie_nf:0.0049,kntrie_insert:0.0454,kntrie_erase:0.0131,kntrie_iter:0.0158,kntrie_mem:8200,map_fnd:0.0283,map_nf:0.0225,map_insert:0.0618,map_erase:0.0339,map_iter:0.0056,map_mem:24288,umap_fnd:0.0065,umap_nf:0.0100,umap_insert:0.0184,umap_erase:0.0082,umap_iter:0.0010,umap_mem:16472},
  {pattern:"random",N:759,kntrie_fnd:0.0082,kntrie_nf:0.0076,kntrie_insert:0.0545,kntrie_erase:0.0218,kntrie_iter:0.0258,kntrie_mem:16392,map_fnd:0.0465,map_nf:0.0380,map_insert:0.0923,map_erase:0.0514,map_iter:0.0088,map_mem:36432,umap_fnd:0.0104,umap_nf:0.0160,umap_insert:0.0268,umap_erase:0.0130,umap_iter:0.0015,umap_mem:24304},
  {pattern:"random",N:1139,kntrie_fnd:0.0127,kntrie_nf:0.0116,kntrie_insert:0.0792,kntrie_erase:0.0214,kntrie_iter:0.0419,kntrie_mem:32776,map_fnd:0.0776,map_nf:0.0661,map_insert:0.1400,map_erase:0.0742,map_iter:0.0142,map_mem:54672,umap_fnd:0.0154,umap_nf:0.0224,umap_insert:0.0369,umap_erase:0.0175,umap_iter:0.0026,umap_mem:36880},
  {pattern:"random",N:1708,kntrie_fnd:0.0204,kntrie_nf:0.0190,kntrie_insert:0.1296,kntrie_erase:0.0411,kntrie_iter:0.0629,kntrie_mem:32776,map_fnd:0.1295,map_nf:0.1162,map_insert:0.2215,map_erase:0.1159,map_iter:0.0222,map_mem:81984,umap_fnd:0.0252,umap_nf:0.0376,umap_insert:0.0533,umap_erase:0.0277,umap_iter:0.0049,umap_mem:54920},
  {pattern:"random",N:2562,kntrie_fnd:0.0378,kntrie_nf:0.0325,kntrie_insert:0.2026,kntrie_erase:0.0612,kntrie_iter:0.1024,kntrie_mem:65544,map_fnd:0.2109,map_nf:0.1943,map_insert:0.3387,map_erase:0.1787,map_iter:0.0331,map_mem:122976,umap_fnd:0.0375,umap_nf:0.0547,umap_insert:0.0782,umap_erase:0.0425,umap_iter:0.0085,umap_mem:83512},
  {pattern:"random",N:3844,kntrie_fnd:0.0573,kntrie_nf:0.0505,kntrie_insert:0.4114,kntrie_erase:0.0976,kntrie_iter:0.1536,kntrie_mem:65544,map_fnd:0.3485,map_nf:0.3365,map_insert:0.5460,map_erase:0.2933,map_iter:0.0495,map_mem:184512,umap_fnd:0.0614,umap_nf:0.0858,umap_insert:0.1217,umap_erase:0.0645,umap_iter:0.0144,umap_mem:124472},
  {pattern:"random",N:5766,kntrie_fnd:0.0747,kntrie_nf:0.0702,kntrie_insert:0.6575,kntrie_erase:0.1773,kntrie_iter:0.1997,kntrie_mem:131600,map_fnd:0.5648,map_nf:0.5446,map_insert:0.8586,map_erase:0.4470,map_iter:0.0747,map_mem:276768,umap_fnd:0.0951,umap_nf:0.1356,umap_insert:0.1923,umap_erase:0.0997,umap_iter:0.0237,umap_mem:186008},
  {pattern:"random",N:8649,kntrie_fnd:0.1539,kntrie_nf:0.1442,kntrie_insert:0.8182,kntrie_erase:0.2631,kntrie_iter:0.3191,kntrie_mem:214544,map_fnd:0.9431,map_nf:0.9263,map_insert:1.3629,map_erase:0.7315,map_iter:0.1239,map_mem:415152,umap_fnd:0.1474,umap_nf:0.2048,umap_insert:0.2869,umap_erase:0.1544,umap_iter:0.0369,umap_mem:277840},
  {pattern:"random",N:12974,kntrie_fnd:0.1948,kntrie_nf:0.1691,kntrie_insert:1.1973,kntrie_erase:0.3949,kntrie_iter:0.4868,kntrie_mem:274960,map_fnd:1.5400,map_nf:1.5470,map_insert:2.1253,map_erase:1.1465,map_iter:0.1874,map_mem:622752,umap_fnd:0.2269,umap_nf:0.3203,umap_insert:0.4223,umap_erase:0.2379,umap_iter:0.0581,umap_mem:415240},
  {pattern:"random",N:19461,kntrie_fnd:0.3358,kntrie_nf:0.3040,kntrie_insert:1.6688,kntrie_erase:0.5741,kntrie_iter:0.7878,kntrie_mem:503824,map_fnd:2.5632,map_nf:2.5690,map_insert:3.3579,map_erase:1.8442,map_iter:0.3029,map_mem:934128,umap_fnd:0.3347,umap_nf:0.4655,umap_insert:0.6243,umap_erase:0.3505,umap_iter:0.0927,umap_mem:633088},
  {pattern:"random",N:29192,kntrie_fnd:0.5612,kntrie_nf:0.4921,kntrie_insert:2.4871,kntrie_erase:0.8941,kntrie_iter:1.1882,kntrie_mem:568336,map_fnd:4.4888,map_nf:4.3566,map_insert:5.4628,map_erase:3.0587,map_iter:0.5926,map_mem:1401216,umap_fnd:0.5319,umap_nf:0.7408,umap_insert:1.0056,umap_erase:0.5729,umap_iter:0.1554,umap_mem:946424},
  {pattern:"random",N:43789,kntrie_fnd:0.9273,kntrie_nf:0.8253,kntrie_insert:3.7319,kntrie_erase:1.4667,kntrie_iter:1.8933,kntrie_mem:1053712,map_fnd:8.2378,map_nf:7.8386,map_insert:8.9142,map_erase:5.2522,map_iter:1.3315,map_mem:2101872,umap_fnd:0.8304,umap_nf:1.1879,umap_insert:1.4591,umap_erase:0.9157,umap_iter:0.2571,umap_mem:1414784},
  {pattern:"random",N:65684,kntrie_fnd:1.7341,kntrie_nf:1.5743,kntrie_insert:6.3540,kntrie_erase:2.0344,kntrie_iter:2.9570,kntrie_mem:1573904,map_fnd:14.1355,map_nf:13.8257,map_insert:15.1665,map_erase:8.9190,map_iter:2.3835,map_mem:3152832,umap_fnd:1.3860,umap_nf:1.9470,umap_insert:2.4531,umap_erase:1.5810,umap_iter:0.4385,umap_mem:2114872},
  {pattern:"random",N:98526,kntrie_fnd:2.9478,kntrie_nf:2.0758,kntrie_insert:9.0110,kntrie_erase:3.7062,kntrie_iter:4.5870,kntrie_mem:2102288,map_fnd:25.3653,map_nf:24.0013,map_insert:24.5525,map_erase:15.1544,map_iter:3.8123,map_mem:4729248,umap_fnd:2.2877,umap_nf:3.1050,umap_insert:4.2015,umap_erase:2.6811,umap_iter:0.8969,umap_mem:3162488},
  {pattern:"random",N:147789,kntrie_fnd:7.1322,kntrie_nf:4.6731,kntrie_insert:16.5921,kntrie_erase:6.1859,kntrie_iter:7.3804,kntrie_mem:4183056,map_fnd:47.9948,map_nf:46.2864,map_insert:45.1451,map_erase:28.5804,map_iter:6.9419,map_mem:7093872,umap_fnd:3.9239,umap_nf:5.1610,umap_insert:7.9643,umap_erase:5.1189,umap_iter:1.8855,umap_mem:4729280},
  {pattern:"random",N:221683,kntrie_fnd:10.2274,kntrie_nf:6.8125,kntrie_insert:25.3030,kntrie_erase:11.4740,kntrie_iter:10.9956,kntrie_mem:4199440,map_fnd:80.5188,map_nf:79.6365,map_insert:74.3511,map_erase:47.6534,map_iter:11.3163,map_mem:10640784,umap_fnd:5.7896,umap_nf:7.6524,umap_insert:11.9591,umap_erase:7.6996,umap_iter:3.0122,umap_mem:7215568},
  {pattern:"random",N:332525,kntrie_fnd:22.4508,kntrie_nf:15.1087,kntrie_insert:44.5841,kntrie_erase:19.4045,kntrie_iter:17.6713,kntrie_mem:8393744,map_fnd:139.1409,map_nf:137.4847,map_insert:127.6576,map_erase:82.8311,map_iter:19.5651,map_mem:15961200,umap_fnd:9.5856,umap_nf:12.2083,umap_insert:19.4992,umap_erase:12.4592,umap_iter:5.3810,umap_mem:10789088},
  {pattern:"random",N:498788,kntrie_fnd:34.7303,kntrie_nf:23.8787,kntrie_insert:81.9183,kntrie_erase:31.2952,kntrie_iter:26.4370,kntrie_mem:8524816,map_fnd:245.3931,map_nf:239.6778,map_insert:218.1820,map_erase:141.5967,map_iter:31.6400,map_mem:23941824,umap_fnd:15.7617,umap_nf:19.5914,umap_insert:34.4200,umap_erase:20.8246,umap_iter:9.4701,umap_mem:16132840},
  {pattern:"random",N:748182,kntrie_fnd:69.2232,kntrie_nf:50.7698,kntrie_insert:134.2686,kntrie_erase:58.7613,kntrie_iter:42.6362,kntrie_mem:16782352,map_fnd:422.7093,map_nf:409.3224,map_insert:366.5537,map_erase:232.8706,map_iter:54.5562,map_mem:35912736,umap_fnd:24.7162,umap_nf:30.4391,umap_insert:49.6742,umap_erase:31.3389,umap_iter:14.6359,umap_mem:24124760},
  {pattern:"random",N:1122274,kntrie_fnd:83.5496,kntrie_nf:69.9057,kntrie_insert:304.9402,kntrie_erase:55.5281,kntrie_iter:49.0553,kntrie_mem:27146000,umap_fnd:40.9668,umap_nf:49.2225,umap_insert:91.4981,umap_erase:56.8956,umap_iter:26.6236,umap_mem:36077144},
  {pattern:"random",N:1683411,kntrie_fnd:125.0298,kntrie_nf:100.9575,kntrie_insert:407.3481,kntrie_erase:134.5088,kntrie_iter:79.0573,kntrie_mem:37514256,umap_fnd:66.9907,umap_nf:78.0803,umap_insert:141.4129,umap_erase:95.3015,umap_iter:44.4626,umap_mem:53952736},
  {pattern:"random",N:2525116,kntrie_fnd:260.7682,kntrie_nf:204.4326,kntrie_insert:607.0205,kntrie_erase:255.5609,kntrie_iter:127.6703,kntrie_mem:62881040,umap_fnd:112.7846,umap_nf:119.6631,umap_insert:283.2074,umap_erase:150.9615,umap_iter:83.3450,umap_mem:82332776},
  {pattern:"random",N:3787675,kntrie_fnd:454.8140,kntrie_nf:338.8398,kntrie_insert:945.0762,kntrie_erase:406.5923,kntrie_iter:192.6942,kntrie_mem:81038352,umap_fnd:175.1759,umap_nf:201.0390,umap_insert:438.0834,umap_erase:308.8536,umap_iter:147.7941,umap_mem:123112448},
  {pattern:"random",N:5681512,kntrie_fnd:809.4540,kntrie_nf:597.9862,kntrie_insert:1425.7754,kntrie_erase:740.2569,kntrie_iter:297.7065,kntrie_mem:135109648,umap_fnd:306.7527,umap_nf:345.9391,umap_insert:799.9540,umap_erase:510.8800,umap_iter:275.0169,umap_mem:184095064},
  {pattern:"sequential",N:100,kntrie_fnd:0.0007,kntrie_nf:0.0007,kntrie_insert:0.0095,kntrie_erase:0.0042,kntrie_iter:0.0028,kntrie_mem:2056,map_fnd:0.0040,map_nf:0.0036,map_insert:0.0112,map_erase:0.0072,map_iter:0.0014,map_mem:4800,umap_fnd:0.0004,umap_nf:0.0007,umap_insert:0.0038,umap_erase:0.0015,umap_iter:0.0002,umap_mem:3224},
  {pattern:"sequential",N:150,kntrie_fnd:0.0012,kntrie_nf:0.0012,kntrie_insert:0.0121,kntrie_erase:0.0054,kntrie_iter:0.0045,kntrie_mem:4104,map_fnd:0.0065,map_nf:0.0059,map_insert:0.0195,map_erase:0.0111,map_iter:0.0020,map_mem:7200,umap_fnd:0.0005,umap_nf:0.0011,umap_insert:0.0046,umap_erase:0.0019,umap_iter:0.0003,umap_mem:4856},
  {pattern:"sequential",N:225,kntrie_fnd:0.0019,kntrie_nf:0.0016,kntrie_insert:0.0157,kntrie_erase:0.0070,kntrie_iter:0.0064,kntrie_mem:4104,map_fnd:0.0105,map_nf:0.0098,map_insert:0.0278,map_erase:0.0145,map_iter:0.0028,map_mem:10800,umap_fnd:0.0008,umap_nf:0.0016,umap_insert:0.0063,umap_erase:0.0018,umap_iter:0.0004,umap_mem:7216},
  {pattern:"sequential",N:337,kntrie_fnd:0.0030,kntrie_nf:0.0027,kntrie_insert:0.0283,kntrie_erase:0.0094,kntrie_iter:0.0105,kntrie_mem:8200,map_fnd:0.0170,map_nf:0.0156,map_insert:0.0405,map_erase:0.0208,map_iter:0.0040,map_mem:16176,umap_fnd:0.0012,umap_nf:0.0024,umap_insert:0.0087,umap_erase:0.0030,umap_iter:0.0006,umap_mem:10784},
  {pattern:"sequential",N:506,kntrie_fnd:0.0046,kntrie_nf:0.0044,kntrie_insert:0.0397,kntrie_erase:0.0129,kntrie_iter:0.0155,kntrie_mem:8200,map_fnd:0.0274,map_nf:0.0254,map_insert:0.0618,map_erase:0.0324,map_iter:0.0062,map_mem:24288,umap_fnd:0.0018,umap_nf:0.0038,umap_insert:0.0122,umap_erase:0.0040,umap_iter:0.0010,umap_mem:16472},
  {pattern:"sequential",N:759,kntrie_fnd:0.0079,kntrie_nf:0.0071,kntrie_insert:0.0593,kntrie_erase:0.0198,kntrie_iter:0.0256,kntrie_mem:16392,map_fnd:0.0462,map_nf:0.0436,map_insert:0.0941,map_erase:0.0487,map_iter:0.0084,map_mem:36432,umap_fnd:0.0027,umap_nf:0.0054,umap_insert:0.0172,umap_erase:0.0058,umap_iter:0.0015,umap_mem:24304},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0135,kntrie_nf:0.0127,kntrie_insert:0.0909,kntrie_erase:0.0242,kntrie_iter:0.0419,kntrie_mem:32776,map_fnd:0.0776,map_nf:0.0752,map_insert:0.1409,map_erase:0.0723,map_iter:0.0137,map_mem:54672,umap_fnd:0.0039,umap_nf:0.0085,umap_insert:0.0233,umap_erase:0.0080,umap_iter:0.0023,umap_mem:36880},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0191,kntrie_nf:0.0182,kntrie_insert:0.1244,kntrie_erase:0.0413,kntrie_iter:0.0627,kntrie_mem:32776,map_fnd:0.1285,map_nf:0.1267,map_insert:0.2185,map_erase:0.1163,map_iter:0.0214,map_mem:81984,umap_fnd:0.0059,umap_nf:0.0128,umap_insert:0.0341,umap_erase:0.0122,umap_iter:0.0034,umap_mem:54920},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0379,kntrie_nf:0.0317,kntrie_insert:0.2159,kntrie_erase:0.0630,kntrie_iter:0.1023,kntrie_mem:65544,map_fnd:0.2090,map_nf:0.2072,map_insert:0.3412,map_erase:0.1787,map_iter:0.0323,map_mem:122976,umap_fnd:0.0089,umap_nf:0.0206,umap_insert:0.0478,umap_erase:0.0185,umap_iter:0.0050,umap_mem:83512},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0573,kntrie_nf:0.0480,kntrie_insert:0.3245,kntrie_erase:0.0935,kntrie_iter:0.1535,kntrie_mem:65544,map_fnd:0.3487,map_nf:0.3504,map_insert:0.5449,map_erase:0.2969,map_iter:0.0497,map_mem:184512,umap_fnd:0.0136,umap_nf:0.0304,umap_insert:0.0706,umap_erase:0.0286,umap_iter:0.0073,umap_mem:124472},
  {pattern:"sequential",N:5766,kntrie_fnd:0.2050,kntrie_nf:0.1726,kntrie_insert:0.6055,kntrie_erase:0.1072,kntrie_iter:0.2215,kntrie_mem:70720,map_fnd:0.5654,map_nf:0.5679,map_insert:0.8398,map_erase:0.4608,map_iter:0.0755,map_mem:276768,umap_fnd:0.0202,umap_nf:0.0451,umap_insert:0.1032,umap_erase:0.0437,umap_iter:0.0107,umap_mem:186008},
  {pattern:"sequential",N:8649,kntrie_fnd:0.3112,kntrie_nf:0.2662,kntrie_insert:0.8508,kntrie_erase:0.2327,kntrie_iter:0.3364,kntrie_mem:105792,map_fnd:0.9307,map_nf:0.9359,map_insert:1.3402,map_erase:0.7343,map_iter:0.1192,map_mem:415152,umap_fnd:0.0304,umap_nf:0.0669,umap_insert:0.1519,umap_erase:0.0667,umap_iter:0.0158,umap_mem:277840},
  {pattern:"sequential",N:12974,kntrie_fnd:0.4709,kntrie_nf:0.3884,kntrie_insert:1.0728,kntrie_erase:0.3530,kntrie_iter:0.5018,kntrie_mem:158816,map_fnd:1.5386,map_nf:1.5561,map_insert:2.1186,map_erase:1.1728,map_iter:0.1880,map_mem:622752,umap_fnd:0.0450,umap_nf:0.0985,umap_insert:0.2350,umap_erase:0.1034,umap_iter:0.0234,umap_mem:415240},
  {pattern:"sequential",N:19461,kntrie_fnd:0.7084,kntrie_nf:0.5814,kntrie_insert:1.4971,kntrie_erase:0.5410,kntrie_iter:0.7505,kntrie_mem:238048,map_fnd:2.5416,map_nf:2.6262,map_insert:3.3567,map_erase:1.8823,map_iter:0.2857,map_mem:934128,umap_fnd:0.0679,umap_nf:0.1591,umap_insert:0.3388,umap_erase:0.1716,umap_iter:0.0347,umap_mem:633088},
  {pattern:"sequential",N:29192,kntrie_fnd:1.0835,kntrie_nf:0.8970,kntrie_insert:2.2140,kntrie_erase:0.8457,kntrie_iter:1.1239,kntrie_mem:357056,map_fnd:4.4902,map_nf:4.7429,map_insert:5.4106,map_erase:3.2516,map_iter:0.5884,map_mem:1401216,umap_fnd:0.1206,umap_nf:0.2354,umap_insert:0.4955,umap_erase:0.2601,umap_iter:0.0542,umap_mem:946424},
  {pattern:"sequential",N:43789,kntrie_fnd:1.7850,kntrie_nf:1.3677,kntrie_insert:4.0302,kntrie_erase:1.4768,kntrie_iter:1.9896,kntrie_mem:535264,map_fnd:8.2653,map_nf:8.4075,map_insert:9.0044,map_erase:5.3974,map_iter:1.4122,map_mem:2101872,umap_fnd:0.2240,umap_nf:0.3582,umap_insert:0.7669,umap_erase:0.4933,umap_iter:0.0818,umap_mem:1414784},
  {pattern:"sequential",N:65684,kntrie_fnd:2.5821,kntrie_nf:2.1782,kntrie_insert:5.8034,kntrie_erase:2.3071,kntrie_iter:2.8904,kntrie_mem:803768,map_fnd:14.0846,map_nf:14.3771,map_insert:15.1438,map_erase:8.8936,map_iter:2.3767,map_mem:3152832,umap_fnd:0.4251,umap_nf:0.6401,umap_insert:1.1217,umap_erase:0.9391,umap_iter:0.1206,umap_mem:2114872},
  {pattern:"sequential",N:98526,kntrie_fnd:3.9066,kntrie_nf:3.2490,kntrie_insert:8.5604,kntrie_erase:3.4247,kntrie_iter:4.1136,kntrie_mem:1204168,map_fnd:23.9259,map_nf:23.9689,map_insert:25.1285,map_erase:14.9801,map_iter:3.9366,map_mem:4729248,umap_fnd:0.7861,umap_nf:1.1041,umap_insert:1.8526,umap_erase:1.5609,umap_iter:0.2034,umap_mem:3162488},
  {pattern:"sequential",N:147789,kntrie_fnd:6.6701,kntrie_nf:5.3626,kntrie_insert:13.3710,kntrie_erase:5.2339,kntrie_iter:6.3477,kntrie_mem:1806096,map_fnd:46.1385,map_nf:46.0709,map_insert:43.2971,map_erase:27.9007,map_iter:7.0809,map_mem:7093872,umap_fnd:1.2925,umap_nf:2.0077,umap_insert:3.1594,umap_erase:3.2070,umap_iter:0.4012,umap_mem:4729280},
  {pattern:"sequential",N:221683,kntrie_fnd:10.0679,kntrie_nf:7.4243,kntrie_insert:20.2645,kntrie_erase:8.2519,kntrie_iter:9.3185,kntrie_mem:2708512,map_fnd:79.2654,map_nf:78.9873,map_insert:74.4972,map_erase:48.1911,map_iter:11.9573,map_mem:10640784,umap_fnd:2.2574,umap_nf:3.1150,umap_insert:5.2753,umap_erase:4.7563,umap_iter:0.6579,umap_mem:7215568},
  {pattern:"sequential",N:332525,kntrie_fnd:16.3140,kntrie_nf:11.4158,kntrie_insert:31.8060,kntrie_erase:13.7939,kntrie_iter:14.0690,kntrie_mem:4063248,map_fnd:142.7400,map_nf:142.2949,map_insert:126.3237,map_erase:82.4460,map_iter:18.3354,map_mem:15961200,umap_fnd:3.7712,umap_nf:4.9105,umap_insert:8.4740,umap_erase:7.5305,umap_iter:0.7801,umap_mem:10789088},
  {pattern:"sequential",N:498788,kntrie_fnd:27.0591,kntrie_nf:17.5990,kntrie_insert:52.6622,kntrie_erase:24.4559,kntrie_iter:21.1431,kntrie_mem:6094960,map_fnd:242.5323,map_nf:248.9651,map_insert:218.8502,map_erase:140.7164,map_iter:30.5700,map_mem:23941824,umap_fnd:6.3767,umap_nf:8.2627,umap_insert:13.3677,umap_erase:12.7604,umap_iter:1.1909,umap_mem:16132840},
  {pattern:"sequential",N:748182,kntrie_fnd:44.0067,kntrie_nf:28.6415,kntrie_insert:85.7211,kntrie_erase:43.4646,kntrie_iter:32.3414,kntrie_mem:9142192,map_fnd:424.1094,map_nf:423.5096,map_insert:371.3441,map_erase:237.5338,map_iter:57.3652,map_mem:35912736,umap_fnd:10.0983,umap_nf:12.7809,umap_insert:20.3919,umap_erase:20.0670,umap_iter:1.9415,umap_mem:24124760},
  {pattern:"sequential",N:1122274,kntrie_fnd:80.0678,kntrie_nf:47.4719,kntrie_insert:151.8469,kntrie_erase:75.8682,kntrie_iter:49.6860,kntrie_mem:13713968,umap_fnd:19.9822,umap_nf:20.8177,umap_insert:42.1649,umap_erase:34.6593,umap_iter:4.5110,umap_mem:36077144},
  {pattern:"sequential",N:1683411,kntrie_fnd:134.3738,kntrie_nf:77.4190,kntrie_insert:241.2886,kntrie_erase:126.0792,kntrie_iter:72.1815,kntrie_mem:20570432,umap_fnd:31.9164,umap_nf:31.6696,umap_insert:71.7447,umap_erase:51.8546,umap_iter:6.9028,umap_mem:53952736},
  {pattern:"sequential",N:2525116,kntrie_fnd:215.2781,kntrie_nf:141.3238,kntrie_insert:404.3188,kntrie_erase:212.1893,kntrie_iter:107.4450,kntrie_mem:30852312,umap_fnd:52.2953,umap_nf:56.4515,umap_insert:113.3484,umap_erase:89.8609,umap_iter:10.6693,umap_mem:82332776},
  {pattern:"sequential",N:3787675,kntrie_fnd:368.4873,kntrie_nf:230.9734,kntrie_insert:657.9006,kntrie_erase:352.9583,kntrie_iter:164.7204,kntrie_mem:46283712,umap_fnd:93.7959,umap_nf:101.4156,umap_insert:179.2163,umap_erase:177.5502,umap_iter:18.1682,umap_mem:123112448},
  {pattern:"sequential",N:5681512,kntrie_fnd:612.9365,kntrie_nf:379.8011,kntrie_insert:1087.5051,kntrie_erase:579.2658,kntrie_iter:244.2979,kntrie_mem:69425392,umap_fnd:162.8325,umap_nf:198.6430,umap_insert:281.9049,umap_erase:368.6239,umap_iter:29.0271,umap_mem:184095064},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const LINES_ITER = [
  { key: "kntrie", suffix: "iter", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "iter", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "iter", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "iter",   lines: LINES_ITER,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

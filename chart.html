<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  body { margin:0; background:#0f0f1a; color:#ddd; font-family:system-ui,sans-serif; }
  .wrap { max-width:700px; margin:0 auto; padding:16px 12px; }
  h2 { margin:0 0 4px; font-size:18px; font-weight:700; text-align:center; }
  .sub { text-align:center; color:#777; font-size:12px; margin:0 0 12px; }
  .btns { display:flex; justify-content:center; gap:8px; margin-bottom:16px; }
  .btns button { padding:6px 16px; border-radius:6px; border:1px solid #444;
    background:#1a1a2e; color:#aaa; cursor:pointer; font-size:13px; font-weight:600; }
  .btns button.active { background:#3b82f6; color:#fff; }
  .chart-box { margin-bottom:24px; }
  .chart-box h3 { margin:0 0 6px; font-size:14px; font-weight:600; text-align:center; }
  canvas { background:#12122a; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <h2>kntrie Benchmark (u64 &rarr; i32)</h2>
  <p class="sub">Log-log &middot; Per-entry &middot; Lower is better &middot; FND=100% hit, NF=100% miss</p>
  <div class="btns">
    <button class="active" onclick="show('random')">random</button>
    <button onclick="show('sequential')">sequential</button>
  </div>
  <div class="chart-box"><h3>Find (ns/entry)</h3><canvas id="c_find"></canvas></div>
  <div class="chart-box"><h3>Iteration (ns/entry)</h3><canvas id="c_iter"></canvas></div>
  <div class="chart-box"><h3>Insert (ns/entry)</h3><canvas id="c_insert"></canvas></div>
  <div class="chart-box"><h3>Erase N/2 (ns/entry)</h3><canvas id="c_erase"></canvas></div>
  <div class="chart-box"><h3>Memory (B/entry)</h3><canvas id="c_mem"></canvas></div>
</div>
<script>
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_fnd:0.0003,kntrie_nf:0.0002,kntrie_insert:0.0104,kntrie_erase:0.0059,kntrie_iter:0.0036,kntrie_mem:8224,map_fnd:0.0034,map_nf:0.0023,map_insert:0.0126,map_erase:0.0072,map_iter:0.0012,map_mem:4800,umap_fnd:0.0012,umap_nf:0.0018,umap_insert:0.0041,umap_erase:0.0029,umap_iter:0.0002,umap_mem:3224,kntrie_memneeded:2064},
  {pattern:"random",N:150,kntrie_fnd:0.0006,kntrie_nf:0.0003,kntrie_insert:0.0102,kntrie_erase:0.0077,kntrie_iter:0.0045,kntrie_mem:8224,map_fnd:0.0055,map_nf:0.0043,map_insert:0.0181,map_erase:0.0103,map_iter:0.0020,map_mem:7200,umap_fnd:0.0017,umap_nf:0.0021,umap_insert:0.0065,umap_erase:0.0032,umap_iter:0.0003,umap_mem:4856,kntrie_memneeded:3048},
  {pattern:"random",N:225,kntrie_fnd:0.0012,kntrie_nf:0.0005,kntrie_insert:0.0083,kntrie_erase:0.0068,kntrie_iter:0.0051,kntrie_mem:12336,map_fnd:0.0090,map_nf:0.0075,map_insert:0.0250,map_erase:0.0128,map_iter:0.0023,map_mem:10800,umap_fnd:0.0029,umap_nf:0.0039,umap_insert:0.0088,umap_erase:0.0041,umap_iter:0.0004,umap_mem:7216,kntrie_memneeded:4416},
  {pattern:"random",N:337,kntrie_fnd:0.0026,kntrie_nf:0.0012,kntrie_insert:0.0123,kntrie_erase:0.0131,kntrie_iter:0.0068,kntrie_mem:16448,map_fnd:0.0150,map_nf:0.0119,map_insert:0.0353,map_erase:0.0176,map_iter:0.0035,map_mem:16176,umap_fnd:0.0039,umap_nf:0.0062,umap_insert:0.0114,umap_erase:0.0052,umap_iter:0.0006,umap_mem:10784,kntrie_memneeded:6320},
  {pattern:"random",N:506,kntrie_fnd:0.0043,kntrie_nf:0.0030,kntrie_insert:0.0284,kntrie_erase:0.0206,kntrie_iter:0.0094,kntrie_mem:24656,map_fnd:0.0248,map_nf:0.0193,map_insert:0.0544,map_erase:0.0293,map_iter:0.0051,map_mem:24288,umap_fnd:0.0057,umap_nf:0.0086,umap_insert:0.0161,umap_erase:0.0080,umap_iter:0.0008,umap_mem:16472,kntrie_memneeded:9128},
  {pattern:"random",N:759,kntrie_fnd:0.0069,kntrie_nf:0.0067,kntrie_insert:0.0420,kntrie_erase:0.0288,kntrie_iter:0.0148,kntrie_mem:36960,map_fnd:0.0398,map_nf:0.0319,map_insert:0.0835,map_erase:0.0436,map_iter:0.0081,map_mem:36432,umap_fnd:0.0092,umap_nf:0.0141,umap_insert:0.0231,umap_erase:0.0119,umap_iter:0.0013,umap_mem:24304,kntrie_memneeded:13256},
  {pattern:"random",N:1139,kntrie_fnd:0.0096,kntrie_nf:0.0098,kntrie_insert:0.0439,kntrie_erase:0.0366,kntrie_iter:0.0210,kntrie_mem:36960,map_fnd:0.0660,map_nf:0.0583,map_insert:0.1198,map_erase:0.0638,map_iter:0.0126,map_mem:54672,umap_fnd:0.0135,umap_nf:0.0202,umap_insert:0.0314,umap_erase:0.0145,umap_iter:0.0022,umap_mem:36880,kntrie_memneeded:19520},
  {pattern:"random",N:1708,kntrie_fnd:0.0147,kntrie_nf:0.0125,kntrie_insert:0.0674,kntrie_erase:0.0497,kntrie_iter:0.0344,kntrie_mem:65664,map_fnd:0.1105,map_nf:0.0949,map_insert:0.1833,map_erase:0.0981,map_iter:0.0198,map_mem:81984,umap_fnd:0.0221,umap_nf:0.0327,umap_insert:0.0462,umap_erase:0.0236,umap_iter:0.0043,umap_mem:54920,kntrie_memneeded:29840},
  {pattern:"random",N:2562,kntrie_fnd:0.0195,kntrie_nf:0.0188,kntrie_insert:0.1079,kntrie_erase:0.0661,kntrie_iter:0.0562,kntrie_mem:86160,map_fnd:0.1847,map_nf:0.1686,map_insert:0.2861,map_erase:0.1566,map_iter:0.0296,map_mem:122976,umap_fnd:0.0333,umap_nf:0.0489,umap_insert:0.0693,umap_erase:0.0350,umap_iter:0.0075,umap_mem:83512,kntrie_memneeded:44480},
  {pattern:"random",N:3844,kntrie_fnd:0.0377,kntrie_nf:0.0305,kntrie_insert:0.1767,kntrie_erase:0.0824,kntrie_iter:0.0894,kntrie_mem:151728,map_fnd:0.2980,map_nf:0.2818,map_insert:0.4443,map_erase:0.2415,map_iter:0.0431,map_mem:184512,umap_fnd:0.0538,umap_nf:0.0754,umap_insert:0.1029,umap_erase:0.0565,umap_iter:0.0128,umap_mem:124472,kntrie_memneeded:66272},
  {pattern:"random",N:5766,kntrie_fnd:0.0445,kntrie_nf:0.0367,kntrie_insert:0.3509,kntrie_erase:0.1410,kntrie_iter:0.1429,kntrie_mem:257264,map_fnd:0.4920,map_nf:0.4705,map_insert:0.7172,map_erase:0.3916,map_iter:0.0669,map_mem:276768,umap_fnd:0.0841,umap_nf:0.1194,umap_insert:0.1575,umap_erase:0.0851,umap_iter:0.0203,umap_mem:186008,kntrie_memneeded:96896},
  {pattern:"random",N:8649,kntrie_fnd:0.1023,kntrie_nf:0.0903,kntrie_insert:0.4366,kntrie_erase:0.1834,kntrie_iter:0.2281,kntrie_mem:372888,map_fnd:0.8480,map_nf:0.8363,map_insert:1.1967,map_erase:0.6276,map_iter:0.1054,map_mem:415152,umap_fnd:0.1273,umap_nf:0.1806,umap_insert:0.2321,umap_erase:0.1367,umap_iter:0.0320,umap_mem:277840,kntrie_memneeded:159104},
  {pattern:"random",N:12974,kntrie_fnd:0.1188,kntrie_nf:0.0986,kntrie_insert:0.6572,kntrie_erase:0.2880,kntrie_iter:0.3555,kntrie_mem:458184,map_fnd:1.4622,map_nf:1.3677,map_insert:1.9278,map_erase:1.0178,map_iter:0.1888,map_mem:622752,umap_fnd:0.1991,umap_nf:0.2826,umap_insert:0.3710,umap_erase:0.1987,umap_iter:0.0500,umap_mem:415240,kntrie_memneeded:204416},
  {pattern:"random",N:19461,kntrie_fnd:0.2167,kntrie_nf:0.1748,kntrie_insert:1.0871,kntrie_erase:0.4262,kntrie_iter:0.5824,kntrie_mem:630224,map_fnd:2.5065,map_nf:2.3959,map_insert:2.9320,map_erase:1.6474,map_iter:0.3139,map_mem:934128,umap_fnd:0.3002,umap_nf:0.4128,umap_insert:0.5441,umap_erase:0.3277,umap_iter:0.0817,umap_mem:633088,kntrie_memneeded:376064},
  {pattern:"random",N:29192,kntrie_fnd:0.3440,kntrie_nf:0.2691,kntrie_insert:1.7042,kntrie_erase:0.6538,kntrie_iter:0.8860,kntrie_mem:678608,map_fnd:5.0586,map_nf:4.3242,map_insert:4.8414,map_erase:2.8519,map_iter:0.7865,map_mem:1401216,umap_fnd:0.4683,umap_nf:0.6462,umap_insert:0.8462,umap_erase:0.4879,umap_iter:0.1378,umap_mem:946424,kntrie_memneeded:424448},
  {pattern:"random",N:43789,kntrie_fnd:0.6126,kntrie_nf:0.4619,kntrie_insert:2.6789,kntrie_erase:1.1224,kntrie_iter:1.4412,kntrie_mem:1042640,map_fnd:9.3462,map_nf:8.8477,map_insert:8.3414,map_erase:5.3295,map_iter:2.2922,map_mem:2101872,umap_fnd:0.8046,umap_nf:1.0600,umap_insert:1.3651,umap_erase:0.8664,umap_iter:0.2480,umap_mem:1414784,kntrie_memneeded:788480},
  {pattern:"random",N:65684,kntrie_fnd:1.1819,kntrie_nf:0.9799,kntrie_insert:4.7183,kntrie_erase:1.5162,kntrie_iter:2.3037,kntrie_mem:1432784,map_fnd:16.6745,map_nf:15.4447,map_insert:14.5394,map_erase:9.4819,map_iter:3.0439,map_mem:3152832,umap_fnd:1.3998,umap_nf:1.8201,umap_insert:2.5354,umap_erase:1.6701,umap_iter:0.4931,umap_mem:2114872,kntrie_memneeded:1178624},
  {pattern:"random",N:98526,kntrie_fnd:2.0198,kntrie_nf:1.3455,kntrie_insert:6.7859,kntrie_erase:2.9256,kntrie_iter:3.5081,kntrie_mem:1829072,map_fnd:28.8914,map_nf:29.0512,map_insert:26.5897,map_erase:16.6655,map_iter:5.3704,map_mem:4729248,umap_fnd:2.3986,umap_nf:3.0141,umap_insert:4.4148,umap_erase:2.9689,umap_iter:1.0662,umap_mem:3162488,kntrie_memneeded:1574912},
  {pattern:"random",N:147789,kntrie_fnd:6.1552,kntrie_nf:3.4721,kntrie_insert:12.9381,kntrie_erase:4.5696,kntrie_iter:5.8746,kntrie_mem:3389648,map_fnd:57.1476,map_nf:55.9421,map_insert:47.3603,map_erase:31.8034,map_iter:10.0940,map_mem:7093872,umap_fnd:3.9106,umap_nf:5.0735,umap_insert:7.9111,umap_erase:5.1863,umap_iter:2.3725,umap_mem:4729280,kntrie_memneeded:3135488},
  {pattern:"random",N:221683,kntrie_fnd:11.6735,kntrie_nf:5.9867,kntrie_insert:23.8536,kntrie_erase:11.2552,kntrie_iter:8.7147,kntrie_mem:3401936,map_fnd:123.0484,map_nf:128.5380,map_insert:99.2285,map_erase:60.5603,map_iter:19.1275,map_mem:10640784,umap_fnd:6.8543,umap_nf:8.5980,umap_insert:15.3367,umap_erase:10.4435,umap_iter:4.3279,umap_mem:7215568,kntrie_memneeded:3147776},
  {pattern:"random",N:332525,kntrie_fnd:21.7718,kntrie_nf:14.0945,kntrie_insert:41.2356,kntrie_erase:17.1131,kntrie_iter:14.2588,kntrie_mem:6547664,umap_fnd:10.2987,umap_nf:12.5941,umap_insert:25.4665,umap_erase:14.6884,umap_iter:7.4462,umap_mem:10789088,kntrie_memneeded:6293504},
  {pattern:"random",N:498788,kntrie_fnd:34.2423,kntrie_nf:22.0667,kntrie_insert:77.7151,kntrie_erase:30.9554,kntrie_iter:20.8703,kntrie_mem:6645968,umap_fnd:17.6960,umap_nf:20.2953,umap_insert:42.3806,umap_erase:23.5602,umap_iter:12.7662,umap_mem:16132840,kntrie_memneeded:6391808},
  {pattern:"random",N:748182,kntrie_fnd:73.4642,kntrie_nf:51.5609,kntrie_insert:140.1943,kntrie_erase:56.9237,kntrie_iter:33.8750,kntrie_mem:12839120,umap_fnd:29.1033,umap_nf:34.7270,umap_insert:69.7763,umap_erase:46.1466,umap_iter:25.9430,umap_mem:24124760,kntrie_memneeded:12584960},
  {pattern:"random",N:1122274,kntrie_fnd:73.4721,kntrie_nf:55.9268,kntrie_insert:294.9124,kntrie_erase:100.5796,kntrie_iter:38.5822,kntrie_mem:33034264,umap_fnd:47.0784,umap_nf:53.3029,umap_insert:105.8096,umap_erase:72.9342,umap_iter:46.5061,umap_mem:36077144,kntrie_memneeded:20685888},
  {pattern:"random",N:1683411,kntrie_fnd:122.2430,kntrie_nf:88.5710,kntrie_insert:426.3525,kntrie_erase:174.5516,kntrie_iter:66.6199,kntrie_mem:55934864,umap_fnd:82.2876,umap_nf:89.1829,umap_insert:196.5407,umap_erase:122.0805,umap_iter:79.5400,umap_mem:53952736,kntrie_memneeded:28462080},
  {pattern:"random",N:2525116,kntrie_fnd:226.0953,kntrie_nf:175.4600,kntrie_insert:626.0192,kntrie_erase:287.7049,kntrie_iter:112.1177,kntrie_mem:93632920,umap_fnd:141.5754,umap_nf:172.2875,umap_insert:360.3206,umap_erase:231.1861,umap_iter:131.7625,umap_mem:82332776,kntrie_memneeded:47487168},
  {pattern:"random",N:3787675,kntrie_fnd:395.5356,kntrie_nf:282.4368,kntrie_insert:1061.0808,kntrie_erase:488.8050,kntrie_iter:165.9279,kntrie_mem:111493328,umap_fnd:267.6859,umap_nf:295.9821,umap_insert:684.6640,umap_erase:424.4321,umap_iter:265.1049,umap_mem:123112448,kntrie_memneeded:61105152},
  {pattern:"random",N:5681512,kntrie_fnd:860.8934,kntrie_nf:743.7522,kntrie_insert:1819.9325,kntrie_erase:1031.3636,kntrie_iter:261.5280,kntrie_mem:152052288,umap_fnd:418.1922,umap_nf:469.1654,umap_insert:1204.5991,umap_erase:696.0167,umap_iter:399.9602,umap_mem:184095064,kntrie_memneeded:101658624},
  {pattern:"sequential",N:100,kntrie_fnd:0.0008,kntrie_nf:0.0006,kntrie_insert:0.0128,kntrie_erase:0.0073,kntrie_iter:0.0042,kntrie_mem:26200,map_fnd:0.0035,map_nf:0.0032,map_insert:0.0123,map_erase:0.0067,map_iter:0.0013,map_mem:4800,umap_fnd:0.0003,umap_nf:0.0007,umap_insert:0.0038,umap_erase:0.0022,umap_iter:0.0002,umap_mem:3224,kntrie_memneeded:1544},
  {pattern:"sequential",N:150,kntrie_fnd:0.0013,kntrie_nf:0.0010,kntrie_insert:0.0176,kntrie_erase:0.0083,kntrie_iter:0.0065,kntrie_mem:27736,map_fnd:0.0058,map_nf:0.0052,map_insert:0.0168,map_erase:0.0101,map_iter:0.0018,map_mem:7200,umap_fnd:0.0005,umap_nf:0.0010,umap_insert:0.0046,umap_erase:0.0023,umap_iter:0.0003,umap_mem:4856,kntrie_memneeded:3080},
  {pattern:"sequential",N:225,kntrie_fnd:0.0018,kntrie_nf:0.0015,kntrie_insert:0.0187,kntrie_erase:0.0082,kntrie_iter:0.0084,kntrie_mem:27736,map_fnd:0.0095,map_nf:0.0087,map_insert:0.0241,map_erase:0.0124,map_iter:0.0023,map_mem:10800,umap_fnd:0.0007,umap_nf:0.0014,umap_insert:0.0056,umap_erase:0.0024,umap_iter:0.0004,umap_mem:7216,kntrie_memneeded:3080},
  {pattern:"sequential",N:337,kntrie_fnd:0.0031,kntrie_nf:0.0026,kntrie_insert:0.0286,kntrie_erase:0.0113,kntrie_iter:0.0127,kntrie_mem:30808,map_fnd:0.0154,map_nf:0.0142,map_insert:0.0353,map_erase:0.0181,map_iter:0.0035,map_mem:16176,umap_fnd:0.0011,umap_nf:0.0021,umap_insert:0.0074,umap_erase:0.0029,umap_iter:0.0006,umap_mem:10784,kntrie_memneeded:6152},
  {pattern:"sequential",N:506,kntrie_fnd:0.0049,kntrie_nf:0.0040,kntrie_insert:0.0444,kntrie_erase:0.0148,kntrie_iter:0.0187,kntrie_mem:30808,map_fnd:0.0253,map_nf:0.0231,map_insert:0.0537,map_erase:0.0297,map_iter:0.0050,map_mem:24288,umap_fnd:0.0017,umap_nf:0.0035,umap_insert:0.0109,umap_erase:0.0041,umap_iter:0.0009,umap_mem:16472,kntrie_memneeded:6152},
  {pattern:"sequential",N:759,kntrie_fnd:0.0078,kntrie_nf:0.0068,kntrie_insert:0.0582,kntrie_erase:0.0232,kntrie_iter:0.0299,kntrie_mem:36952,map_fnd:0.0404,map_nf:0.0370,map_insert:0.0810,map_erase:0.0435,map_iter:0.0084,map_mem:36432,umap_fnd:0.0025,umap_nf:0.0048,umap_insert:0.0149,umap_erase:0.0062,umap_iter:0.0013,umap_mem:24304,kntrie_memneeded:12296},
  {pattern:"sequential",N:1139,kntrie_fnd:0.0130,kntrie_nf:0.0113,kntrie_insert:0.0925,kntrie_erase:0.0230,kntrie_iter:0.0471,kntrie_mem:49240,map_fnd:0.0705,map_nf:0.0659,map_insert:0.1264,map_erase:0.0689,map_iter:0.0123,map_mem:54672,umap_fnd:0.0035,umap_nf:0.0076,umap_insert:0.0206,umap_erase:0.0067,umap_iter:0.0020,umap_mem:36880,kntrie_memneeded:24584},
  {pattern:"sequential",N:1708,kntrie_fnd:0.0189,kntrie_nf:0.0163,kntrie_insert:0.1288,kntrie_erase:0.0414,kntrie_iter:0.0780,kntrie_mem:49240,map_fnd:0.1195,map_nf:0.1112,map_insert:0.1960,map_erase:0.1011,map_iter:0.0194,map_mem:81984,umap_fnd:0.0054,umap_nf:0.0114,umap_insert:0.0278,umap_erase:0.0105,umap_iter:0.0029,umap_mem:54920,kntrie_memneeded:24584},
  {pattern:"sequential",N:2562,kntrie_fnd:0.0343,kntrie_nf:0.0279,kntrie_insert:0.2244,kntrie_erase:0.0611,kntrie_iter:0.1116,kntrie_mem:73816,map_fnd:0.1846,map_nf:0.1813,map_insert:0.2896,map_erase:0.1595,map_iter:0.0299,map_mem:122976,umap_fnd:0.0080,umap_nf:0.0186,umap_insert:0.0415,umap_erase:0.0166,umap_iter:0.0042,umap_mem:83512,kntrie_memneeded:49160},
  {pattern:"sequential",N:3844,kntrie_fnd:0.0510,kntrie_nf:0.0415,kntrie_insert:0.3064,kntrie_erase:0.0901,kntrie_iter:0.1671,kntrie_mem:73816,map_fnd:0.3030,map_nf:0.3014,map_insert:0.4692,map_erase:0.2564,map_iter:0.0448,map_mem:184512,umap_fnd:0.0122,umap_nf:0.0272,umap_insert:0.0619,umap_erase:0.0257,umap_iter:0.0062,umap_mem:124472,kntrie_memneeded:49160},
  {pattern:"sequential",N:5766,kntrie_fnd:0.1555,kntrie_nf:0.1336,kntrie_insert:0.5470,kntrie_erase:0.1384,kntrie_iter:0.2118,kntrie_mem:101728,map_fnd:0.4965,map_nf:0.4981,map_insert:0.7302,map_erase:0.4022,map_iter:0.0687,map_mem:276768,umap_fnd:0.0195,umap_nf:0.0405,umap_insert:0.0921,umap_erase:0.0386,umap_iter:0.0093,umap_mem:186008,kntrie_memneeded:36128},
  {pattern:"sequential",N:8649,kntrie_fnd:0.2343,kntrie_nf:0.2019,kntrie_insert:0.6522,kntrie_erase:0.1909,kntrie_iter:0.3066,kntrie_mem:168400,map_fnd:0.8319,map_nf:0.8211,map_insert:1.1570,map_erase:0.6144,map_iter:0.1053,map_mem:415152,umap_fnd:0.0298,umap_nf:0.0602,umap_insert:0.1334,umap_erase:0.0595,umap_iter:0.0136,umap_mem:277840,kntrie_memneeded:53936},
  {pattern:"sequential",N:12974,kntrie_fnd:0.3596,kntrie_nf:0.3009,kntrie_insert:0.8495,kntrie_erase:0.2902,kntrie_iter:0.4579,kntrie_mem:277536,map_fnd:1.3783,map_nf:1.4138,map_insert:1.8330,map_erase:1.0401,map_iter:0.1697,map_mem:622752,umap_fnd:0.0486,umap_nf:0.0867,umap_insert:0.2297,umap_erase:0.0899,umap_iter:0.0204,umap_mem:415240,kntrie_memneeded:81008},
  {pattern:"sequential",N:19461,kntrie_fnd:0.5527,kntrie_nf:0.4542,kntrie_insert:1.2533,kntrie_erase:0.4414,kntrie_iter:0.6949,kntrie_mem:374880,map_fnd:2.5071,map_nf:2.4774,map_insert:2.9125,map_erase:1.6888,map_iter:0.2855,map_mem:934128,umap_fnd:0.0662,umap_nf:0.1438,umap_insert:0.3027,umap_erase:0.1430,umap_iter:0.0326,umap_mem:633088,kntrie_memneeded:120784},
  {pattern:"sequential",N:29192,kntrie_fnd:0.8422,kntrie_nf:0.6913,kntrie_insert:1.7122,kntrie_erase:0.6775,kntrie_iter:1.0385,kntrie_mem:599872,map_fnd:4.4286,map_nf:4.6911,map_insert:4.7986,map_erase:2.9465,map_iter:0.7487,map_mem:1401216,umap_fnd:0.1189,umap_nf:0.2214,umap_insert:0.4488,umap_erase:0.2367,umap_iter:0.0490,umap_mem:946424,kntrie_memneeded:181936},
  {pattern:"sequential",N:43789,kntrie_fnd:1.2611,kntrie_nf:1.0170,kntrie_insert:3.0156,kntrie_erase:1.1915,kntrie_iter:1.7518,kntrie_mem:804736,map_fnd:8.9451,map_nf:9.0000,map_insert:8.1386,map_erase:5.2196,map_iter:1.7177,map_mem:2101872,umap_fnd:0.3200,umap_nf:0.4467,umap_insert:0.6654,umap_erase:0.5210,umap_iter:0.0845,umap_mem:1414784,kntrie_memneeded:272368},
  {pattern:"sequential",N:65684,kntrie_fnd:1.9253,kntrie_nf:1.5336,kntrie_insert:4.3362,kntrie_erase:1.8008,kntrie_iter:2.5900,kntrie_mem:1265480,map_fnd:17.0279,map_nf:17.0480,map_insert:14.2604,map_erase:9.5963,map_iter:3.4092,map_mem:3152832,umap_fnd:0.6992,umap_nf:0.9265,umap_insert:1.0226,umap_erase:1.0556,umap_iter:0.1266,umap_mem:2114872,kntrie_memneeded:409400},
  {pattern:"sequential",N:98526,kntrie_fnd:3.0160,kntrie_nf:2.4970,kntrie_insert:6.7918,kntrie_erase:2.8882,kntrie_iter:3.9217,kntrie_mem:1977208,map_fnd:32.0695,map_nf:31.7722,map_insert:27.2976,map_erase:17.5156,map_iter:5.6817,map_mem:4729248,umap_fnd:1.2880,umap_nf:1.5828,umap_insert:1.8327,umap_erase:2.0372,umap_iter:0.1991,umap_mem:3162488,kntrie_memneeded:613304},
  {pattern:"sequential",N:147789,kntrie_fnd:4.5035,kntrie_nf:3.5782,kntrie_insert:10.1308,kntrie_erase:4.1751,kntrie_iter:5.8301,kntrie_mem:3077584,map_fnd:57.7878,map_nf:60.3240,map_insert:48.3678,map_erase:31.4797,map_iter:10.6407,map_mem:7093872,umap_fnd:2.1642,umap_nf:2.5341,umap_insert:3.6142,umap_erase:3.9611,umap_iter:0.3213,umap_mem:4729280,kntrie_memneeded:919408},
  {pattern:"sequential",N:221683,kntrie_fnd:7.0836,kntrie_nf:5.5019,kntrie_insert:15.5605,kntrie_erase:6.5470,kntrie_iter:8.7797,kntrie_mem:4781840,map_fnd:107.4184,map_nf:114.3942,map_insert:87.8399,map_erase:57.5107,map_iter:18.0772,map_mem:10640784,umap_fnd:3.5827,umap_nf:4.0897,umap_insert:7.0919,umap_erase:6.8500,umap_iter:0.4933,umap_mem:7215568,kntrie_memneeded:1378608},
  {pattern:"sequential",N:332525,kntrie_fnd:12.4725,kntrie_nf:8.5864,kntrie_insert:25.4345,kntrie_erase:10.7831,kntrie_iter:13.4016,kntrie_mem:6335360,umap_fnd:6.3117,umap_nf:5.8898,umap_insert:11.0969,umap_erase:8.8528,umap_iter:1.4691,umap_mem:10789088,kntrie_memneeded:2068240},
  {pattern:"sequential",N:498788,kntrie_fnd:23.2057,kntrie_nf:13.0484,kntrie_insert:42.9513,kntrie_erase:19.0126,kntrie_iter:20.2205,kntrie_mem:9802272,umap_fnd:10.4294,umap_nf:9.8139,umap_insert:18.9412,umap_erase:15.1979,umap_iter:2.3810,umap_mem:16132840,kntrie_memneeded:3102256},
  {pattern:"sequential",N:748182,kntrie_fnd:43.9175,kntrie_nf:20.3484,kntrie_insert:72.4949,kntrie_erase:42.6038,kntrie_iter:30.4789,kntrie_mem:15159168,umap_fnd:16.5031,umap_nf:15.4302,umap_insert:33.6124,umap_erase:23.8118,umap_iter:3.6384,umap_mem:24124760,kntrie_memneeded:4653152},
  {pattern:"sequential",N:1122274,kntrie_fnd:70.1904,kntrie_nf:32.2796,kntrie_insert:128.0763,kntrie_erase:66.0829,kntrie_iter:45.2240,kntrie_mem:23437328,umap_fnd:27.4232,umap_nf:23.8423,umap_insert:49.4845,umap_erase:42.4755,umap_iter:5.7026,umap_mem:36077144,kntrie_memneeded:6980192},
  {pattern:"sequential",N:1683411,kntrie_fnd:134.8118,kntrie_nf:59.4929,kntrie_insert:231.5203,kntrie_erase:125.9489,kntrie_iter:69.1000,kntrie_mem:36229952,umap_fnd:50.7545,umap_nf:47.7671,umap_insert:97.5852,umap_erase:100.3842,umap_iter:9.1470,umap_mem:53952736,kntrie_memneeded:10470064},
  {pattern:"sequential",N:2525116,kntrie_fnd:252.7998,kntrie_nf:113.0941,kntrie_insert:406.1923,kntrie_erase:222.9948,kntrie_iter:103.1232,kntrie_mem:47924984,umap_fnd:91.6182,umap_nf:118.5026,umap_insert:161.7682,umap_erase:225.2489,umap_iter:13.6851,umap_mem:82332776,kntrie_memneeded:15705304},
  {pattern:"sequential",N:3787675,kntrie_fnd:412.9761,kntrie_nf:236.6513,kntrie_insert:723.2711,kntrie_erase:390.3378,kntrie_iter:154.9236,kntrie_mem:73951232,umap_fnd:171.5740,umap_nf:218.7273,umap_insert:278.9629,umap_erase:341.5126,umap_iter:20.4015,umap_mem:123112448,kntrie_memneeded:23557776},
  {pattern:"sequential",N:5681512,kntrie_fnd:766.1265,kntrie_nf:414.3632,kntrie_insert:1259.3534,kntrie_erase:702.9677,kntrie_iter:234.1587,kntrie_mem:114123088,umap_fnd:258.4617,umap_nf:350.0240,umap_insert:523.8525,umap_erase:524.5489,umap_iter:29.1107,umap_mem:184095064,kntrie_memneeded:35336464},
];


const LINES_FIND = [
  { key: "kntrie", suffix: "fnd", color: "#3b82f6", dash: [],    width: 2.5, label: "kntrie FND" },
  { key: "kntrie", suffix: "nf", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie NF" },
  { key: "map",    suffix: "fnd", color: "#ef4444", dash: [],    width: 2.5, label: "map FND" },
  { key: "map",    suffix: "nf", color: "#fca5a5", dash: [6,3], width: 1.5, label: "map NF" },
  { key: "umap",   suffix: "fnd", color: "#22c55e", dash: [],    width: 2.5, label: "umap FND" },
  { key: "umap",   suffix: "nf", color: "#86efac", dash: [6,3], width: 1.5, label: "umap NF" },
];

const LINES_OP = [
  { key: "kntrie", suffix: "insert", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "insert", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "insert", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_ERASE = [
  { key: "kntrie", suffix: "erase", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "erase", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "erase", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const LINES_MEM = [
  { key: "kntrie", suffix: "mem", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "kntrie", suffix: "memneeded", color: "#93c5fd", dash: [6,3], width: 1.5, label: "kntrie needed" },
  { key: "map",    suffix: "mem", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "mem", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
  { key: "raw",    suffix: "mem", color: "#888",    dash: [3,3], width: 1, label: "raw (16B)" },
];

const LINES_ITER = [
  { key: "kntrie", suffix: "iter", color: "#3b82f6", dash: [], width: 2.5, label: "kntrie" },
  { key: "map",    suffix: "iter", color: "#ef4444", dash: [], width: 2.5, label: "map" },
  { key: "umap",   suffix: "iter", color: "#22c55e", dash: [], width: 2.5, label: "umap" },
];

const METRICS = [
  { id: "find",   lines: LINES_FIND,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "iter",   lines: LINES_ITER,  convert: (ms, n) => (ms * 1e6) / n },
  { id: "insert", lines: LINES_OP,    convert: (ms, n) => (ms * 1e6) / n },
  { id: "erase",  lines: LINES_ERASE, convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { id: "mem",    lines: LINES_MEM,   convert: (b, n) => b / n },
];

function buildData(pattern, metric) {
  return RAW_DATA
    .filter(r => r.pattern === pattern)
    .map(r => {
      const pt = { N: r.N };
      for (const l of metric.lines) {
        if (l.key === "raw") { pt["raw_mem"] = 16; continue; }
        const raw = r[l.key + "_" + l.suffix];
        if (raw != null) pt[l.key + "_" + l.suffix] = metric.convert(raw, r.N);
      }
      return pt;
    });
}

const charts = {};

function makeChart(canvasId, metric) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  const data = buildData("random", metric);

  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(d => d.N),
      datasets: metric.lines.map(l => ({
        label: l.label,
        data: data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null),
        borderColor: l.color,
        backgroundColor: l.color + "33",
        borderWidth: l.width,
        borderDash: l.dash,
        pointRadius: 0,
        pointHitRadius: 8,
        tension: 0.2,
        spanGaps: true,
      })),
    },
    options: {
      responsive: true,
      interaction: { mode: "index", intersect: false },
      plugins: {
        legend: { display: true, labels: { color: "#bbb", font: { size: 11 }, boxWidth: 20, padding: 10 } },
        tooltip: {
          backgroundColor: "#1a1a2e",
          borderColor: "#444",
          borderWidth: 1,
          titleColor: "#aaa",
          bodyColor: "#ddd",
          callbacks: {
            title: (items) => {
              const v = items[0].parsed.x;
              if (v >= 1e6) return "N = " + (v/1e6).toFixed(1) + "M";
              if (v >= 1e3) return "N = " + (v/1e3).toFixed(1) + "K";
              return "N = " + v;
            },
            label: (item) => {
              const v = item.parsed.y;
              if (v == null) return null;
              const s = v < 0.1 ? v.toFixed(3) : v < 10 ? v.toFixed(2) : v < 1000 ? v.toFixed(1) : v.toFixed(0);
              return " " + item.dataset.label + ": " + s;
            },
          },
        },
      },
      scales: {
        x: {
          type: "logarithmic",
          title: { display: false },
          ticks: { color: "#888", font: { size: 11 },
            callback: (v) => v >= 1e6 ? (v/1e6)+"M" : v >= 1e3 ? (v/1e3)+"K" : v },
          grid: { color: "#2a2a3e" },
        },
        y: {
          type: "logarithmic",
          ticks: { color: "#888", font: { size: 10 },
            callback: (v) => v < 0.1 ? v.toFixed(2) : v < 10 ? v.toFixed(1) : v >= 1000 ? v.toFixed(0) : v.toFixed(1) },
          grid: { color: "#2a2a3e" },
        },
      },
    },
  });
  charts[canvasId]._metric = metric;
}

METRICS.forEach(m => makeChart("c_" + m.id, m));

function show(pattern) {
  document.querySelectorAll(".btns button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  for (const [id, chart] of Object.entries(charts)) {
    const m = chart._metric;
    const data = buildData(pattern, m);
    chart.data.labels = data.map(d => d.N);
    m.lines.forEach((l, i) => {
      chart.data.datasets[i].data = data.map(d => d[l.key === "raw" ? "raw_mem" : l.key + "_" + l.suffix] ?? null);
    });
    chart.update("none");
  }
}
</script>
</body>
</html>

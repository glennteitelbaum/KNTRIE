<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kntrie Benchmark</title>
<style>body{margin:0;background:#0f0f1a;}</style>
</head>
<body>
<div id="root"></div>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom"
  }
}
</script>
<script type="module">
import React, { useState, createElement as h } from "react";
import { createRoot } from "react-dom/client";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from "recharts";
const RAW_DATA = [
  {pattern:"random",N:100,kntrie_int32_find:0.0005,kntrie_int32_insert:0.0023,kntrie_int32_erase:0.0015,kntrie_int32_mem:4816,kntrie_uint64_find:0.0005,kntrie_uint64_insert:0.0047,kntrie_uint64_erase:0.0011,kntrie_uint64_mem:4880,map_int32_find:0.0005,map_int32_insert:0.0055,map_int32_erase:0.0047,map_int32_mem:4800,map_uint64_find:0.0005,map_uint64_insert:0.0042,map_uint64_erase:0.0024,map_uint64_mem:4800,umap_int32_find:0.0004,umap_int32_insert:0.0023,umap_int32_erase:0.0018,umap_int32_mem:3224,umap_uint64_find:0.0005,umap_uint64_insert:0.0014,umap_uint64_erase:0.0011,umap_uint64_mem:3224},
  {pattern:"random",N:150,kntrie_int32_find:0.0007,kntrie_int32_insert:0.0035,kntrie_int32_erase:0.0018,kntrie_int32_mem:5984,kntrie_uint64_find:0.0007,kntrie_uint64_insert:0.0036,kntrie_uint64_erase:0.0016,kntrie_uint64_mem:6208,map_int32_find:0.0010,map_int32_insert:0.0087,map_int32_erase:0.0065,map_int32_mem:7200,map_uint64_find:0.0009,map_uint64_insert:0.0074,map_uint64_erase:0.0039,map_uint64_mem:7200,umap_int32_find:0.0007,umap_int32_insert:0.0056,umap_int32_erase:0.0025,umap_int32_mem:4856,umap_uint64_find:0.0007,umap_uint64_insert:0.0036,umap_uint64_erase:0.0015,umap_uint64_mem:4856},
  {pattern:"random",N:225,kntrie_int32_find:0.0013,kntrie_int32_insert:0.0083,kntrie_int32_erase:0.0039,kntrie_int32_mem:7464,kntrie_uint64_find:0.0010,kntrie_uint64_insert:0.0068,kntrie_uint64_erase:0.0022,kntrie_uint64_mem:8016,map_int32_find:0.0018,map_int32_insert:0.0144,map_int32_erase:0.0089,map_int32_mem:10800,map_uint64_find:0.0013,map_uint64_insert:0.0117,map_uint64_erase:0.0055,map_uint64_mem:10800,umap_int32_find:0.0012,umap_int32_insert:0.0097,umap_int32_erase:0.0035,umap_int32_mem:7216,umap_uint64_find:0.0011,umap_uint64_insert:0.0072,umap_uint64_erase:0.0021,umap_uint64_mem:7216},
  {pattern:"random",N:337,kntrie_int32_find:0.0014,kntrie_int32_insert:0.0115,kntrie_int32_erase:0.0049,kntrie_int32_mem:9488,kntrie_uint64_find:0.0015,kntrie_uint64_insert:0.0120,kntrie_uint64_erase:0.0042,kntrie_uint64_mem:10448,map_int32_find:0.0023,map_int32_insert:0.0315,map_int32_erase:0.0125,map_int32_mem:16176,map_uint64_find:0.0025,map_uint64_insert:0.0200,map_uint64_erase:0.0123,map_uint64_mem:16176,umap_int32_find:0.0016,umap_int32_insert:0.0105,umap_int32_erase:0.0039,umap_int32_mem:10784,umap_uint64_find:0.0015,umap_uint64_insert:0.0094,umap_uint64_erase:0.0030,umap_uint64_mem:10784},
  {pattern:"random",N:506,kntrie_int32_find:0.0025,kntrie_int32_insert:0.0194,kntrie_int32_erase:0.0080,kntrie_int32_mem:12224,kntrie_uint64_find:0.0024,kntrie_uint64_insert:0.0202,kntrie_uint64_erase:0.0069,kntrie_uint64_mem:13664,map_int32_find:0.0046,map_int32_insert:0.0392,map_int32_erase:0.0222,map_int32_mem:24288,map_uint64_find:0.0039,map_uint64_insert:0.0396,map_uint64_erase:0.0201,map_uint64_mem:24288,umap_int32_find:0.0023,umap_int32_insert:0.0130,umap_int32_erase:0.0058,umap_int32_mem:16472,umap_uint64_find:0.0023,umap_uint64_insert:0.0130,umap_uint64_erase:0.0050,umap_uint64_mem:16472},
  {pattern:"random",N:759,kntrie_int32_find:0.0035,kntrie_int32_insert:0.0354,kntrie_int32_erase:0.0137,kntrie_int32_mem:15824,kntrie_uint64_find:0.0035,kntrie_uint64_insert:0.0315,kntrie_uint64_erase:0.0123,kntrie_uint64_mem:18160,map_int32_find:0.0085,map_int32_insert:0.0621,map_int32_erase:0.0397,map_int32_mem:36432,map_uint64_find:0.0069,map_uint64_insert:0.0620,map_uint64_erase:0.0348,map_uint64_mem:36432,umap_int32_find:0.0036,umap_int32_insert:0.0247,umap_int32_erase:0.0091,umap_int32_mem:24304,umap_uint64_find:0.0035,umap_uint64_insert:0.0202,umap_uint64_erase:0.0066,umap_uint64_mem:24304},
  {pattern:"random",N:1139,kntrie_int32_find:0.0052,kntrie_int32_insert:0.0574,kntrie_int32_erase:0.0218,kntrie_int32_mem:20824,kntrie_uint64_find:0.0055,kntrie_uint64_insert:0.0547,kntrie_uint64_erase:0.0207,kntrie_uint64_mem:24544,map_int32_find:0.0160,map_int32_insert:0.0971,map_int32_erase:0.0547,map_int32_mem:54672,map_uint64_find:0.0173,map_uint64_insert:0.1018,map_uint64_erase:0.0523,map_uint64_mem:54672,umap_int32_find:0.0052,umap_int32_insert:0.0301,umap_int32_erase:0.0111,umap_int32_mem:36880,umap_uint64_find:0.0053,umap_uint64_insert:0.0308,umap_uint64_erase:0.0106,umap_uint64_mem:36880},
  {pattern:"random",N:1708,kntrie_int32_find:0.0167,kntrie_int32_insert:0.1080,kntrie_int32_erase:0.0460,kntrie_int32_mem:28320,kntrie_uint64_find:0.0132,kntrie_uint64_insert:0.0923,kntrie_uint64_erase:0.0331,kntrie_uint64_mem:34384,map_int32_find:0.0355,map_int32_insert:0.1499,map_int32_erase:0.0935,map_int32_mem:81984,map_uint64_find:0.0355,map_uint64_insert:0.1692,map_uint64_erase:0.0888,map_uint64_mem:81984,umap_int32_find:0.0084,umap_int32_insert:0.0483,umap_int32_erase:0.0209,umap_int32_mem:54920,umap_uint64_find:0.0082,umap_uint64_insert:0.0443,umap_uint64_erase:0.0188,umap_uint64_mem:54920},
  {pattern:"random",N:2562,kntrie_int32_find:0.0325,kntrie_int32_insert:0.1491,kntrie_int32_erase:0.0517,kntrie_int32_mem:39680,kntrie_uint64_find:0.0313,kntrie_uint64_insert:0.1538,kntrie_uint64_erase:0.0503,kntrie_uint64_mem:49104,map_int32_find:0.0632,map_int32_insert:0.2556,map_int32_erase:0.1462,map_int32_mem:122976,map_uint64_find:0.0626,map_uint64_insert:0.2671,map_uint64_erase:0.1380,map_uint64_mem:122976,umap_int32_find:0.0124,umap_int32_insert:0.0693,umap_int32_erase:0.0301,umap_int32_mem:83512,umap_uint64_find:0.0123,umap_uint64_insert:0.0678,umap_uint64_erase:0.0295,umap_uint64_mem:83512},
  {pattern:"random",N:3844,kntrie_int32_find:0.0674,kntrie_int32_insert:0.2346,kntrie_int32_erase:0.0881,kntrie_int32_mem:56080,kntrie_uint64_find:0.0619,kntrie_uint64_insert:0.2275,kntrie_uint64_erase:0.0811,kntrie_uint64_mem:71840,map_int32_find:0.1089,map_int32_insert:0.4161,map_int32_erase:0.2382,map_int32_mem:184512,map_uint64_find:0.1094,map_uint64_insert:0.4235,map_uint64_erase:0.2359,map_uint64_mem:184512,umap_int32_find:0.0183,umap_int32_insert:0.1036,umap_int32_erase:0.0485,umap_int32_mem:124472,umap_uint64_find:0.0192,umap_uint64_insert:0.1043,umap_uint64_erase:0.0501,umap_uint64_mem:124472},
  {pattern:"random",N:5766,kntrie_int32_find:0.1062,kntrie_int32_insert:0.3505,kntrie_int32_erase:0.1250,kntrie_int32_mem:82336,kntrie_uint64_find:0.1094,kntrie_uint64_insert:0.3527,kntrie_uint64_erase:0.1292,kntrie_uint64_mem:104832,map_int32_find:0.1914,map_int32_insert:0.6646,map_int32_erase:0.3963,map_int32_mem:276768,map_uint64_find:0.1997,map_uint64_insert:0.7375,map_uint64_erase:0.3838,map_uint64_mem:276768,umap_int32_find:0.0340,umap_int32_insert:0.1616,umap_int32_erase:0.0804,umap_int32_mem:186008,umap_uint64_find:0.0318,umap_uint64_insert:0.1636,umap_uint64_erase:0.0794,umap_uint64_mem:186008},
  {pattern:"random",N:8649,kntrie_int32_find:0.2059,kntrie_int32_insert:0.5141,kntrie_int32_erase:0.1867,kntrie_int32_mem:118592,kntrie_uint64_find:0.2190,kntrie_uint64_insert:0.5410,kntrie_uint64_erase:0.1932,kntrie_uint64_mem:156416,map_int32_find:0.3246,map_int32_insert:1.0959,map_int32_erase:0.6040,map_int32_mem:415152,map_uint64_find:0.3294,map_uint64_insert:1.2356,map_uint64_erase:0.6469,map_uint64_mem:415152,umap_int32_find:0.0730,umap_int32_insert:0.2405,umap_int32_erase:0.1206,umap_int32_mem:277840,umap_uint64_find:0.0825,umap_uint64_insert:0.2649,umap_uint64_erase:0.1253,umap_uint64_mem:277840},
  {pattern:"sequential",N:100,kntrie_int32_find:0.0009,kntrie_int32_insert:0.0041,kntrie_int32_erase:0.0015,kntrie_int32_mem:3328,kntrie_uint64_find:0.0008,kntrie_uint64_insert:0.0037,kntrie_uint64_erase:0.0014,kntrie_uint64_mem:3840,map_int32_find:0.0006,map_int32_insert:0.0047,map_int32_erase:0.0020,map_int32_mem:4800,map_uint64_find:0.0006,map_uint64_insert:0.0035,map_uint64_erase:0.0019,map_uint64_mem:4800,umap_int32_find:0.0003,umap_int32_insert:0.0012,umap_int32_erase:0.0006,umap_int32_mem:3224,umap_uint64_find:0.0003,umap_uint64_insert:0.0011,umap_uint64_erase:0.0006,umap_uint64_mem:3224},
  {pattern:"sequential",N:150,kntrie_int32_find:0.0014,kntrie_int32_insert:0.0069,kntrie_int32_erase:0.0027,kntrie_int32_mem:4096,kntrie_uint64_find:0.0013,kntrie_uint64_insert:0.0053,kntrie_uint64_erase:0.0024,kntrie_uint64_mem:4608,map_int32_find:0.0008,map_int32_insert:0.0068,map_int32_erase:0.0031,map_int32_mem:7200,map_uint64_find:0.0008,map_uint64_insert:0.0059,map_uint64_erase:0.0028,map_uint64_mem:7200,umap_int32_find:0.0005,umap_int32_insert:0.0034,umap_int32_erase:0.0010,umap_int32_mem:4856,umap_uint64_find:0.0005,umap_uint64_insert:0.0034,umap_uint64_erase:0.0009,umap_uint64_mem:4856},
  {pattern:"sequential",N:225,kntrie_int32_find:0.0023,kntrie_int32_insert:0.0103,kntrie_int32_erase:0.0046,kntrie_int32_mem:5120,kntrie_uint64_find:0.0021,kntrie_uint64_insert:0.0095,kntrie_uint64_erase:0.0044,kntrie_uint64_mem:6144,map_int32_find:0.0013,map_int32_insert:0.0100,map_int32_erase:0.0045,map_int32_mem:10800,map_uint64_find:0.0013,map_uint64_insert:0.0106,map_uint64_erase:0.0069,map_uint64_mem:10800,umap_int32_find:0.0007,umap_int32_insert:0.0046,umap_int32_erase:0.0013,umap_int32_mem:7216,umap_uint64_find:0.0007,umap_uint64_insert:0.0047,umap_uint64_erase:0.0013,umap_uint64_mem:7216},
  {pattern:"sequential",N:337,kntrie_int32_find:0.0033,kntrie_int32_insert:0.0223,kntrie_int32_erase:0.0089,kntrie_int32_mem:6144,kntrie_uint64_find:0.0034,kntrie_uint64_insert:0.0195,kntrie_uint64_erase:0.0087,kntrie_uint64_mem:8192,map_int32_find:0.0021,map_int32_insert:0.0182,map_int32_erase:0.0079,map_int32_mem:16176,map_uint64_find:0.0021,map_uint64_insert:0.0240,map_uint64_erase:0.0102,map_uint64_mem:16176,umap_int32_find:0.0010,umap_int32_insert:0.0066,umap_int32_erase:0.0018,umap_int32_mem:10784,umap_uint64_find:0.0010,umap_uint64_insert:0.0070,umap_uint64_erase:0.0019,umap_uint64_mem:10784},
  {pattern:"sequential",N:506,kntrie_int32_find:0.0056,kntrie_int32_insert:0.0370,kntrie_int32_erase:0.0150,kntrie_int32_mem:8192,kntrie_uint64_find:0.0053,kntrie_uint64_insert:0.0408,kntrie_uint64_erase:0.0130,kntrie_uint64_mem:10240,map_int32_find:0.0038,map_int32_insert:0.0398,map_int32_erase:0.0234,map_int32_mem:24288,map_uint64_find:0.0040,map_uint64_insert:0.0399,map_uint64_erase:0.0239,map_uint64_mem:24288,umap_int32_find:0.0015,umap_int32_insert:0.0110,umap_int32_erase:0.0029,umap_int32_mem:16472,umap_uint64_find:0.0016,umap_uint64_insert:0.0103,umap_uint64_erase:0.0028,umap_uint64_mem:16472},
  {pattern:"sequential",N:759,kntrie_int32_find:0.0086,kntrie_int32_insert:0.0684,kntrie_int32_erase:0.0232,kntrie_int32_mem:12288,kntrie_uint64_find:0.0083,kntrie_uint64_insert:0.0728,kntrie_uint64_erase:0.0199,kntrie_uint64_mem:14336,map_int32_find:0.0067,map_int32_insert:0.0575,map_int32_erase:0.0313,map_int32_mem:36432,map_uint64_find:0.0073,map_uint64_insert:0.0607,map_uint64_erase:0.0328,map_uint64_mem:36432,umap_int32_find:0.0023,umap_int32_insert:0.0149,umap_int32_erase:0.0038,umap_int32_mem:24304,umap_uint64_find:0.0023,umap_uint64_insert:0.0155,umap_uint64_erase:0.0038,umap_uint64_mem:24304},
  {pattern:"sequential",N:1139,kntrie_int32_find:0.0161,kntrie_int32_insert:0.1035,kntrie_int32_erase:0.0352,kntrie_int32_mem:16384,kntrie_uint64_find:0.0173,kntrie_uint64_insert:0.1015,kntrie_uint64_erase:0.0314,kntrie_uint64_mem:22528,map_int32_find:0.0161,map_int32_insert:0.0909,map_int32_erase:0.0547,map_int32_mem:54672,map_uint64_find:0.0175,map_uint64_insert:0.1009,map_uint64_erase:0.0540,map_uint64_mem:54672,umap_int32_find:0.0035,umap_int32_insert:0.0212,umap_int32_erase:0.0056,umap_int32_mem:36880,umap_uint64_find:0.0035,umap_uint64_insert:0.0213,umap_uint64_erase:0.0059,umap_uint64_mem:36880},
  {pattern:"sequential",N:1708,kntrie_int32_find:0.0427,kntrie_int32_insert:0.1881,kntrie_int32_erase:0.0539,kntrie_int32_mem:26624,kntrie_uint64_find:0.0424,kntrie_uint64_insert:0.1831,kntrie_uint64_erase:0.0520,kntrie_uint64_mem:30720,map_int32_find:0.0351,map_int32_insert:0.1496,map_int32_erase:0.0910,map_int32_mem:81984,map_uint64_find:0.0362,map_uint64_insert:0.1639,map_uint64_erase:0.0841,map_uint64_mem:81984,umap_int32_find:0.0052,umap_int32_insert:0.0314,umap_int32_erase:0.0093,umap_int32_mem:54920,umap_uint64_find:0.0052,umap_uint64_insert:0.0308,umap_uint64_erase:0.0090,umap_uint64_mem:54920},
  {pattern:"sequential",N:2562,kntrie_int32_find:0.0879,kntrie_int32_insert:0.2996,kntrie_int32_erase:0.0807,kntrie_int32_mem:34816,kntrie_uint64_find:0.0904,kntrie_uint64_insert:0.3020,kntrie_uint64_erase:0.0757,kntrie_uint64_mem:51200,map_int32_find:0.0656,map_int32_insert:0.2509,map_int32_erase:0.1499,map_int32_mem:122976,map_uint64_find:0.0656,map_uint64_insert:0.2691,map_uint64_erase:0.1615,map_uint64_mem:122976,umap_int32_find:0.0078,umap_int32_insert:0.0463,umap_int32_erase:0.0140,umap_int32_mem:83512,umap_uint64_find:0.0080,umap_uint64_insert:0.0461,umap_uint64_erase:0.0130,umap_uint64_mem:83512},
  {pattern:"sequential",N:3844,kntrie_int32_find:0.1536,kntrie_int32_insert:0.4333,kntrie_int32_erase:0.1248,kntrie_int32_mem:51200,kntrie_uint64_find:0.1632,kntrie_uint64_insert:0.6821,kntrie_uint64_erase:0.1157,kntrie_uint64_mem:67584,map_int32_find:0.1022,map_int32_insert:0.3888,map_int32_erase:0.2265,map_int32_mem:184512,map_uint64_find:0.1109,map_uint64_insert:0.4336,map_uint64_erase:0.2314,map_uint64_mem:184512,umap_int32_find:0.0118,umap_int32_insert:0.0660,umap_int32_erase:0.0201,umap_int32_mem:124472,umap_uint64_find:0.0120,umap_uint64_insert:0.0678,umap_uint64_erase:0.0206,umap_uint64_mem:124472},
  {pattern:"sequential",N:5766,kntrie_int32_find:0.0395,kntrie_int32_insert:0.6282,kntrie_int32_erase:0.0930,kntrie_int32_mem:59904,kntrie_uint64_find:0.0528,kntrie_uint64_insert:0.6465,kntrie_uint64_erase:0.1032,kntrie_uint64_mem:59904,map_int32_find:0.2046,map_int32_insert:0.6683,map_int32_erase:0.3926,map_int32_mem:276768,map_uint64_find:0.1995,map_uint64_insert:0.7004,map_uint64_erase:0.3847,map_uint64_mem:276768,umap_int32_find:0.0179,umap_int32_insert:0.0973,umap_int32_erase:0.0316,umap_int32_mem:186008,umap_uint64_find:0.0179,umap_uint64_insert:0.0954,umap_uint64_erase:0.0304,umap_uint64_mem:186008},
  {pattern:"sequential",N:8649,kntrie_int32_find:0.0586,kntrie_int32_insert:0.9395,kntrie_int32_erase:0.1458,kntrie_int32_mem:88704,kntrie_uint64_find:0.0795,kntrie_uint64_insert:0.7402,kntrie_uint64_erase:0.1550,kntrie_uint64_mem:88704,map_int32_find:0.3443,map_int32_insert:1.1227,map_int32_erase:0.6375,map_int32_mem:415152,map_uint64_find:0.3323,map_uint64_insert:1.1772,map_uint64_erase:0.6311,map_uint64_mem:415152,umap_int32_find:0.0272,umap_int32_insert:0.1364,umap_int32_erase:0.0478,umap_int32_mem:277840,umap_uint64_find:0.0270,umap_uint64_insert:0.1343,umap_uint64_erase:0.0478,umap_uint64_mem:277840},
];

import htm from "https://esm.sh/htm@3.1.1";
const html = htm.bind(React.createElement);

const LINES = [
  { key: "kntrie_int32", color: "#3b82f6", dash: "", label: "kntrie i32" },
  { key: "kntrie_uint64", color: "#93c5fd", dash: "6 3", label: "kntrie u64" },
  { key: "map_int32", color: "#ef4444", dash: "", label: "map i32" },
  { key: "map_uint64", color: "#fca5a5", dash: "6 3", label: "map u64" },
  { key: "umap_int32", color: "#22c55e", dash: "", label: "umap i32" },
  { key: "umap_uint64", color: "#86efac", dash: "6 3", label: "umap u64" },
  { key: "raw_int32", color: "#888", dash: "", label: "raw i32", memOnly: true },
  { key: "raw_uint64", color: "#555", dash: "3 3", label: "raw u64", memOnly: true },
];

const METRICS = [
  { suffix: "find", label: "Find (ns/entry)", convert: (ms, n) => (ms * 1e6) / n },
  { suffix: "insert", label: "Insert (ns/entry)", convert: (ms, n) => (ms * 1e6) / n },
  { suffix: "erase", label: "Erase N/2 (ns/entry)", convert: (ms, n) => (ms * 1e6) / (n / 2) },
  { suffix: "mem", label: "Memory (B/entry)", convert: (b, n) => b / n },
];

const PATTERNS = ["random", "sequential"];

function buildData(pattern, metric) {
  const lines = LINES.filter((l) => metric.suffix === "mem" || !l.memOnly);
  return RAW_DATA
    .filter((r) => r.pattern === pattern)
    .map((r) => {
      const out = { N: r.N, logN: Math.log10(r.N) };
      for (const line of lines) {
        if (line.key === "raw_int32") {
          if (metric.suffix === "mem") out[line.key] = r.N * 12 / r.N;
        } else if (line.key === "raw_uint64") {
          if (metric.suffix === "mem") out[line.key] = r.N * 16 / r.N;
        } else {
          const raw = r[`${line.key}_${metric.suffix}`];
          if (raw != null) out[line.key] = metric.convert(raw, r.N);
        }
      }
      return out;
    });
}

const fmtN = (logV) => {
  const v = Math.pow(10, logV);
  if (v >= 1e6) return (v / 1e6).toFixed(v >= 1e7 ? 0 : 1) + "M";
  if (v >= 1e3) return (v / 1e3).toFixed(v >= 1e4 ? 0 : 1) + "K";
  return String(Math.round(v));
};

const fmtVal = (v) => {
  if (v == null) return "";
  if (v < 0.1) return v.toFixed(3);
  if (v < 10) return v.toFixed(2);
  if (v < 1000) return v.toFixed(1);
  return v.toFixed(0);
};

const Tip = ({ active, payload, label }) => {
  if (!active || !payload?.length) return null;
  return html`<div style=${{ background: "#1a1a2e", border: "1px solid #444", borderRadius: 8, padding: "8px 12px", fontSize: 12 }}>
    <div style=${{ color: "#aaa", marginBottom: 4, fontWeight: 600 }}>N = ${fmtN(label)}</div>
    ${payload.filter((p) => p.value != null).map((p) => html`
      <div key=${p.dataKey} style=${{ color: p.color, marginBottom: 1 }}>
        ${LINES.find((l) => l.key === p.dataKey)?.label}: ${fmtVal(p.value)}
      </div>
    `)}
  </div>`;
};

const Chart = ({ title, data }) => {
  const allVals = data.flatMap((d) => LINES.map((l) => d[l.key]).filter((v) => v != null && v > 0));
  if (!allVals.length) return null;

  const logNs = data.map(d => d.logN);
  const minX = Math.floor(Math.min(...logNs));
  const maxX = Math.ceil(Math.max(...logNs));
  const xTicks = [];
  for (let i = minX; i <= maxX; i++) xTicks.push(i);

  return html`<div style=${{ marginBottom: 28 }}>
    <h3 style=${{ margin: "0 0 6px 0", fontSize: 14, fontWeight: 600, color: "#ddd", textAlign: "center" }}>${title}</h3>
    <${ResponsiveContainer} width="100%" height=${240}>
      <${LineChart} data=${data} margin=${{ top: 4, right: 16, left: 8, bottom: 4 }}>
        <${CartesianGrid} strokeDasharray="3 3" stroke="#2a2a3e" />
        <${XAxis} dataKey="logN" type="number" domain=${[minX, maxX]}
          ticks=${xTicks} tickFormatter=${fmtN}
          tick=${{ fill: "#888", fontSize: 11 }} stroke="#444" />
        <${YAxis} scale="log" domain=${["auto", "auto"]} type="number"
          tickFormatter=${fmtVal} tick=${{ fill: "#888", fontSize: 10 }}
          stroke="#444" width=${52} allowDataOverflow />
        <${Tooltip} content=${html`<${Tip} />`} />
        ${LINES.map((l) => html`
          <${Line} key=${l.key} type="monotone" dataKey=${l.key} stroke=${l.color}
            strokeWidth=${l.dash ? 1.5 : 2.5} dot=${false}
            strokeDasharray=${l.dash || undefined} connectNulls isAnimationActive=${false} />
        `)}
      </${LineChart}>
    </${ResponsiveContainer}>
  </div>`;
};

function App() {
  const [pattern, setPattern] = useState("random");
  return html`<div style=${{ background: "#0f0f1a", color: "#ddd", minHeight: "100vh", padding: "16px 12px", fontFamily: "system-ui, sans-serif" }}>
    <h2 style=${{ margin: "0 0 4px 0", fontSize: 18, fontWeight: 700, textAlign: "center" }}>kntrie Benchmark</h2>
    <p style=${{ textAlign: "center", color: "#777", fontSize: 12, margin: "0 0 12px 0" }}>
      Log-log · Per-entry · Lower is better · Solid = i32, Dashed = u64
    </p>

    <div style=${{ display: "flex", justifyContent: "center", gap: 12, marginBottom: 16, flexWrap: "wrap" }}>
      ${LINES.map((l) => html`
        <div key=${l.key} style=${{ display: "flex", alignItems: "center", gap: 5, fontSize: 11 }}>
          ${l.dash
            ? html`<svg width=${22} height=${4}><line x1=${0} y1=${2} x2=${22} y2=${2} stroke=${l.color} strokeWidth=${2} strokeDasharray=${l.dash} /></svg>`
            : html`<div style=${{ width: 22, height: 2.5, background: l.color, borderRadius: 1 }} />`}
          <span style=${{ color: "#bbb" }}>${l.label}</span>
        </div>
      `)}
    </div>

    <div style=${{ display: "flex", justifyContent: "center", gap: 8, marginBottom: 16 }}>
      ${PATTERNS.map((p) => html`
        <button key=${p} onClick=${() => setPattern(p)}
          style=${{
            padding: "6px 16px", borderRadius: 6, border: "1px solid #444",
            background: pattern === p ? "#3b82f6" : "#1a1a2e",
            color: pattern === p ? "#fff" : "#aaa",
            cursor: "pointer", fontSize: 13, fontWeight: 600,
          }}>
          ${p}
        </button>
      `)}
    </div>

    <div style=${{ maxWidth: 620, margin: "0 auto" }}>
      ${METRICS.map((m) => html`
        <${Chart} key=${pattern + "-" + m.suffix} title=${m.label}
          data=${buildData(pattern, m)} />
      `)}
    </div>
  </div>`;
}

createRoot(document.getElementById("root")).render(html`<${App} />`);
</script>
</body>
</html>
